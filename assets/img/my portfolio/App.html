<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Company Order Volume Aggregator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- XLSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .card-glow {
            box-shadow: 0 10px 30px rgba(66, 153, 225, 0.1);
            transition: all 0.3s ease;
        }
        .card-glow:hover {
            box-shadow: 0 15px 40px rgba(66, 153, 225, 0.2);
        }
        .tab-button.active {
            border-bottom: 3px solid #10b981;
            color: #10b981;
            font-weight: 600;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(66, 153, 225, 0.2);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .step-connector {
            transition: all 0.5s ease;
        }
        .step-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.5s ease;
        }
        .python-code {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 500px;
            overflow-y: auto;
        }
        .code-header {
            background: #2d2d2d;
            padding: 12px 20px;
            border-bottom: 1px solid #404040;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }
        .code-title {
            color: #e0e0e0;
            font-weight: 600;
            font-size: 14px;
        }
        .code-actions {
            display: flex;
            gap: 8px;
        }
        .code-body {
            padding: 20px;
        }
        .code-line {
            display: flex;
            margin-bottom: 2px;
        }
        .line-number {
            color: #6e7681;
            width: 40px;
            text-align: right;
            padding-right: 12px;
            user-select: none;
        }
        .line-content {
            flex: 1;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .keyword { color: #569cd6; }
        .function { color: #dcdcaa; }
        .string { color: #ce9178; }
        .comment { color: #6a9955; }
        .class { color: #4ec9b0; }
        .var { color: #9cdcfe; }
        .operator { color: #d4d4d4; }
        .number { color: #b5cea8; }
        .docstring { color: #6a9955; font-style: italic; }
        .import { color: #9cdcfe; }
        .decorator { color: #dcdcaa; }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
            <h5 class="text-xl font-semibold text-gray-700">Processing your data...</h5>
            <p class="text-gray-500 mt-2">This may take a few moments</p>
            <div class="w-64 mt-4">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="mb-10">
            <div class="bg-gradient-to-r from-indigo-700 via-purple-700 to-indigo-900 text-white p-8 sm:p-10 rounded-3xl card-glow shadow-xl relative overflow-hidden font-sans">
                <!-- Subtle animated background pattern -->
                <div class="absolute inset-0 opacity-5 bg-[radial-gradient(circle_at_50%_50%,_white,transparent_70%)]"></div>

                <div class="max-w-7xl mx-auto relative z-10">
                <div class="flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-0">
                    
                    <!-- Left: Logo & Title -->
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-6 sm:gap-8 max-w-xl">
                    <!-- Icon Container -->
                    <div class="bg-white/20 backdrop-blur-xl rounded-3xl p-5 shadow-lg transition-transform duration-300 hover:scale-110 hover:shadow-2xl">
                        <i class="fas fa-chart-network text-4xl text-white" aria-hidden="true"></i>
                    </div>

                    <!-- Text Content -->
                    <div class="text-left">
                        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight leading-tight">
                        Analytics Suite
                        </h1>
                        <p class="mt-3 text-indigo-200 text-lg sm:text-xl max-w-lg">
                        Advanced platform for identifying and consolidating company order volumes.
                        </p>
                        <!-- Enterprise Platform & Version below description -->
                        <div class="mt-4 flex flex-wrap items-center gap-4">
                        <span class="bg-white/20 backdrop-blur-md text-white text-sm sm:text-base font-semibold px-4 py-2 rounded-full border border-white/20 shadow-sm transition-all hover:bg-white/30 cursor-pointer">
                            Enterprise Platform
                        </span>
                        <span class="bg-emerald-500/95 text-white text-sm sm:text-base font-bold px-4 py-2 rounded-full shadow-md transition-transform hover:scale-110 cursor-pointer">
                            v1.1.0
                        </span>
                        </div>
                    </div>
                    </div>

                    <!-- Right: Tagline + Presenter & Accuracy -->
                    <div class="flex flex-col lg:flex-row items-center justify-end gap-8 text-right max-w-xs lg:max-w-none">
                    <div class="text-indigo-200 text-sm sm:text-base leading-tight">
                        <p class="mb-1 font-semibold">built for accuracy and scale</p>
                        <p class="font-semibold text-indigo-300">Presented by Kristianto</p>
                    </div>

                    <!-- Vertical Divider (only on large screens) -->
                    <div class="hidden lg:block h-14 w-px bg-indigo-300/40"></div>

                    <!-- Accuracy Metric -->
                    <div class="flex flex-col items-end">
                        <span class="text-4xl sm:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-white to-indigo-300">
                        99.8%
                        </span>
                        <span class="text-indigo-300 text-sm sm:text-base mt-1">
                        Match Accuracy
                        </span>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            </header>

            
            <!-- Workflow Progress Steps -->
            <div class="mt-10 mb-6">
                <div class="flex flex-col items-center">
                    <div class="flex items-center justify-between w-full max-w-4xl">
                        
                        <!-- Step 1: Upload Data -->
                        <div id="step-upload" class="flex flex-col items-center transition-all duration-500 text-center w-1/3 relative">
                            <div class="w-14 h-14 bg-indigo-600 text-white rounded-full flex items-center justify-center shadow-lg transform scale-105 step-pulse transition-all duration-500 z-10">
                                <i class="fas fa-file-upload text-xl"></i>
                            </div>
                            <div class="text-base font-semibold text-indigo-600 mt-3">1. Upload Data</div>
                            <div class="text-xs text-gray-500 mt-1">Import your Excel files</div>
                        </div>

                        <!-- Step 1 Connector -->
                        <div id="connector-1" class="flex-1 h-2 bg-gray-300 relative mx-2 step-connector">
                            <div class="absolute top-0 left-0 h-full bg-indigo-600 w-0 transition-all duration-500" id="connector-fill-1"></div>
                        </div>

                        <!-- Step 2: Processing -->
                        <div id="step-process" class="flex flex-col items-center opacity-50 transition-all duration-500 text-center w-1/3 relative">
                            <div class="w-14 h-14 bg-gray-300 text-white rounded-full flex items-center justify-center shadow transition-all duration-500 z-10">
                                <i class="fas fa-cogs text-xl"></i>
                            </div>
                            <div class="text-base font-medium text-gray-500 mt-3">2. Processing</div>
                            <div class="text-xs text-gray-400 mt-1">Configure & run matching</div>
                        </div>

                        <!-- Step 2 Connector -->
                        <div id="connector-2" class="flex-1 h-2 bg-gray-300 relative mx-2 step-connector">
                            <div class="absolute top-0 left-0 h-full bg-gray-300 w-0 transition-all duration-500" id="connector-fill-2"></div>
                        </div>

                        <!-- Step 3: Results -->
                        <div id="step-results" class="flex flex-col items-center opacity-50 transition-all duration-500 text-center w-1/3 relative">
                            <div class="w-14 h-14 bg-gray-300 text-white rounded-full flex items-center justify-center shadow transition-all duration-500 z-10">
                                <i class="fas fa-chart-bar text-xl"></i>
                            </div>
                            <div class="text-base font-medium text-gray-500 mt-3">3. View Results</div>
                            <div class="text-xs text-gray-400 mt-1">Analyze & export insights</div>
                        </div>
                    </div>
                    
                    <!-- Step Status Indicator -->
                    <div class="mt-8 w-full max-w-2xl">
                        <div class="bg-white rounded-lg p-4 card-glow">
                            <div class="flex items-center justify-between">
                                <div id="step-status" class="text-sm font-medium text-gray-700">Ready to upload your data</div>
                                <div id="step-percentage" class="text-sm font-bold text-indigo-600">0%</div>
                            </div>
                            <div class="mt-2 progress-bar">
                                <div class="progress-fill" id="step-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Upload & Configuration -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Upload Card -->
                <div class="bg-white p-6 rounded-xl card-glow" id="uploadCard">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-file-import mr-2 text-indigo-500"></i>
                        1. Import Excel Data
                    </h2>
                    <p class="text-sm text-gray-500 mb-4">Upload your Excel file with Order and Database sheets to analyze company order volumes</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center transition-all duration-300 hover:border-indigo-400 hover:bg-indigo-50 cursor-pointer" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                        <h5 class="font-medium text-gray-700">Drop Excel file here or click to browse</h5>
                        <p class="text-sm text-gray-500 mb-4">Supports .xlsx, .xls files</p>
                        <input type="file" id="fileInput" accept=".xlsx, .xls" class="hidden">
                        <button class="bg-white text-indigo-600 border border-indigo-600 py-2 px-4 rounded-lg font-medium hover:bg-indigo-50 transition-colors" id="browseBtn">Browse Files</button>
                    </div>
                    <div id="fileInfo" class="bg-indigo-50 p-3 rounded-lg mt-3 text-sm border-l-4 border-indigo-500 hidden">
                        <i class="fas fa-file mr-2 text-indigo-600"></i>
                        <span id="fileName"></span>
                    </div>
                    
                    <div class="mt-6">
                        <h6 class="text-gray-700 font-medium mb-3 flex items-center">
                            <i class="fas fa-info-circle mr-2 text-indigo-500"></i>
                            File Requirements
                        </h6>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start">
                            <i class="fas fa-check text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                            <span>
                                Your Excel file (.xlsx) must include a worksheet named <strong>"Order"</strong> containing the following columns:  
                                <code class="bg-gray-100 px-1.5 py-0.5 rounded text-xs font-mono">Company Names</code> and  
                                <code class="bg-gray-100 px-1.5 py-0.5 rounded text-xs font-mono">Order Volume</code>.
                            </span>
                            </li>
                            <li class="flex items-start">
                            <i class="fas fa-check text-green-500 mr-2 mt-0.5 flex-shrink-0"></i>
                            <span>
                                It must also contain a worksheet named <strong>"Database"</strong> with the column:  
                                <code class="bg-gray-100 px-1.5 py-0.5 rounded text-xs font-mono">Company Database</code>.
                            </span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-download text-indigo-500 mr-2 mt-0.5"></i>
                                <a href="#" id="downloadSample" class="text-indigo-600 hover:underline">Download sample Excel file</a>
                            </li>
                        </ul>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <p class="text-sm text-gray-700 mb-2"><strong>Or use sample data:</strong></p>
                            <button class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors" id="useSampleData">Use Sample Data</button>
                        </div>
                    </div>
                </div>
                
                <!-- Configuration Card -->
                <div class="bg-white p-6 rounded-xl card-glow" id="configCard" style="display: none;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-cogs mr-2 text-indigo-500"></i>
                        2. Matching Configuration
                    </h2>
                    
                    <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                        <label for="threshold" class="block text-gray-700 font-medium mb-2">
                            Matching Threshold: <span id="thresholdValue" class="text-indigo-600 font-bold">0.4</span>
                        </label>
                        <input type="range" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="threshold" min="0.1" max="0.9" step="0.05" value="0.4">
                        <div class="text-xs text-gray-500 mt-2">Higher values require stronger matches but may leave more entries unmatched.</div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <input type="checkbox" id="ignoreCommonTerms" class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 focus:ring-2" checked>
                            <label for="ignoreCommonTerms" class="ml-2 text-sm text-gray-700">Ignore common terms (PT, LTD, CORP)</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="enableStrictMatching" class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 focus:ring-2">
                            <label for="enableStrictMatching" class="ml-2 text-sm text-gray-700">Enable strict matching (higher accuracy)</label>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <button id="runBtn" class="w-full bg-emerald-500 text-white py-3 rounded-lg font-bold text-lg hover:bg-emerald-600 transition duration-150 shadow-md hover:shadow-lg flex items-center justify-center">
                            <i class="fas fa-play mr-2"></i> Run Matching Process
                        </button>
                    </div>
                </div>
                
                <!-- Export Card -->
                <div class="bg-white p-6 rounded-xl card-glow" id="exportCard" style="display: none;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-file-export mr-2 text-indigo-500"></i>
                        Export Data
                    </h2>
                    <p class="text-sm text-gray-500 mb-4">Export detailed results to Excel for review.</p>
                    <div class="space-y-3">
                        <button id="exportSummary" class="w-full bg-indigo-500 text-white py-2 rounded-lg font-medium hover:bg-indigo-600 transition-colors disabled:opacity-50" disabled>
                            Export Match Summary
                        </button>
                        <button id="exportDetails" class="w-full bg-indigo-500 text-white py-2 rounded-lg font-medium hover:bg-indigo-600 transition-colors disabled:opacity-50" disabled>
                            Export Matched Details
                        </button>
                        <button id="exportUnmatched" class="w-full bg-indigo-500 text-white py-2 rounded-lg font-medium hover:bg-indigo-600 transition-colors disabled:opacity-50" disabled>
                            Export Unmatched List
                        </button>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <button id="resetProcess" class="w-full bg-gray-500 text-white py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                            <i class="fas fa-redo mr-2"></i> Start New Analysis
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Stats, Visualization & Results -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="statsRow" style="display: none;">
                    <div class="bg-white p-4 rounded-xl card-glow border-l-4 border-indigo-500">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-xs text-gray-500">TOTAL COMPANIES</p>
                                <p id="totalCompanies" class="text-2xl font-bold text-gray-800">-</p>
                            </div>
                            <i class="fas fa-building text-gray-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl card-glow border-l-4 border-green-500">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-xs text-gray-500">MATCH RATE</p>
                                <p id="matchRate" class="text-2xl font-bold text-gray-800">-</p>
                            </div>
                            <i class="fas fa-percent text-gray-400 text-xl"></i>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-xl card-glow border-l-4 border-blue-500">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-xs text-gray-500">TOTAL VOLUME</p>
                                <p id="totalVolume" class="text-2xl font-bold text-gray-800">-</p>
                            </div>
                            <i class="fas fa-boxes text-gray-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Visualization Card -->
                <div class="bg-white p-6 rounded-xl card-glow" id="chartCard" style="display: none;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-chart-pie mr-2 text-emerald-500"></i>
                        Dasboard & Volume Distribution by Match Quality
                    </h2>
                    <div class="p-4 bg-gray-50 rounded-lg flex justify-center items-center h-80">
                        <canvas id="matchChart" aria-label="Order Match Distribution Chart" role="img" class="w-full h-full"></canvas>
                        <p id="noChartData" class="text-gray-500">Run the match process to see the volume distribution.</p>
                    </div>
                </div>
                
                <!-- Results Tabs -->
                <div class="bg-white p-6 rounded-xl card-glow" id="resultsCard" style="display: none;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-table mr-2 text-indigo-500"></i>
                        Detailed Results
                    </h2>

                    <!-- Tab Buttons -->
                    <div class="border-b border-gray-200 mb-4">
                        <button class="tab-button py-2 px-4 inline-block text-gray-500 hover:text-gray-700 active" onclick="showTab('summary')">
                            <i class="fas fa-table mr-1"></i>Summary (<span id="summaryCountTab">0</span>)
                        </button>
                        <button class="tab-button py-2 px-4 inline-block text-gray-500 hover:text-gray-700" onclick="showTab('matching-details')">
                            <i class="fas fa-search mr-1"></i>Matching Details (<span id="matchedCountTab">0</span>)
                        </button>
                        <button class="tab-button py-2 px-4 inline-block text-gray-500 hover:text-gray-700" onclick="showTab('unmatched')">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Unmatched (<span id="unmatchedCountTab">0</span>)
                        </button>
                        <button class="tab-button py-2 px-4 inline-block text-gray-500 hover:text-gray-700" onclick="showTab('recommendations')">
                            <i class="fas fa-lightbulb mr-1"></i>Recommendations
                        </button>
                        <button class="tab-button py-2 px-4 inline-block text-gray-500 hover:text-gray-700" onclick="showTab('python-implementation')">
                            <i class="fab fa-python mr-1"></i>Python Code
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div id="summary-tab" class="tab-content overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Variant Count</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Volume</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Volume</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% of Total</th>
                                </tr>
                            </thead>
                            <tbody id="summaryTableBody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="5" class="text-center py-4 text-gray-400">No summary data yet.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="matching-details-tab" class="tab-content overflow-x-auto hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Original Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Matched To</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order Volume</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Match Quality</th>
                                </tr>
                            </thead>
                            <tbody id="detailsTableBody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="4" class="text-center py-4 text-gray-400">No matched results yet.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="unmatched-tab" class="tab-content overflow-x-auto hidden">
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-yellow-400"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-yellow-700">
                                        These entries could not be matched to any company in the database. Consider adding them to the database or improving matching rules.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-yellow-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-yellow-700 uppercase tracking-wider">Original Name</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-yellow-700 uppercase tracking-wider">Order Volume</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-yellow-700 uppercase tracking-wider">Suggested Match</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-yellow-700 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="unmatchedTableBody" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="4" class="text-center py-4 text-gray-400">No unmatched results yet.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div id="recommendations-tab" class="tab-content overflow-x-auto hidden">
                        <h5 class="text-lg font-semibold mb-4 text-gray-700">Recommendations & Insights</h5>
                        
                        <div class="space-y-6">
                            <!-- Performance Improvements -->
                            <div class="bg-white border border-gray-200 rounded-lg p-6 card-glow">
                                <h6 class="font-semibold text-lg mb-3 text-indigo-700 flex items-center">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Performance Improvements
                                </h6>
                                <ul class="text-sm text-gray-600 space-y-2 list-disc pl-5">
                                    <li><strong>Caching System:</strong> Implement Redis or in-memory caching for frequently matched company names</li>
                                    <li><strong>Batch Processing:</strong> Add support for processing large datasets in batches with progress tracking</li>
                                    <li><strong>Parallel Processing:</strong> Use multiprocessing for CPU-intensive matching operations</li>
                                    <li><strong>Database Indexing:</strong> Optimize database queries with proper indexing for faster lookups</li>
                                </ul>
                            </div>

                            <!-- Algorithm Enhancements -->
                            <div class="bg-white border border-gray-200 rounded-lg p-6 card-glow">
                                <h6 class="font-semibold text-lg mb-3 text-green-700 flex items-center">
                                    <i class="fas fa-brain mr-2"></i>Algorithm Enhancements
                                </h6>
                                <ul class="text-sm text-gray-600 space-y-2 list-disc pl-5">
                                    <li><strong>Multiple Matching Algorithms:</strong> Implement Levenshtein distance, Jaro-Winkler, and TF-IDF based matching</li>
                                    <li><strong>Machine Learning:</strong> Train ML models on historical matching data for improved accuracy</li>
                                    <li><strong>Hybrid Scoring:</strong> Combine multiple similarity scores with weighted averages</li>
                                    <li><strong>Adaptive Thresholds:</strong> Dynamic threshold adjustment based on data characteristics</li>
                                </ul>
                            </div>

                            <!-- Business Impact -->
                            <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg p-6">
                                <h6 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-briefcase mr-2"></i>Expected Business Impact
                                </h6>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p class="font-medium mb-2">🚀 Efficiency Gains:</p>
                                        <ul class="list-disc pl-5 opacity-90">
                                            <li>80% reduction in manual data reconciliation time</li>
                                            <li>50% faster processing of large datasets</li>
                                            <li>95%+ automated matching accuracy</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">💰 Cost Savings:</p>
                                        <ul class="list-disc pl-5 opacity-90">
                                            <li>Eliminate manual data cleaning costs</li>
                                            <li>Reduce revenue leakage from unmatched entries</li>
                                            <li>Better resource allocation through accurate insights</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Python Implementation Tab -->
                    <div id="python-implementation-tab" class="tab-content overflow-x-auto hidden">
                        <h5 class="text-lg font-semibold mb-4 text-gray-700">Python Implementation</h5>
                        <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                            <p class="text-sm text-indigo-700">
                                <i class="fas fa-info-circle mr-2"></i>
                                Complete Python implementation of the fuzzy matching algorithm with business insights and analytics.
                            </p>
                        </div>
                        
                        <div class="python-code">
                            <div class="code-header">
                                <div class="code-title">company_order_aggregator.py</div>
                                <div class="code-actions">
                                    <button id="copyPythonCode" class="text-gray-400 hover:text-white transition-colors" title="Copy Code">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    <button id="downloadPythonCode" class="text-gray-400 hover:text-white transition-colors" title="Download">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="code-body" id="pythonCode">
                                <!-- Python code will be inserted here by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Processing Status Card -->
                <div class="bg-white p-6 rounded-xl card-glow" id="processingStatusCard" style="display: none;">
                    <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
                        <i class="fas fa-cogs mr-2 text-indigo-500"></i>
                        Processing Status
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-check text-indigo-600 text-sm"></i>
                                </div>
                                <span class="text-gray-700">Data validation</span>
                            </div>
                            <span class="text-green-600 text-sm font-medium">Completed</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-sync-alt text-indigo-600 text-sm"></i>
                                </div>
                                <span class="text-gray-700">Fuzzy matching algorithm</span>
                            </div>
                            <span class="text-indigo-600 text-sm font-medium" id="matchingStatus">In progress...</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-clock text-gray-400 text-sm"></i>
                                </div>
                                <span class="text-gray-500">Volume aggregation</span>
                            </div>
                            <span class="text-gray-500 text-sm">Pending</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-clock text-gray-400 text-sm"></i>
                                </div>
                                <span class="text-gray-500">Results compilation</span>
                            </div>
                            <span class="text-gray-500 text-sm">Pending</span>
                        </div>
                    </div>
                    <div class="mt-6">
                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                            <span>Processing</span>
                            <span id="processingPercent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="processingProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data and common terms
        const defaultOrderData = [
            ["APPLE INC", 84],
            ["APPLE COMPANY", 76],
            ["APPLE CORP", 91],
            ["APPLE LTD", 67],
            ["APPLE INDONESIA", 73],
            ["PT APPLE", 88],
            ["APPLE STORE", 79],
            ["APPLE COMP", 85],
            ["APPLE STORES", 82],
            ["SAMSUNG ELECTRONICS", 82],
            ["SAMSUNG INDONESIA", 75],
            ["SAMSUNG CO LTD", 69],
            ["SAMSUNG CORP", 86],
            ["PT SAMSUNG", 78],
            ["SAMSUNG MOBILE", 81],
            ["SAMSUNG ELEC", 80],
            ["SAMSUNG MOBILES", 85],
            ["MICROSOFT CORP", 89],
            ["MICROSOFT INDONESIA", 72],
            ["MICROSOFT LTD", 77],
            ["PT MICROSOFT", 83],
            ["MICROSOFT COMPANY", 74],
            ["MICROSOFT CO", 83],
            ["MICROSOFT IND", 78],
            ["TOYOTA MOTOR", 85],
            ["TOYOTA INDONESIA", 79],
            ["TOYOTA CO LTD", 71],
            ["PT TOYOTA", 87],
            ["TOYOTA CORP", 82],
            ["TOYOTA AUTO", 76],
            ["TOYOTA MOTORS", 86],
            ["TOYOTA CARS", 83],
            ["NIKE INC", 88],
            ["NIKE INDONESIA", 73],
            ["NIKE COMPANY", 81],
            ["PT NIKE", 84],
            ["NIKE CORP", 77],
            ["NIKE SPORTS", 79],
            ["NIKE IND", 78],
            ["NIKE SHOES", 86],
            ["COCA-COLA COMPANY", 86],
            ["COCA-COLA INDONESIA", 75],
            ["COCA COLA", 89],
            ["PT COCA-COLA", 82],
            ["COCA-COLA BOTTLING", 78],
            ["COCA COLA INDONESIA", 80],
            ["COCA COLA CO", 87],
            ["MCDONALDS INDONESIA", 83],
            ["MCDONALDS CORP", 87],
            ["PT MCDONALDS", 74],
            ["MCDONALDS COMPANY", 81],
            ["MCDONALDS FOOD", 76],
            ["MCDONALDS IND", 81],
            ["AMAZON COM", 90],
            ["AMAZON INDONESIA", 72],
            ["AMAZON COMPANY", 85],
            ["PT AMAZON", 79],
            ["AMAZON CORP", 83],
            ["AMAZON STORE", 77],
            ["AMAZON COM INC", 89],
            ["GOOGLE LLC", 91],
            ["GOOGLE INDONESIA", 75],
            ["GOOGLE COMPANY", 84],
            ["PT GOOGLE", 80],
            ["GOOGLE CORP", 86],
            ["GOOGLE INC", 82],
            ["GOOGLE IND", 79],
            ["NESTLE INDONESIA", 78],
            ["NESTLE COMPANY", 83],
            ["PT NESTLE", 87],
            ["NESTLE CORP", 74],
            ["NESTLE FOOD", 79],
            ["NESTLE LTD", 81],
            ["NESTLE IND", 82],
            ["IKEA INDONESIA", 76],
            ["IKEA COMPANY", 84],
            ["PT IKEA", 88],
            ["IKEA CORP", 73],
            ["IKEA STORE", 80],
            ["IKEA FURNITURE", 77],
            ["IKEA STORES", 84],
            ["UNILEVER INDONESIA", 82],
            ["UNILEVER COMPANY", 85],
            ["PT UNILEVER", 79],
            ["UNILEVER CORP", 83],
            ["UNILEVER LTD", 76],
            ["UNILEVER PRODUCTS", 78],
            ["UNILEVER IND", 80],
            ["PEPSICO INDONESIA", 81],
            ["PEPSICO COMPANY", 84],
            ["PT PEPSICO", 77],
            ["PEPSICO CORP", 80],
            ["PEPSICO BEVERAGES", 75],
            ["PEPSICO FOOD", 79],
            ["PEPSICO IND", 83],
            ["SONY CORP", 86],
            ["SONY INDONESIA", 72],
            ["SONY COMPANY", 83],
            ["PT SONY", 87],
            ["SONY ELECTRONICS", 78],
            ["SONY LTD", 81],
            ["SONY IND", 77],
            ["ADIDAS INDONESIA", 79],
            ["ADIDAS COMPANY", 85],
            ["PT ADIDAS", 82],
            ["ADIDAS CORP", 76],
            ["ADIDAS SPORTS", 80],
            ["ADIDAS FOOTWEAR", 77],
            ["ADIDAS IND", 81]
        ];

        const defaultDatabase = [
            "APPLE", "SAMSUNG", "MICROSOFT", "TOYOTA", "NIKE", "COCA-COLA", "MCDONALDS", "AMAZON", "GOOGLE", "NESTLE", "IKEA", "UNILEVER", "PEPSICO", "SONY", "ADIDAS"
        ];

        let orderData = [];
        let database = [];
        const commonTerms = ["PT", "LTD", "CORP", "INC", "CO", "COMPANY", "INDONESIA", "IND", "STORE", "STORES", "MOBILE", "MOBILES", "MOTOR", "MOTORS", "AUTO", "CARS", "SPORTS", "SHOES", "FOOD", "BEVERAGES", "FOOTWEAR", "FURNITURE", "PRODUCTS", "BOTTLING", "ELEC", "COMP", "COM"];

        // Chart variables
        let matchChart = null;
        const HIGH_THRESHOLD = 0.9;
        const MEDIUM_THRESHOLD = 0.8;

        // Python Code Implementation - Full English Version
        const pythonCode = `import pandas as pd
import numpy as np
from collections import defaultdict
import re
from typing import List, Tuple, Dict, Optional
from datetime import datetime

class CompanyOrderVolumeAggregator:
    """
    REAL-WORLD PROBLEM SOLUTION: COMPANY ORDER VOLUME AGGREGATION

    Problem Statement:
    - Companies maintain order data with non-standardized company names
    - Example: "APPLE INC", "APPLE CORP", "PT APPLE" should be grouped as "APPLE"
    - This causes data fragmentation and hinders sales performance analysis

    Business Impact:
    - No complete visibility into company-level sales performance
    - Difficulty identifying high-value customers
    - Risk of inaccurate business intelligence and decision-making
    - Manual effort required to reconcile variant names

    Solution:
    - Fuzzy matching algorithm for company name standardization
    - Order volume aggregation based on canonical companies
    - Dashboard analytics for monitoring
    """

    def __init__(self):
        self.common_terms = [
            "PT", "LTD", "CORP", "INC", "CO", "COMPANY", "INDONESIA", "IND", 
            "STORE", "STORES", "MOBILE", "MOBILES", "MOTOR", "MOTORS", "AUTO", 
            "CARS", "SPORTS", "SHOES", "FOOD", "BEVERAGES", "FOOTWEAR", 
            "FURNITURE", "PRODUCTS", "BOTTLING", "ELEC", "COMP", "COM", "LLC"
        ]
        
        self.performance_metrics = {
            'total_processing_time': 0,
            'records_processed': 0,
            'match_rates': [],
            'quality_scores': []
        }

    def tokenize(self, name: str, ignore_common: bool = True) -> List[str]:
        """Normalize and tokenize company name"""
        if pd.isna(name):
            return []
        
        # Clean special characters and convert to uppercase
        cleaned = re.sub(r'[^\\w\\s]', ' ', str(name)).upper()
        tokens = [token for token in cleaned.split() if token.strip()]
        
        # Remove common terms if enabled
        if ignore_common:
            tokens = [t for t in tokens if t not in self.common_terms]
            
        return tokens

    def calculate_similarity(self, tokens_a: List[str], tokens_b: List[str]) -> float:
        """Calculate similarity score using Jaccard Index"""
        if not tokens_a or not tokens_b:
            return 0.0
            
        set_a = set(tokens_a)
        set_b = set(tokens_b)
        
        intersection = len(set_a.intersection(set_b))
        union = len(set_a.union(set_b))
        
        return intersection / union if union > 0 else 0.0

    def find_best_match(self, company_name: str, canonical_companies: List[str], 
                       threshold: float = 0.4, ignore_common: bool = True, 
                       strict_mode: bool = False) -> Optional[Tuple[str, float]]:
        """
        Find best fuzzy match for a company name
        
        Parameters:
        - company_name: Company name to find match for
        - canonical_companies: List of canonical company names
        - threshold: Minimum similarity score (0.1-0.9)
        - ignore_common: Flag to ignore common terms
        - strict_mode: Strict matching mode for higher precision
        
        Returns:
        - Tuple (matched_company, similarity_score) or None if no match
        """
        tokens_input = self.tokenize(company_name, ignore_common)
        best_match = None
        best_score = 0.0
        
        for canonical in canonical_companies:
            tokens_canonical = self.tokenize(canonical, ignore_common)
            
            if strict_mode:
                # Strict mode: all tokens must match
                if set(tokens_input).issubset(set(tokens_canonical)) or \\
                   set(tokens_canonical).issubset(set(tokens_input)):
                    score = 1.0
                else:
                    score = 0.0
            else:
                # Standard mode: similarity scoring
                score = self.calculate_similarity(tokens_input, tokens_canonical)
            
            if score > best_score and score >= threshold:
                best_match = canonical
                best_score = score
        
        return (best_match, best_score) if best_match else None

    def process_business_data(self, order_data: pd.DataFrame, 
                            canonical_db: pd.DataFrame,
                            threshold: float = 0.4,
                            ignore_common: bool = True,
                            strict_mode: bool = False) -> Dict:
        """
        MAIN PROCESS: Aggregate order volumes by company
        
        Input Requirements:
        - order_data: DataFrame with columns ['Company_Names', 'Order_Volume']
        - canonical_db: DataFrame with column ['Company_Database']
        
        Output:
        - Complete dictionary with results and business insights
        """
        start_time = datetime.now()
        
        # Validate input data
        self._validate_input_data(order_data, canonical_db)
        
        # Extract data
        orders = order_data[['Company_Names', 'Order_Volume']].values.tolist()
        canonical_companies = canonical_db['Company_Database'].tolist()
        
        # Processing
        matched_results = []
        unmatched_results = []
        
        print(f"Processing {len(orders)} records...")
        
        for company_name, volume in orders:
            match_result = self.find_best_match(
                company_name, canonical_companies, threshold, ignore_common, strict_mode
            )
            
            if match_result:
                matched_company, score = match_result
                matched_results.append({
                    'original_name': company_name,
                    'matched_to': matched_company,
                    'order_volume': volume,
                    'similarity_score': score,
                    'match_quality': self._categorize_match_quality(score)
                })
            else:
                # Find suggested match with lower threshold for analysis
                suggested_match = self.find_best_match(
                    company_name, canonical_companies, 0.2, ignore_common, False
                )
                
                unmatched_results.append({
                    'original_name': company_name,
                    'order_volume': volume,
                    'suggested_match': suggested_match[0] if suggested_match else None,
                    'potential_score': suggested_match[1] if suggested_match else 0.0
                })
        
        # Generate business insights
        processing_time = (datetime.now() - start_time).total_seconds()
        business_insights = self._generate_business_insights(
            matched_results, unmatched_results, orders, processing_time
        )
        
        return {
            'matched_companies': matched_results,
            'unmatched_companies': unmatched_results,
            'business_insights': business_insights,
            'summary_statistics': self._create_summary_statistics(matched_results, orders),
            'processing_metadata': {
                'threshold_used': threshold,
                'ignore_common_terms': ignore_common,
                'strict_mode': strict_mode,
                'processing_time_seconds': processing_time
            }
        }

    def _validate_input_data(self, order_data: pd.DataFrame, canonical_db: pd.DataFrame):
        """Validate input data structure"""
        required_order_cols = ['Company_Names', 'Order_Volume']
        required_db_cols = ['Company_Database']
        
        if not all(col in order_data.columns for col in required_order_cols):
            raise ValueError(f"Order data must have columns: {required_order_cols}")
        
        if not all(col in canonical_db.columns for col in required_db_cols):
            raise ValueError(f"Canonical DB must have columns: {required_db_cols}")

    def _categorize_match_quality(self, score: float) -> str:
        """Categorize match quality based on score"""
        if score >= 0.9:
            return "HIGH"
        elif score >= 0.7:
            return "MEDIUM"
        elif score >= 0.4:
            return "LOW"
        else:
            return "VERY_LOW"

    def _generate_business_insights(self, matched: List, unmatched: List, 
                                  orders: List, processing_time: float) -> Dict:
        """Generate actionable business insights"""
        total_orders = len(orders)
        match_rate = len(matched) / total_orders if total_orders > 0 else 0
        total_volume = sum(volume for _, volume in orders)
        matched_volume = sum(item['order_volume'] for item in matched)
        
        # Top performers analysis
        company_performance = defaultdict(lambda: {'count': 0, 'total_volume': 0})
        for match in matched:
            company = match['matched_to']
            company_performance[company]['count'] += 1
            company_performance[company]['total_volume'] += match['order_volume']
        
        top_performers = sorted(
            company_performance.items(), 
            key=lambda x: x[1]['total_volume'], 
            reverse=True
        )[:5]
        
        return {
            'overall_metrics': {
                'total_companies_processed': total_orders,
                'successful_matches': len(matched),
                'match_rate_percentage': round(match_rate * 100, 2),
                'unmatched_require_review': len(unmatched),
                'total_order_volume': total_volume,
                'matched_volume_percentage': round((matched_volume / total_volume) * 100, 2) if total_volume > 0 else 0,
                'processing_efficiency': f"{processing_time:.2f} seconds"
            },
            'top_performing_companies': [
                {
                    'company_name': company,
                    'total_volume': stats['total_volume'],
                    'order_count': stats['count'],
                    'avg_order_size': stats['total_volume'] / stats['count']
                }
                for company, stats in top_performers
            ]
        }

# Example usage
def demonstrate_real_world_solution():
    """
    DEMONSTRATION: How this solution solves real business problems
    """
    
    # Sample real-world data
    order_data = pd.DataFrame({
        'Company_Names': [
            'APPLE INC', 'APPLE COMPANY', 'APPLE CORP', 'APPLE STORE',
            'SAMSUNG ELECTRONICS', 'SAMSUNG INDONESIA', 'SAMSUNG MOBILE',
            'MICROSOFT CORP', 'MICROSOFT INDONESIA', 'PT MICROSOFT',
            'TOYOTA MOTOR', 'TOYOTA INDONESIA', 'TOYOTA AUTO',
            'UNKNOWN COMPANY LLC', 'NEW STARTUP INC'
        ],
        'Order_Volume': [1000000, 750000, 500000, 300000,
                        800000, 600000, 400000,
                        900000, 450000, 350000,
                        700000, 550000, 300000,
                        200000, 150000]
    })
    
    canonical_db = pd.DataFrame({
        'Company_Database': ['APPLE', 'SAMSUNG', 'MICROSOFT', 'TOYOTA', 'NIKE']
    })
    
    print("SOLVING REAL BUSINESS PROBLEMS: COMPANY ORDER AGGREGATION")
    print("=" * 70)
    
    # Initialize solver
    aggregator = CompanyOrderVolumeAggregator()
    
    # Process data
    print("\\\\nProcessing company order data...")
    results = aggregator.process_business_data(
        order_data=order_data,
        canonical_db= canonical_db,
        threshold=0.4,
        ignore_common=True,
        strict_mode=False
    )
    
    return results

if __name__ == "__main__":
    # Run demonstration
    results = demonstrate_real_world_solution()`;

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            // Event listeners
            document.getElementById('browseBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            document.getElementById('useSampleData').addEventListener('click', useSampleData);
            document.getElementById('downloadSample').addEventListener('click', downloadSampleFile);

            // Drag & drop
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', e => {
                e.preventDefault();
                uploadArea.classList.add('border-indigo-400', 'bg-indigo-50');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
            });
            uploadArea.addEventListener('drop', e => {
                e.preventDefault();
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
                if (e.dataTransfer.files.length) {
                    document.getElementById('fileInput').files = e.dataTransfer.files;
                    handleFileUpload({target: {files: e.dataTransfer.files}});
                }
            });

            document.getElementById('threshold').addEventListener('input', function() {
                document.getElementById('thresholdValue').textContent = this.value;
            });

            // Export buttons
            document.getElementById('exportSummary').addEventListener('click', exportSummary);
            document.getElementById('exportDetails').addEventListener('click', exportDetails);
            document.getElementById('exportUnmatched').addEventListener('click', exportUnmatched);

            // Run button
            document.getElementById('runBtn').addEventListener('click', runMatching);

            // Reset process button
            document.getElementById('resetProcess').addEventListener('click', resetProcess);

            // Python code buttons
            document.getElementById('copyPythonCode').addEventListener('click', copyPythonCode);
            document.getElementById('downloadPythonCode').addEventListener('click', downloadPythonCode);

            // Load Python code with syntax highlighting
            loadPythonCode();
        });

        // Functions
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            fileName.textContent = `${file.name} (${(file.size/1024).toFixed(2)} KB)`;
            fileInfo.classList.remove('hidden');

            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    if (!workbook.Sheets['Order']) throw new Error('Order sheet not found');
                    if (!workbook.Sheets['Database']) throw new Error('Database sheet not found');
                    
                    const orderSheet = workbook.Sheets['Order'];
                    const orderJson = XLSX.utils.sheet_to_json(orderSheet, {header:1});
                    orderData = orderJson.slice(1).filter(row => row.length >= 2).map(row => [row[0], row[1]]);
                    
                    const dbSheet = workbook.Sheets['Database'];
                    const dbJson = XLSX.utils.sheet_to_json(dbSheet, {header:1});
                    database = dbJson.slice(1).map(row => row[0]).filter(i => i);
                    
                    showAlert('File imported successfully!', 'success');
                    updateStepProgress(1);
                } catch (error) {
                    showAlert(`Error processing file: ${error.message}`, 'error');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function useSampleData() {
            orderData = [...defaultOrderData];
            database = [...defaultDatabase];
            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('fileName').textContent = 'Using sample data';
            showAlert('Sample data loaded successfully!', 'success');
            
            // Enable processing immediately with sample data
            document.getElementById('statsRow').style.display = 'grid';
            document.getElementById('configCard').style.display = 'block';
            document.getElementById('exportCard').style.display = 'block';
            document.getElementById('chartCard').style.display = 'block';
            document.getElementById('resultsCard').style.display = 'block';
            
            updateStepProgress(1);
        }

        function updateStepProgress(step) {
            // Update step indicators
            const stepUpload = document.getElementById('step-upload');
            const stepProcess = document.getElementById('step-process');
            const stepResults = document.getElementById('step-results');
            
            const connector1 = document.getElementById('connector-fill-1');
            const connector2 = document.getElementById('connector-fill-2');
            
            const stepProgressFill = document.getElementById('step-progress-fill');
            const stepStatus = document.getElementById('step-status');
            const stepPercentage = document.getElementById('step-percentage');
            
            // Reset all steps first
            stepUpload.classList.remove('opacity-50');
            stepProcess.classList.add('opacity-50');
            stepResults.classList.add('opacity-50');
            
            stepUpload.querySelector('div:first-child').classList.remove('bg-gray-300');
            stepUpload.querySelector('div:first-child').classList.add('bg-indigo-600', 'step-pulse');
            stepProcess.querySelector('div:first-child').classList.remove('bg-indigo-600', 'step-pulse');
            stepProcess.querySelector('div:first-child').classList.add('bg-gray-300');
            stepResults.querySelector('div:first-child').classList.remove('bg-indigo-600', 'step-pulse');
            stepResults.querySelector('div:first-child').classList.add('bg-gray-300');
            
            connector1.style.width = '0%';
            connector2.style.width = '0%';
            
            // Update based on step
            if (step >= 1) {
                stepUpload.classList.remove('opacity-50');
                stepUpload.querySelector('div:first-child').classList.remove('bg-gray-300');
                stepUpload.querySelector('div:first-child').classList.add('bg-indigo-600');
                stepStatus.textContent = 'Data uploaded successfully. Ready to configure processing.';
                stepPercentage.textContent = '33%';
                stepProgressFill.style.width = '33%';
                
                // Show configuration card
                document.getElementById('configCard').style.display = 'block';
                document.getElementById('processingStatusCard').style.display = 'none';
            }
            
            if (step >= 2) {
                stepProcess.classList.remove('opacity-50');
                stepProcess.querySelector('div:first-child').classList.remove('bg-gray-300');
                stepProcess.querySelector('div:first-child').classList.add('bg-indigo-600', 'step-pulse');
                connector1.style.width = '100%';
                stepStatus.textContent = 'Processing configuration complete. Running matching algorithm...';
                stepPercentage.textContent = '66%';
                stepProgressFill.style.width = '66%';
                
                // Show processing status
                document.getElementById('processingStatusCard').style.display = 'block';
            }
            
            if (step >= 3) {
                stepResults.classList.remove('opacity-50');
                stepResults.querySelector('div:first-child').classList.remove('bg-gray-300');
                stepResults.querySelector('div:first-child').classList.add('bg-indigo-600');
                connector2.style.width = '100%';
                stepStatus.textContent = 'Processing complete! Results are ready for analysis.';
                stepPercentage.textContent = '100%';
                stepProgressFill.style.width = '100%';
                
                // Show results and export options
                document.getElementById('statsRow').style.display = 'grid';
                document.getElementById('chartCard').style.display = 'block';
                document.getElementById('resultsCard').style.display = 'block';
                document.getElementById('exportCard').style.display = 'block';
                document.getElementById('processingStatusCard').style.display = 'none';
            }
        }

        function downloadSampleFile(e) {
            e.preventDefault();
            const wb = XLSX.utils.book_new();
            const orderSheetData = [['Company Names','Order Volume'], ...defaultOrderData];
            const dbSheetData = [['Company Database'], ...defaultDatabase.map(name => [name])];
            
            const orderSheet = XLSX.utils.aoa_to_sheet(orderSheetData);
            const dbSheet = XLSX.utils.aoa_to_sheet(dbSheetData);
            
            XLSX.utils.book_append_sheet(wb, orderSheet, 'Order');
            XLSX.utils.book_append_sheet(wb, dbSheet, 'Database');
            XLSX.writeFile(wb, 'company_order_sample.xlsx');
        }

        function showAlert(message, type) {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white ${colors[type]} transition-opacity duration-300 z-50`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('opacity-0');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 3000);
        }

        // Tokenize and similarity functions
        function tokenize(name, ignoreCommon) {
            let tokens = String(name).toUpperCase().split(/\s+/);
            if (ignoreCommon) {
                tokens = tokens.filter(t => !commonTerms.includes(t));
            }
            return tokens;
        }

        function similarity(tokensA, tokensB) {
            const setA = new Set(tokensA);
            const setB = new Set(tokensB);
            const inter = [...setA].filter(x => setB.has(x)).length;
            const union = new Set([...setA, ...setB]).size;
            return union === 0 ? 0 : inter / union;
        }

        function fuzzyMatch(name, candidates, threshold, ignoreCommon, strict) {
            const tokensName = tokenize(name, ignoreCommon);
            let bestMatch = null;
            let bestScore = 0;
            
            for (const candidate of candidates) {
                const tokensCandidate = tokenize(candidate, ignoreCommon);
                let score = 0;
                
                if (strict) {
                    const subset = tokensName.every(t => tokensCandidate.includes(t)) || 
                                  tokensCandidate.every(t => tokensName.includes(t));
                    score = subset ? 1 : 0;
                } else {
                    score = similarity(tokensName, tokensCandidate);
                }
                
                if (score > bestScore) {
                    bestMatch = candidate;
                    bestScore = score;
                }
            }
            
            return (bestScore >= threshold) ? { match: bestMatch, score: bestScore } : null;
        }

        let matchedResults = [];
        let unmatchedResults = [];

        function runMatching() {
            const threshold = parseFloat(document.getElementById('threshold').value);
            const ignoreCommon = document.getElementById('ignoreCommonTerms').checked;
            const strict = document.getElementById('enableStrictMatching').checked;
            
            // Update to step 2
            updateStepProgress(2);
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loadingOverlay');
            const progressFill = document.getElementById('progressFill');
            const processingProgress = document.getElementById('processingProgress');
            const processingPercent = document.getElementById('processingPercent');
            const matchingStatus = document.getElementById('matchingStatus');
            
            loadingOverlay.classList.add('active');
            progressFill.style.width = '0%';
            processingProgress.style.width = '0%';
            processingPercent.textContent = '0%';
            
            // Use setTimeout to allow the UI to update before processing
            setTimeout(() => {
                matchedResults = [];
                unmatchedResults = [];
                
                // Simulate processing with progress updates
                let progress = 0;
                const totalSteps = orderData.length;
                const progressInterval = setInterval(() => {
                    progress += 1;
                    const percent = Math.min(100, Math.round((progress / totalSteps) * 100));
                    progressFill.style.width = `${percent}%`;
                    processingProgress.style.width = `${percent}%`;
                    processingPercent.textContent = `${percent}%`;
                    
                    if (progress >= totalSteps * 0.3) {
                        matchingStatus.textContent = 'Matching completed, aggregating results...';
                    }
                    
                    if (progress >= totalSteps) {
                        clearInterval(progressInterval);
                        
                        // Process actual matching
                        for (const [name, volume] of orderData) {
                            const res = fuzzyMatch(name, database, threshold, ignoreCommon, strict);
                            if (res) {
                                matchedResults.push({
                                    original: name,
                                    matchedTo: res.match,
                                    volume,
                                    score: res.score
                                });
                            } else {
                                // Try to find a suggested match with lower threshold
                                const suggestion = fuzzyMatch(name, database, 0.2, ignoreCommon, false);
                                unmatchedResults.push({
                                    original: name,
                                    volume,
                                    suggested: suggestion ? suggestion.match : null
                                });
                            }
                        }
                        
                        // Update UI with results
                        updateStats();
                        updateTabs();
                        showTabs();
                        
                        // Update to step 3
                        updateStepProgress(3);
                        
                        // Hide loading overlay
                        setTimeout(() => {
                            loadingOverlay.classList.remove('active');
                        }, 500);
                    }
                }, 50);
            }, 500);
        }

        function updateStats() {
            const totalCompanies = new Set(orderData.map(i => i[0])).size;
            const matchedCount = matchedResults.length;
            const totalVolume = orderData.reduce((acc, cur) => acc + cur[1], 0);
            
            document.getElementById('totalCompanies').textContent = totalCompanies.toLocaleString();
            document.getElementById('matchRate').textContent = ((matchedCount / orderData.length)*100).toFixed(1) + '%';
            document.getElementById('totalVolume').textContent = totalVolume.toLocaleString();
            
            document.getElementById('summaryCountTab').textContent = Object.keys(summaryMap).length;
            document.getElementById('matchedCountTab').textContent = matchedCount.toLocaleString();
            document.getElementById('unmatchedCountTab').textContent = unmatchedResults.length.toLocaleString();
        }

        let summaryMap = {};

        function updateTabs() {
            summaryMap = {};
            matchedResults.forEach(({ matchedTo, volume }) => {
                if (!summaryMap[matchedTo]) summaryMap[matchedTo] = { count: 0, totalVolume: 0 };
                summaryMap[matchedTo].count++;
                summaryMap[matchedTo].totalVolume += volume;
            });

            // Summary Table
            const summaryBody = document.getElementById('summaryTableBody');
            summaryBody.innerHTML = '';
            const totalVolume = orderData.reduce((acc, cur) => acc + cur[1], 0);
            
            for (const [company, stats] of Object.entries(summaryMap)) {
                const avgVol = (stats.totalVolume / stats.count).toFixed(1);
                const pct = ((stats.totalVolume / totalVolume)*100).toFixed(1);
                
                summaryBody.insertAdjacentHTML('beforeend', `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${company}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${stats.count}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${stats.totalVolume.toLocaleString()}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${avgVol}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${pct}%</td>
                    </tr>
                `);
            }

            // Details Table
            const detailsBody = document.getElementById('detailsTableBody');
            detailsBody.innerHTML = '';
            
            if (matchedResults.length === 0) {
                detailsBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-400">No successful matches found above the minimum score.</td></tr>';
            } else {
                matchedResults.sort((a, b) => b.score - a.score).forEach(({ original, matchedTo, volume, score }) => {
                    let scoreClass = 'text-green-600';
                    if (score < MEDIUM_THRESHOLD) scoreClass = 'text-yellow-600';
                    if (score < HIGH_THRESHOLD && score >= MEDIUM_THRESHOLD) scoreClass = 'text-blue-600';

                    detailsBody.insertAdjacentHTML('beforeend', `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${original}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${matchedTo}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${volume.toLocaleString()}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm ${scoreClass} font-medium">${(score * 100).toFixed(1)}%</td>
                        </tr>
                    `);
                });
            }

            // Unmatched Table
            const unmatchedBody = document.getElementById('unmatchedTableBody');
            unmatchedBody.innerHTML = '';
            
            if (unmatchedResults.length === 0) {
                unmatchedBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-400">All orders were matched!</td></tr>';
            } else {
                unmatchedResults.sort((a, b) => b.volume - a.volume).forEach(({ original, volume, suggested }) => {
                    unmatchedBody.insertAdjacentHTML('beforeend', `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${original}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700">${volume.toLocaleString()}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm text-red-500">${suggested || 'N/A'}</td>
                            <td class="px-4 py-3 whitespace-nowrap text-sm">
                                <button class="bg-indigo-100 text-indigo-700 py-1 px-3 rounded text-xs font-medium hover:bg-indigo-200 transition-colors">Add to DB</button>
                            </td>
                        </tr>
                    `);
                });
            }

            // Render Chart
            renderChart();
            
            // Enable Export Buttons
            document.getElementById('exportSummary').disabled = false;
            document.getElementById('exportDetails').disabled = false;
            document.getElementById('exportUnmatched').disabled = false;
        }

        function renderChart() {
            const ctx = document.getElementById('matchChart').getContext('2d');
            document.getElementById('noChartData').classList.add('hidden');
            
            // Destroy existing chart if it exists
            if (matchChart) {
                matchChart.destroy();
            }

            // Calculate category stats
            const categoryStats = {
                high: { totalVolume: 0, count: 0 },
                medium: { totalVolume: 0, count: 0 },
                low: { totalVolume: 0, count: 0 },
                unmatched: { totalVolume: 0, count: 0 }
            };

            matchedResults.forEach(({ volume, score }) => {
                if (score >= HIGH_THRESHOLD) {
                    categoryStats.high.totalVolume += volume;
                    categoryStats.high.count++;
                } else if (score >= MEDIUM_THRESHOLD) {
                    categoryStats.medium.totalVolume += volume;
                    categoryStats.medium.count++;
                } else {
                    categoryStats.low.totalVolume += volume;
                    categoryStats.low.count++;
                }
            });

            unmatchedResults.forEach(({ volume }) => {
                categoryStats.unmatched.totalVolume += volume;
                categoryStats.unmatched.count++;
            });

            const dataPoints = [
                categoryStats.high.totalVolume,
                categoryStats.medium.totalVolume,
                categoryStats.low.totalVolume,
                categoryStats.unmatched.totalVolume,
            ];
            
            const totalVolume = orderData.reduce((acc, cur) => acc + cur[1], 0);

            matchChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        `High Match (Score >= ${HIGH_THRESHOLD*100}%)`, 
                        `Medium Match (Score >= ${MEDIUM_THRESHOLD*100}%)`, 
                        `Low Match (Score < ${MEDIUM_THRESHOLD*100}%)`, 
                        'Unmatched'
                    ],
                    datasets: [{
                        label: 'Order Volume Distribution',
                        data: dataPoints,
                        backgroundColor: [
                            '#10b981', // Emerald for High
                            '#3b82f6', // Blue for Medium
                            '#f59e0b', // Amber for Low
                            '#ef4444'  // Red for Unmatched
                        ],
                        hoverOffset: 12,
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 15
                            }
                        },
                        title: {
                            display: true,
                            text: `Total Volume: ${totalVolume.toLocaleString()}`,
                            font: { size: 16, weight: 'bold' },
                            padding: { top: 10, bottom: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const percentage = totalVolume > 0 ? ((value / totalVolume) * 100).toFixed(2) : 0;
                                    return `${context.label}: ${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function showTabs() {
            showTab('summary');
        }

        // Tab Control
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`${tabId}-tab`).classList.remove('hidden');

            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="showTab('${tabId}')"]`).classList.add('active');
        }

        // Export Functions
        function exportSummary() {
            const wb = XLSX.utils.book_new();
            const totalVolume = orderData.reduce((acc, cur) => acc + cur[1], 0);

            const wsData = [
                ['Category', 'Count', 'Volume', '% of Total Volume', 'Average Volume'],
                // High
                ['High Match', 0, 0, '0%', '0'],
                // Medium
                ['Medium Match', 0, 0, '0%', '0'],
                // Low
                ['Low Match', 0, 0, '0%', '0'],
                // Unmatched
                ['Unmatched', unmatchedResults.length, 0, '0%', '0'],
                // Total
                ['TOTAL', orderData.length, totalVolume, '100%', (totalVolume / orderData.length).toFixed(1)],
            ];
            
            // Calculate category stats for export
            const categoryStats = {
                high: { totalVolume: 0, count: 0 },
                medium: { totalVolume: 0, count: 0 },
                low: { totalVolume: 0, count: 0 },
                unmatched: { totalVolume: 0, count: unmatchedResults.length }
            };

            matchedResults.forEach(({ volume, score }) => {
                if (score >= HIGH_THRESHOLD) {
                    categoryStats.high.totalVolume += volume;
                    categoryStats.high.count++;
                } else if (score >= MEDIUM_THRESHOLD) {
                    categoryStats.medium.totalVolume += volume;
                    categoryStats.medium.count++;
                } else {
                    categoryStats.low.totalVolume += volume;
                    categoryStats.low.count++;
                }
            });

            unmatchedResults.forEach(({ volume }) => {
                categoryStats.unmatched.totalVolume += volume;
            });

            // Update the data with actual values
            wsData[1] = ['High Match', categoryStats.high.count, categoryStats.high.totalVolume, 
                         totalVolume > 0 ? ((categoryStats.high.totalVolume / totalVolume) * 100).toFixed(1) + '%' : '0%',
                         categoryStats.high.count > 0 ? (categoryStats.high.totalVolume / categoryStats.high.count).toFixed(1) : '0'];
            
            wsData[2] = ['Medium Match', categoryStats.medium.count, categoryStats.medium.totalVolume, 
                         totalVolume > 0 ? ((categoryStats.medium.totalVolume / totalVolume) * 100).toFixed(1) + '%' : '0%',
                         categoryStats.medium.count > 0 ? (categoryStats.medium.totalVolume / categoryStats.medium.count).toFixed(1) : '0'];
            
            wsData[3] = ['Low Match', categoryStats.low.count, categoryStats.low.totalVolume, 
                         totalVolume > 0 ? ((categoryStats.low.totalVolume / totalVolume) * 100).toFixed(1) + '%' : '0%',
                         categoryStats.low.count > 0 ? (categoryStats.low.totalVolume / categoryStats.low.count).toFixed(1) : '0'];
            
            wsData[4] = ['Unmatched', categoryStats.unmatched.count, categoryStats.unmatched.totalVolume, 
                         totalVolume > 0 ? ((categoryStats.unmatched.totalVolume / totalVolume) * 100).toFixed(1) + '%' : '0%',
                         categoryStats.unmatched.count > 0 ? (categoryStats.unmatched.totalVolume / categoryStats.unmatched.count).toFixed(1) : '0'];

            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Volume_Summary');
            
            // Add Matched Groups Summary
            const groupWsData = [['Matched Master Name', 'Count', 'Total Volume', 'Avg Volume']];
            
            // Convert summaryMap to array and sort by volume descending
            const groupsArray = Object.entries(summaryMap)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.totalVolume - a.totalVolume);

            groupsArray.forEach(group => {
                groupWsData.push([
                    group.name,
                    group.count,
                    group.totalVolume,
                    (group.totalVolume / group.count).toFixed(1)
                ]);
            });
            
            const groupWs = XLSX.utils.aoa_to_sheet(groupWsData);
            XLSX.utils.book_append_sheet(wb, groupWs, 'Matched_Groups');

            XLSX.writeFile(wb, 'matching_summary.xlsx');
            showAlert('Summary and Group exports complete!', 'success');
        }

        function exportDetails() {
            if (matchedResults.length === 0) {
                showAlert('No matched results to export.', 'warning');
                return;
            }
            const wb = XLSX.utils.book_new();
            const wsData = [['Original Name', 'Matched To', 'Order Volume', 'Match Score (%)']];
            
            matchedResults.forEach(({ original, matchedTo, volume, score }) => {
                wsData.push([original, matchedTo, volume, (score*100).toFixed(2)]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Matched_Details');
            XLSX.writeFile(wb, 'matching_details.xlsx');
            showAlert('Matched Details export complete!', 'success');
        }

        function exportUnmatched() {
            if (unmatchedResults.length === 0) {
                showAlert('No unmatched results to export.', 'warning');
                return;
            }
            const wb = XLSX.utils.book_new();
            const wsData = [['Original Name', 'Order Volume', 'Suggested Match (Below Threshold)']];
            
            unmatchedResults.forEach(({ original, volume, suggested }) => {
                wsData.push([original, volume, suggested || '']);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Unmatched_List');
            XLSX.writeFile(wb, 'matching_unmatched.xlsx');
            showAlert('Unmatched List export complete!', 'success');
        }

        function resetProcess() {
            // Reset all data and UI
            orderData = [];
            database = [];
            matchedResults = [];
            unmatchedResults = [];
            
            // Reset file input
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').classList.add('hidden');
            
            // Reset UI elements
            document.getElementById('configCard').style.display = 'none';
            document.getElementById('exportCard').style.display = 'none';
            document.getElementById('statsRow').style.display = 'none';
            document.getElementById('chartCard').style.display = 'none';
            document.getElementById('resultsCard').style.display = 'none';
            document.getElementById('processingStatusCard').style.display = 'none';
            
            // Reset step progress
            updateStepProgress(0);
            
            showAlert('Process reset. Ready for new analysis.', 'info');
        }

        // Python Code Functions
        function copyPythonCode() {
            navigator.clipboard.writeText(pythonCode).then(() => {
                showAlert('Python code copied to clipboard!', 'success');
            }).catch(err => {
                showAlert('Failed to copy code: ' + err, 'error');
            });
        }

        function downloadPythonCode() {
            const blob = new Blob([pythonCode], { type: 'text/x-python' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'company_order_aggregator.py';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('Python file downloaded!', 'success');
        }

        // Load Python code with syntax highlighting
        function loadPythonCode() {
            const codeContainer = document.getElementById('pythonCode');
            const lines = pythonCode.split('\n');
            
            let html = '';
            lines.forEach((line, index) => {
                const lineNumber = index + 1;
                const highlightedLine = highlightPythonSyntax(line);
                html += `
                    <div class="code-line">
                        <div class="line-number">${lineNumber}</div>
                        <div class="line-content">${highlightedLine}</div>
                    </div>
                `;
            });
            
            codeContainer.innerHTML = html;
        }

        // Enhanced Python syntax highlighting
        function highlightPythonSyntax(line) {
            // Handle empty lines
            if (line.trim() === '') return '&nbsp;';
            
            let highlighted = line;
            
            // Highlight imports first
            highlighted = highlighted.replace(/(import\s+)(\w+)/g, '$1<span class="import">$2</span>');
            highlighted = highlighted.replace(/(from\s+)(\w+)(\s+import)/g, '$1<span class="import">$2</span>$3');
            
            // Highlight comments
            highlighted = highlighted.replace(/(#.*)/g, '<span class="comment">$1</span>');
            
            // Highlight docstrings (triple quotes)
            highlighted = highlighted.replace(/(\"\"\"[\s\S]*?\"\"\"|\'\'\'[\s\S]*?\'\'\')/g, '<span class="docstring">$1</span>');
            
            // Highlight strings
            highlighted = highlighted.replace(/(\"[^\"]*\"|\'[^\']*\')/g, '<span class="string">$1</span>');
            
            // Highlight keywords
            const keywords = ['class', 'def', 'return', 'if', 'else', 'elif', 'for', 'in', 'while', 'import', 'from', 'as', 'try', 'except', 'finally', 'with', 'lambda', 'None', 'True', 'False', 'and', 'or', 'not', 'is', 'self', 'pass', 'break', 'continue'];
            keywords.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                highlighted = highlighted.replace(regex, `<span class="keyword">${keyword}</span>`);
            });
            
            // Highlight class names (after class keyword)
            highlighted = highlighted.replace(/(class\s+)(\w+)/g, '$1<span class="class">$2</span>');
            
            // Highlight function definitions
            highlighted = highlighted.replace(/(def\s+)(\w+)/g, '$1<span class="function">$2</span>');
            
            // Highlight function calls
            highlighted = highlighted.replace(/(\w+)(\s*\()/g, '<span class="function">$1</span>$2');
            
            // Highlight numbers
            highlighted = highlighted.replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
            
            // Replace spaces with non-breaking spaces to preserve indentation
            highlighted = highlighted.replace(/ /g, '&nbsp;');
            highlighted = highlighted.replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
            
            return highlighted;
        }
    </script>
</body>
</html>