<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking Analytics Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a4f7a;
            --primary-light: #2a6fa5;
            --secondary: #2c8c99;
            --accent: #f39c12;
            --accent-light: #f7b755;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --gray-light: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgZmlsbD0idXJsKCNwYXR0ZXJuKSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIvPjwvc3ZnPg==');
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .date-range {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .date-range select {
            border: none;
            background: transparent;
            font-weight: 500;
        }
        
        .nav-tabs {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 5px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .tab {
            padding: 12px 25px;
            background-color: white;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
        }
        
        .tab:hover {
            background-color: var(--light);
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 8px rgba(26, 79, 122, 0.2);
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-light);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h2 i {
            color: var(--accent);
        }
        
        h3 {
            color: var(--secondary);
            margin: 20px 0 15px;
            font-size: 1.4rem;
        }
        
        h4 {
            color: var(--dark);
            margin: 15px 0 10px;
            font-size: 1.2rem;
        }
        
        .card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--accent);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card.star {
            border-left: 4px solid var(--primary);
        }
        
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 25px 0;
        }
        
        .chart-container-large {
            position: relative;
            height: 400px;
            margin: 25px 0;
        }
        
        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--gray);
            font-style: italic;
        }
        
        .insight-box {
            background-color: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }
        
        .recommendation {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--primary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f7fd;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #a0aec0;
            position: sticky;
            top: 0;
            background: #2d3748;
            z-index: 10;
            padding: 10px 0;
        }
        
        .copy-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s ease;
        }
        
        .copy-btn:hover {
            background-color: var(--accent-light);
        }
        
        .analysis-step {
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            margin-right: 15px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .grid-3col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--warning);
            margin: 15px 0;
        }
        
        .warning {
            background-color: #f8d7da;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--danger);
            margin: 15px 0;
        }
        
        .success {
            background-color: #d1edff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--success);
            margin: 15px 0;
        }
        
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            min-width: 150px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 25px;
            color: var(--dark);
            font-size: 0.9rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            padding: 3px 8px;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        .trend-up {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .trend-down {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab {
                width: 100%;
                margin: 5px 0;
                justify-content: center;
            }
            
            .metrics-container {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 10px 12px;
            }
            
            .grid-2col, .grid-3col {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> Banking Analytics Dashboard</h1>
            <p class="subtitle">Analysis of Customer Segmentation, Risk Assessment & Performance Metrics</p>
        </header>
        
        <div class="dashboard-header">
            <div class="date-range">
                <i class="fas fa-calendar-alt"></i>
                <select id="timeRange">
                    <option>Last 30 Days</option>
                    <option selected>Last 90 Days</option>
                    <option>Last 6 Months</option>
                    <option>Last Year</option>
                </select>
            </div>
            <div class="filter-bar">
                <select class="filter-select" id="segmentFilter">
                    <option>All Segments</option>
                    <option>Bronze</option>
                    <option>Silver</option>
                    <option>Gold</option>
                    <option>Platinum</option>
                </select>
                <select class="filter-select" id="productFilter">
                    <option>All Products</option>
                    <option>Savings Accounts</option>
                    <option>Current Accounts</option>
                    <option>Loans</option>
                </select>
                <button class="copy-btn" id="applyFilters">
                    <i class="fas fa-filter"></i> Apply Filters
                </button>
            </div>
        </div>
        
        <div class="nav-tabs">
            <button class="tab active" data-tab="overview"><i class="fas fa-tachometer-alt"></i> Executive Overview</button>
            <button class="tab" data-tab="data-quality"><i class="fas fa-database"></i> Data Quality</button>
            <button class="tab" data-tab="segmentation"><i class="fas fa-users"></i> Customer Segmentation</button>
            <button class="tab" data-tab="risk"><i class="fas fa-shield-alt"></i> Risk Analysis</button>
            <button class="tab" data-tab="performance"><i class="fas fa-chart-bar"></i> Branch Performance</button>
            <button class="tab" data-tab="experience"><i class="fas fa-comments"></i> Customer Experience</button>
            <button class="tab" data-tab="sql"><i class="fas fa-database"></i> SQL Worksheet</button>
            <button class="tab" data-tab="python"><i class="fab fa-python"></i> Python Analysis</button>
            <button class="tab" data-tab="recommendations"><i class="fas fa-lightbulb"></i> Recommendations</button>
        </div>
        
        <!-- EXECUTIVE OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <h2><i class="fas fa-tachometer-alt"></i> Executive Overview</h2>
            
            <div class="card star">
                <h3>Business Performance Summary</h3>
                <p>This dashboard provides a comprehensive analysis of our banking operations, customer segments, risk exposure, and strategic opportunities based on data from 5,000 customers across 99 branches.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Total Customers</h3>
                    <div class="metric-value">5,000</div>
                    <p>Analyzed in dataset</p>
                </div>
                
                <div class="metric-card">
                    <h3>Total Balance</h3>
                    <div class="metric-value">$25.3M</div>
                    <p>Across all accounts</p>
                </div>
                
                <div class="metric-card">
                    <h3>Avg Balance</h3>
                    <div class="metric-value">$5,060</div>
                    <p>Per customer</p>
                </div>
                
                <div class="metric-card">
                    <h3>Total Branches</h3>
                    <div class="metric-value">99</div>
                    <p>In operation</p>
                </div>
            </div>
            
            <div class="grid-2col">
                <div class="card">
                    <h3>Key Business Metrics</h3>
                    <ul>
                        <li>Total Account Balance: $25,302,854.59</li>
                        <li>Average Balance per Customer: $5,060.57</li>
                        <li>Total Loans Outstanding: $127,505,214.03</li>
                        <li>Total Risk Exposure: $120,710,887.32</li>
                        <li>High Risk Loan Customers: 4,082 (81.64%)</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>Customer Segmentation Highlights</h3>
                    <ul>
                        <li>Platinum Customers: 207 (4.1%)</li>
                        <li>Deposit Product Potential: 203 customers</li>
                        <li>Dormant Customers: 2,556</li>
                        <li>Star Branches: 41</li>
                        <li>Dog Branches: 38</li>
                    </ul>
                </div>
            </div>
            
            <div class="card">
                <h3>Performance Trends Transaction 2023</h3>
                <div class="chart-container-large">
                    <canvas id="performanceTrendsChart"></canvas>
                </div>
                
                <div class="insight-box">
                    <h4>Performance Insight</h4>
                    <p>The Platinum customer segment, though small at 4.1% of our customer base, represents significant value with an average balance of $8,309.60. Focusing retention efforts on these customers could yield substantial returns.</p>
                </div>
            </div>
        </div>
        
        <!-- DATA QUALITY TAB -->
        <div id="data-quality" class="tab-content">
            <h2><i class="fas fa-database"></i> Data Quality Assessment</h2>
            
            <div class="card star">
                <h3>Data Quality Status</h3>
                <p>Our dataset demonstrates excellent quality with no missing values, enabling robust analysis and reliable insights.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Dataset Shape</h3>
                    <div class="metric-value">5,000 × 40</div>
                    <p>Rows × Columns</p>
                </div>
                
                <div class="metric-card">
                    <h3>Missing Values</h3>
                    <div class="metric-value">0</div>
                    <p>Clean dataset</p>
                </div>
                
                <div class="metric-card">
                    <h3>Data Retention</h3>
                    <div class="metric-value">100%</div>
                    <p>All rows retained</p>
                </div>
            </div>
            
            <div class="success">
                <h4>✓ Data Quality Status: Excellent</h4>
                <p>No missing values detected in the dataset. All 5,000 rows (100%) retained for analysis.</p>
            </div>
            
            <div class="card">
                <h3>Data Quality Visualization</h3>
                <div class="chart-container-large">
                    <canvas id="dataQualityChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- CUSTOMER SEGMENTATION TAB -->
        <div id="segmentation" class="tab-content">
            <h2><i class="fas fa-users"></i> Customer Segmentation Analysis</h2>
            
            <div class="card star">
                <h3>Customer Segmentation Overview</h3>
                <p>Our customer base has been segmented into four value tiers and analyzed across age groups and balance categories to identify opportunities for targeted marketing and service improvements.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Platinum Customers</h3>
                    <div class="metric-value">207</div>
                    <p>4.1% of customer base</p>
                </div>
                
                <div class="metric-card">
                    <h3>Deposit Candidates</h3>
                    <div class="metric-value">203</div>
                    <p>High-value opportunities</p>
                </div>
                
                <div class="metric-card">
                    <h3>Dormant Customers</h3>
                    <div class="metric-value">2,556</div>
                    <p>Reactivation campaign needed</p>
                </div>
            </div>
            
            <div class="grid-2col">
                <div class="card">
                    <h3>Age Group Distribution</h3>
                    <div class="chart-container">
                        <canvas id="ageGroupChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Balance Category Distribution</h3>
                    <div class="chart-container">
                        <canvas id="balanceCategoryChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Customer Value Segmentation</h3>
                <table>
                    <tr>
                        <th>Value Segment</th>
                        <th>Customer Count</th>
                        <th>Avg Balance</th>
                        <th>Median Balance</th>
                        <th>Total Balance</th>
                        <th>Avg Value Score</th>
                    </tr>
                    <tr>
                        <td>Bronze</td>
                        <td>786</td>
                        <td>$1,997.98</td>
                        <td>$1,740.36</td>
                        <td>$1,570,412.49</td>
                        <td>17.12</td>
                    </tr>
                    <tr>
                        <td>Silver</td>
                        <td>2,420</td>
                        <td>$4,666.70</td>
                        <td>$4,663.66</td>
                        <td>$11,293,404.56</td>
                        <td>38.24</td>
                    </tr>
                    <tr>
                        <td>Gold</td>
                        <td>1,587</td>
                        <td>$6,754.22</td>
                        <td>$7,215.51</td>
                        <td>$10,718,950.63</td>
                        <td>59.64</td>
                    </tr>
                    <tr>
                        <td>Platinum</td>
                        <td>207</td>
                        <td>$8,309.60</td>
                        <td>$8,616.42</td>
                        <td>$1,720,086.91</td>
                        <td>81.63</td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>Cross-Sell Opportunity Matrix</h3>
                <table>
                    <tr>
                        <th rowspan="2">Age Group</th>
                        <th colspan="2" style="text-align: center;">Customer Count</th>
                        <th colspan="2" style="text-align: center;">Avg Balance</th>
                    </tr>
                    <tr>
                        <th>Current</th>
                        <th>Savings</th>
                        <th>Current</th>
                        <th>Savings</th>
                    </tr>
                    <tr>
                        <td>Young (18-25)</td>
                        <td>411</td>
                        <td>380</td>
                        <td>$4,886.73</td>
                        <td>$5,048.01</td>
                    </tr>
                    <tr>
                        <td>Adult (26-35)</td>
                        <td>492</td>
                        <td>464</td>
                        <td>$4,948.89</td>
                        <td>$5,136.71</td>
                    </tr>
                    <tr>
                        <td>Middle-aged (36-50)</td>
                        <td>717</td>
                        <td>718</td>
                        <td>$4,947.54</td>
                        <td>$5,202.46</td>
                    </tr>
                    <tr>
                        <td>Senior (50+)</td>
                        <td>873</td>
                        <td>945</td>
                        <td>$5,135.38</td>
                        <td>$5,070.83</td>
                    </tr>
                </table>
            </div>
            
            <div class="insight-box">
                <h4>🎯 KEY INSIGHTS - CUSTOMER SEGMENTATION</h4>
                <p>1. 4.1% customers in Platinum segment - premium service focus</p>
                <p>2. 203 customers (4.1%) are prime for deposit products</p>
                <p>3. 2,556 dormant customers - reactivation campaign needed</p>
            </div>
        </div>
        
        <!-- RISK ANALYSIS TAB -->
        <div id="risk" class="tab-content">
            <h2><i class="fas fa-shield-alt"></i> Loan Risk Analysis & Credit Scoring</h2>
            
            <div class="card star">
                <h3>Risk Assessment Overview</h3>
                <p>Our analysis identifies significant risk exposure in the loan portfolio, with over 80% of customers classified as high risk.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Customers with Loans</h3>
                    <div class="metric-value">5,000</div>
                    <p>100% of customer base</p>
                </div>
                
                <div class="metric-card">
                    <h3>High Risk Customers</h3>
                    <div class="metric-value">4,082</div>
                    <p>81.64% of loan portfolio</p>
                </div>
                
                <div class="metric-card">
                    <h3>Loan Exposure</h3>
                    <div class="metric-value">$120.7M</div>
                    <p>Total at risk</p>
                </div>
            </div>
            
            <div class="warning">
                <h4>⚠️ High Risk Alert</h4>
                <p>4,082 customers (81.64% of loan portfolio) identified as high risk with total exposure of $120,710,887.32.</p>
            </div>
            
            <div class="card">
                <h3>Risk Distribution</h3>
                <div class="chart-container-large">
                    <canvas id="riskDistributionChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Risk Exposure by Customer Segment</h3>
                <div class="chart-container-large">
                    <canvas id="riskBySegmentChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- BRANCH PERFORMANCE TAB -->
        <div id="performance" class="tab-content">
            <h2><i class="fas fa-chart-bar"></i> Branch Performance & Profitability Analysis</h2>
            
            <div class="card star">
                <h3>Branch Performance Overview</h3>
                <p>Analysis of 99 branches reveals significant performance disparities, with clear opportunities for optimization and strategic realignment.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Total Branches</h3>
                    <div class="metric-value">99</div>
                    <p>Analyzed</p>
                </div>
                
                <div class="metric-card">
                    <h3>Star Branches</h3>
                    <div class="metric-value">41</div>
                    <p>High performance</p>
                </div>
                
                <div class="metric-card">
                    <h3>Dog Branches</h3>
                    <div class="metric-value">38</div>
                    <p>Strategic review needed</p>
                </div>
            </div>
            
            <div class="card">
                <h3>Branch Performance Distribution</h3>
                <div class="chart-container-large">
                    <canvas id="branchPerformanceChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Top Performing Branches</h3>
                <div class="chart-container-large">
                    <canvas id="topBranchesChart"></canvas>
                </div>
            </div>
            
            <div class="insight-box">
                <h4>🎯 KEY INSIGHTS - BRANCH PERFORMANCE</h4>
                <p>1. 41 'Star' branches (high customers + high balance) - invest for growth</p>
                <p>2. 38 'Dog' branches - strategic review needed</p>
                <p>3. 99 branches exceed 1.0 loan ratio - monitor closely</p>
                <p>4. Top branch generates $357,018 vs bottom $134,487</p>
            </div>
        </div>
        
        <!-- CUSTOMER EXPERIENCE TAB -->
        <div id="experience" class="tab-content">
            <h2><i class="fas fa-comments"></i> Customer Experience & Feedback Intelligence</h2>
            
            <div class="card star">
                <h3>Customer Experience Overview</h3>
                <p>Analysis of customer feedback and churn risk reveals opportunities to improve satisfaction and retention across segments.</p>
            </div>
            
            <div class="metrics-container">
                <div class="metric-card">
                    <h3>Customers with Feedback</h3>
                    <div class="metric-value">5,000</div>
                    <p>100% response rate</p>
                </div>
                
                <div class="metric-card">
                    <h3>Critical Churn Risk</h3>
                    <div class="metric-value">0</div>
                    <p>No critical cases</p>
                </div>
                
                <div class="metric-card">
                    <h3>Avg Resolution Time</h3>
                    <div class="metric-value">-1.3 days</div>
                    <p>Ahead of schedule</p>
                </div>
            </div>
            
            <div class="card">
                <h3>Customer Satisfaction by Segment</h3>
                <div class="chart-container-large">
                    <canvas id="satisfactionChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h3>Feedback Type Breakdown</h3>
                <table>
                    <tr>
                        <th>Feedback Type</th>
                        <th>Count</th>
                        <th>Avg Balance</th>
                        <th>Avg Resolution Days</th>
                        <th>Avg Health Score</th>
                    </tr>
                    <tr>
                        <td>Complaint</td>
                        <td>1,681</td>
                        <td>$5,084.23</td>
                        <td>-0.01</td>
                        <td>60.43</td>
                    </tr>
                    <tr>
                        <td>Praise</td>
                        <td>1,630</td>
                        <td>$5,097.76</td>
                        <td>-2.55</td>
                        <td>90.71</td>
                    </tr>
                    <tr>
                        <td>Suggestion</td>
                        <td>1,689</td>
                        <td>$5,001.14</td>
                        <td>-1.37</td>
                        <td>90.44</td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>Churn Risk Assessment</h3>
                <table>
                    <tr>
                        <th>Churn Risk</th>
                        <th>Count</th>
                        <th>Avg Balance</th>
                        <th>Total Balance at Risk</th>
                    </tr>
                    <tr>
                        <td>Critical</td>
                        <td>0</td>
                        <td>N/A</td>
                        <td>$0.00</td>
                    </tr>
                    <tr>
                        <td>High</td>
                        <td>804</td>
                        <td>$5,027.74</td>
                        <td>$4,042,303.50</td>
                    </tr>
                    <tr>
                        <td>Medium</td>
                        <td>2,441</td>
                        <td>$5,105.80</td>
                        <td>$12,463,265.26</td>
                    </tr>
                    <tr>
                        <td>Low</td>
                        <td>1,755</td>
                        <td>$5,012.70</td>
                        <td>$8,797,285.83</td>
                    </tr>
                </table>
            </div>
            
            <div class="success">
                <h4>✓ CRITICAL ALERT STATUS</h4>
                <p>No customers at CRITICAL churn risk. Total balance at risk: $0.00</p>
            </div>
        </div>
        
        <!-- SQL WORKSHEET TAB -->
        <div id="sql" class="tab-content">
            <h2><i class="fas fa-database"></i> SQL Worksheet</h2>
            
            <div class="card star">
                <h3>SQL Analysis Queries</h3>
                <p>Comprehensive SQL queries used for data extraction and analysis across customer segments, risk assessment, and performance metrics.</p>
            </div>
            
            <div class="card">
                <h3>Customer Activity Analysis (3 Months)</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>SQL Query: Customer Activity Analysis</span>
                        <button class="copy-btn" data-code="sql1">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre><code id="sql1">-- CTE: Determine the latest transaction date as reference
WITH latest_date AS (
    SELECT MAX(transaction_date) AS max_date
    FROM transactions
),

-- 1. Customer Activity (last 3 months)
recent_transactions AS (
    SELECT *
    FROM transactions
    WHERE transaction_date >= (SELECT DATE_SUB(max_date, INTERVAL 3 MONTH) FROM latest_date)
),

customer_activity AS (
    SELECT
        COUNT(DISTINCT customer_id) AS unique_customers,
        COUNT(*) AS total_transactions,
        SUM(amount) AS total_transaction_value
    FROM recent_transactions
),

-- 2. Loan Analysis (last 6 months)
recent_loans AS (
    SELECT *
    FROM loans
    WHERE approval_date >= (SELECT DATE_SUB(max_date, INTERVAL 6 MONTH) FROM latest_date)
),

total_approved_loans AS (
    SELECT COALESCE(SUM(loan_amount), 0) AS total_approved_loan_amount
    FROM recent_loans
),

avg_interest_by_type AS (
    SELECT loan_type, AVG(interest_rate) AS avg_interest_rate
    FROM loans
    GROUP BY loan_type
),

-- 3. Credit Card Insights
credit_utilization_top10 AS (
    SELECT
        customer_id,
        balance / NULLIF(credit_limit, 0) AS credit_utilization_ratio
    FROM credit_cards
    WHERE credit_limit > 0
    ORDER BY credit_utilization_ratio DESC
    LIMIT 10
),

monthly_avg_min_payment AS (
    SELECT
        DATE_FORMAT(transaction_date, '%Y-%m') AS month,
        AVG(minimum_payment_due) AS avg_min_payment
    FROM credit_cards
    GROUP BY month
),

-- 4. Feedback & Resolution
monthly_feedback AS (
    SELECT
        DATE_FORMAT(feedback_date, '%Y-%m') AS month,
        COUNT(*) AS total_feedback,
        ROUND(AVG(CASE WHEN resolution_status = 'Resolved' THEN 1 ELSE 0 END) * 100, 2) AS pct_resolved
    FROM feedback
    GROUP BY month
),

top_3_feedback_types AS (
    SELECT feedback_type, COUNT(*) AS frequency
    FROM feedback
    GROUP BY feedback_type
    ORDER BY frequency DESC
    LIMIT 3
),

-- 5. Anomaly & Fraud Detection
anomaly_summary AS (
    SELECT
        SUM(CASE WHEN is_anomaly = 1 THEN 1 ELSE 0 END) AS anomaly_count,
        ROUND(SUM(CASE WHEN is_anomaly = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) AS pct_anomaly
    FROM transactions
),

branch_with_most_anomalies AS (
    SELECT branch_id, COUNT(*) AS anomaly_count
    FROM transactions
    WHERE is_anomaly = 1
    GROUP BY branch_id
    ORDER BY anomaly_count DESC
    LIMIT 1
)

-- Output all results (as separate result sets for clarity)

-- Section 1: Customer Activity
SELECT '1. Customer Activity (Last 3 Months)' AS section;
SELECT * FROM customer_activity;

-- Section 2a: Total Approved Loans
SELECT '2a. Total Approved Loan Amount (Last 6 Months)' AS section;
SELECT * FROM total_approved_loans;

-- Section 2b: Average Interest Rate by Loan Type
SELECT '2b. Average Interest Rate by Loan Type' AS section;
SELECT * FROM avg_interest_by_type;

-- Section 3a: Top 10 Customers by Credit Utilization
SELECT '3a. Top 10 Customers by Credit Utilization Ratio' AS section;
SELECT * FROM credit_utilization_top10;

-- Section 3b: Monthly Average Minimum Payment
SELECT '3b. Monthly Average Minimum Payment Due' AS section;
SELECT * FROM monthly_avg_min_payment;

-- Section 4a: Monthly Feedback & Resolution Rate
SELECT '4a. Monthly Feedback Volume and Resolution Rate' AS section;
SELECT * FROM monthly_feedback;

-- Section 4b: Top 3 Most Common Feedback Types
SELECT '4b. Top 3 Most Frequent Feedback Types' AS section;
SELECT * FROM top_3_feedback_types;

-- Section 5a: Anomaly Statistics
SELECT '5a. Total Anomalous Transactions and Percentage' AS section;
SELECT * FROM anomaly_summary;

-- Section 5b: Branch with Highest Anomaly Count
SELECT '5b. Branch with the Highest Number of Anomalies' AS section;
SELECT * FROM branch_with_most_anomalies;</code></pre>
                </div>
                
                <div class="insight-box">
                    <h4>Query Insights</h4>
                    <p>This comprehensive SQL analysis covers customer activity, loan analysis, credit card utilization, feedback resolution, and anomaly detection across multiple CTEs for efficient data processing.</p>
                </div>
            </div>
        </div>
        
        <!-- PYTHON ANALYSIS TAB -->
        <div id="python" class="tab-content">
            <h2><i class="fab fa-python"></i> Python Analysis</h2>
            
            <div class="card star">
                <h3>Python Data Analysis Script</h3>
                <p>Complete Python script for comprehensive banking analytics including customer segmentation, risk analysis, and performance metrics.</p>
            </div>
            
            <div class="card">
                <h3>Banking Analytics Python Script</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span>Python Script: Banking Analytics</span>
                        <button class="copy-btn" data-code="python1">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre><code id="python1">import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
from scipy import stats
import warnings
import os

warnings.filterwarnings('ignore')

# Set style for better visualizations
plt.style.use('seaborn-v0_8-darkgrid')
sns.set_palette("husl")

# Load data
try:
    df = pd.read_csv('/content/Comprehensive_Banking_Database.csv')
    
    # Convert date columns to datetime
    date_columns = ['Last Transaction Date', 'Feedback Date', 'Resolution Date']
    for col in date_columns:
        if col in df.columns:
            df[col] = pd.to_datetime(df[col], errors='coerce')
            
except FileNotFoundError:
    print("❌ File tidak ditemukan. Pastikan path file benar.")
    exit()
except Exception as e:
    print(f"❌ Error loading data: {e}")
    exit()

print("=" * 80)
print("COMPREHENSIVE BANKING ANALYTICS - ENHANCED VERSION")
print("=" * 80)

# ============================================================================
# DATA PREPROCESSING & QUALITY CHECK
# ============================================================================
print("\n" + "=" * 80)
print("1. DATA QUALITY ASSESSMENT")
print("=" * 80)

print(f"\nDataset Shape: {df.shape[0]:,} rows × {df.shape[1]} columns")

# Check column existence
required_columns = ['Account Balance', 'Age', 'Account Type']
missing_required = [col for col in required_columns if col not in df.columns]
if missing_required:
    print(f"❌ Missing required columns: {missing_required}")
    exit()

# Missing values analysis
missing_summary = pd.DataFrame({
    'Missing_Count': df.isnull().sum(),
    'Missing_Percentage': (df.isnull().sum() / len(df) * 100).round(2)
})
missing_summary = missing_summary[missing_summary['Missing_Count'] > 0].sort_values('Missing_Percentage', ascending=False)

if len(missing_summary) > 0:
    print("\nMissing Values Summary:")
    print(missing_summary.head(10))
else:
    print("\n✓ No missing values detected")

# Clean dataset (only critical columns)
df_clean = df.dropna(subset=required_columns).copy()
print(f"\n✓ Clean dataset: {df_clean.shape[0]:,} rows retained ({(len(df_clean)/len(df)*100):.1f}%)")

# ============================================================================
# SECTION 1: CUSTOMER SEGMENTATION
# ============================================================================
print("\n" + "=" * 80)
print("2. CUSTOMER SEGMENTATION ANALYSIS")
print("=" * 80)

# Create Age Group if not exists
if 'Age Group' not in df_clean.columns:
    df_clean['Age Group'] = pd.cut(df_clean['Age'], 
                                   bins=[0, 25, 35, 50, 100],
                                   labels=['Young (18-25)', 'Adult (26-35)', 'Middle-aged (36-50)', 'Senior (50+)'])

# Create Balance Category if not exists
if 'Balance Category' not in df_clean.columns:
    balance_quantiles = df_clean['Account Balance'].quantile([0.33, 0.66])
    df_clean['Balance Category'] = pd.cut(df_clean['Account Balance'],
                                         bins=[0, balance_quantiles[0.33], balance_quantiles[0.66], np.inf],
                                         labels=['Low', 'Medium', 'High'])

print(f"\nAge Group Distribution:")
print(df_clean['Age Group'].value_counts().sort_index())

print(f"\nBalance Category Distribution:")
print(df_clean['Balance Category'].value_counts())

# Calculate Recency (days since last transaction)
if 'Last Transaction Date' in df_clean.columns:
    reference_date = df_clean['Last Transaction Date'].max()
    df_clean['Recency_Days'] = (reference_date - df_clean['Last Transaction Date']).dt.days
else:
    # Create synthetic recency if not available
    np.random.seed(42)
    df_clean['Recency_Days'] = np.random.exponential(30, len(df_clean))

# Activity classification - PERBAIKAN: gunakan astype(str) untuk menghindari categorical
activity_labels = ['Active', 'Regular', 'Inactive', 'Dormant']
df_clean['Customer_Activity'] = pd.cut(df_clean['Recency_Days'].astype(float), 
                                      bins=[-1, 30, 90, 180, np.inf],
                                      labels=activity_labels)

# Calculate customer value score - PERBAIKAN: konversi ke float terlebih dahulu
balance_normalized = (df_clean['Account Balance'].astype(float) / 
                     (df_clean['Account Balance'].astype(float).max() + 1e-10) * 40).fillna(0)

# Normalize Transaction Amount if exists
if 'Transaction Amount' in df_clean.columns:
    transaction_normalized = (df_clean['Transaction Amount'].astype(float).fillna(0) / 
                            (df_clean['Transaction Amount'].astype(float).max() + 1e-10) * 30).fillna(0)
else:
    transaction_normalized = pd.Series([0] * len(df_clean), dtype=float)

# Activity bonus - PERBAIKAN: konversi ke string dulu untuk mapping
activity_points = df_clean['Customer_Activity'].astype(str).map({
    'Active': 30, 'Regular': 20, 'Inactive': 10, 'Dormant': 0
}).fillna(0).astype(float)

# PERBAIKAN: Pastikan semua komponen adalah float sebelum penjumlahan
df_clean['Customer_Value_Score'] = (
    balance_normalized.astype(float) + 
    transaction_normalized.astype(float) + 
    activity_points.astype(float)
).clip(0, 100)

# Value Segment classification
df_clean['Value_Segment'] = pd.cut(df_clean['Customer_Value_Score'], 
                                  bins=[0, 25, 50, 75, 100],
                                  labels=['Bronze', 'Silver', 'Gold', 'Platinum'])

# RFM-like Analysis
print("\n--- CUSTOMER VALUE SEGMENTATION ---")
rfm_summary = df_clean.groupby('Value_Segment').agg({
    'Customer ID': 'count',
    'Account Balance': ['mean', 'median', 'sum'],
    'Customer_Value_Score': 'mean'
}).round(2)

# Flatten column names
rfm_summary.columns = ['Customer_Count', 'Avg_Balance', 'Median_Balance', 'Total_Balance', 'Avg_Value_Score']
print(rfm_summary)

# Cross-sell Analysis
print("\n--- CROSS-SELL OPPORTUNITY MATRIX ---")
cross_sell = df_clean.groupby(['Age Group', 'Account Type']).agg({
    'Customer ID': 'count',
    'Account Balance': 'mean'
}).round(2)
cross_sell.columns = ['Customer_Count', 'Avg_Balance']
print(cross_sell.unstack(fill_value=0))

# Deposit Product Opportunity Analysis
print("\n--- DEPOSIT PRODUCT OPPORTUNITY ANALYSIS ---")
balance_75th = df_clean['Account Balance'].quantile(0.75)
deposit_criteria = (
    (df_clean['Account Balance'] > balance_75th) &
    (df_clean['Age'] >= 35) &
    (df_clean['Customer_Activity'].isin(['Active', 'Regular']))
)
deposit_potential = df_clean[deposit_criteria]

print(f"\nHigh-Value Deposit Candidates:")
print(f"  • Total Potential Customers: {len(deposit_potential):,} ({(len(deposit_potential)/len(df_clean)*100):.2f}%)")
print(f"  • Total Potential Deposit Amount: ${deposit_potential['Account Balance'].sum():,.2f}")
print(f"  • Average Balance per Customer: ${deposit_potential['Account Balance'].mean():,.2f}")

deposit_by_age = deposit_potential.groupby('Age Group').agg({
    'Customer ID': 'count',
    'Account Balance': ['mean', 'sum']
}).round(2)
deposit_by_age.columns = ['Count', 'Avg_Balance', 'Total_Potential']
print("\nDeposit Opportunity by Age Group:")
print(deposit_by_age)

# Account Type penetration
account_penetration = df_clean.groupby('Account Type').agg({
    'Customer ID': 'count',
    'Account Balance': ['mean', 'sum']
}).round(2)
account_penetration.columns = ['Customer_Count', 'Avg_Balance', 'Total_Balance']
print("\n--- ACCOUNT TYPE ANALYSIS ---")
print(account_penetration.sort_values('Total_Balance', ascending=False))

# Visualization: Customer Segmentation
fig = plt.figure(figsize=(20, 12))

# Plot 1: Value Segment Distribution
ax1 = plt.subplot(2, 3, 1)
value_counts = df_clean['Value_Segment'].value_counts()
colors = ['#CD7F32', '#C0C0C0', '#FFD700', '#E5E4E2']
wedges, texts, autotexts = ax1.pie(value_counts.values, labels=value_counts.index, 
                                  autopct='%1.1f%%', colors=colors, startangle=90)
for autotext in autotexts:
    autotext.set_color('white')
    autotext.set_fontweight('bold')
ax1.set_title('Customer Value Segmentation', fontsize=14, fontweight='bold')

# Plot 2: Balance Distribution by Age Group
ax2 = plt.subplot(2, 3, 2)
age_order = ['Young (18-25)', 'Adult (26-35)', 'Middle-aged (36-50)', 'Senior (50+)']
df_plot = df_clean[df_clean['Age Group'].isin(age_order)]
sns.boxplot(data=df_plot, x='Age Group', y='Account Balance', order=age_order, ax=ax2)
ax2.set_title('Account Balance Distribution by Age Group', fontsize=14, fontweight='bold')
ax2.set_xlabel('Age Group', fontsize=11)
ax2.set_ylabel('Account Balance ($)', fontsize=11)
ax2.tick_params(axis='x', rotation=45)

# Plot 3: Customer Activity Status
ax3 = plt.subplot(2, 3, 3)
activity_counts = df_clean['Customer_Activity'].value_counts()
colors_activity = ['#2ecc71', '#3498db', '#f39c12', '#e74c3c']
bars = ax3.bar(range(len(activity_counts)), activity_counts.values, color=colors_activity)
ax3.set_xticks(range(len(activity_counts)))
ax3.set_xticklabels(activity_counts.index, rotation=45)
ax3.set_title('Customer Activity Status', fontsize=14, fontweight='bold')
ax3.set_ylabel('Number of Customers', fontsize=11)
for i, bar in enumerate(bars):
    height = bar.get_height()
    ax3.text(bar.get_x() + bar.get_width()/2., height,
            f'{int(height):,}', ha='center', va='bottom', fontsize=9)

# Plot 4: Average Balance by Age Group & Account Type
ax4 = plt.subplot(2, 3, 4)
pivot_data = df_clean.pivot_table(values='Account Balance', index='Age Group', 
                                 columns='Account Type', aggfunc='mean')
pivot_data = pivot_data.reindex(age_order)
pivot_data.plot(kind='bar', ax=ax4, width=0.8)
ax4.set_title('Average Balance by Age Group & Account Type', fontsize=14, fontweight='bold')
ax4.set_xlabel('Age Group', fontsize=11)
ax4.set_ylabel('Average Balance ($)', fontsize=11)
ax4.legend(title='Account Type', fontsize=9, loc='best')
ax4.tick_params(axis='x', rotation=45)

# Plot 5: Customer Value Score Distribution
ax5 = plt.subplot(2, 3, 5)
ax5.hist(df_clean['Customer_Value_Score'], bins=30, color='#9b59b6', alpha=0.7, edgecolor='black')
median_score = df_clean['Customer_Value_Score'].median()
ax5.axvline(median_score, color='red', linestyle='--', linewidth=2,
           label=f'Median: {median_score:.1f}')
ax5.set_title('Customer Value Score Distribution', fontsize=14, fontweight='bold')
ax5.set_xlabel('Value Score', fontsize=11)
ax5.set_ylabel('Frequency', fontsize=11)
ax5.legend()

# Plot 6: Recency vs Balance
ax6 = plt.subplot(2, 3, 6)
scatter = ax6.scatter(df_clean['Recency_Days'], df_clean['Account Balance'], 
                     c=df_clean['Customer_Value_Score'], cmap='viridis', alpha=0.6)
ax6.set_xlabel('Recency (Days)', fontsize=11)
ax6.set_ylabel('Account Balance ($)', fontsize=11)
ax6.set_title('Recency vs Balance (Color = Value Score)', fontsize=14, fontweight='bold')
plt.colorbar(scatter, ax=ax6, label='Customer Value Score')

plt.tight_layout()
plt.show()

# KEY INSIGHTS - Customer Segmentation
print("\n" + "🎯" * 40)
print("KEY INSIGHTS - CUSTOMER SEGMENTATION:")
print("🎯" * 40)
platinum_count = len(df_clean[df_clean['Value_Segment'] == 'Platinum'])
platinum_pct = (platinum_count / len(df_clean)) * 100
dormant_count = len(df_clean[df_clean['Customer_Activity'] == 'Dormant'])
print(f"1. {platinum_pct:.1f}% customers in Platinum segment - premium service focus")
print(f"2. {len(deposit_potential):,} customers ({(len(deposit_potential)/len(df_clean)*100):.1f}%) are prime for deposit products")
print(f"3. {dormant_count:,} dormant customers - reactivation campaign needed")

# ============================================================================
# SECTION 2: LOAN RISK ANALYSIS
# ============================================================================
print("\n" + "=" * 80)
print("3. LOAN RISK ANALYSIS & CREDIT SCORING")
print("=" * 80)

# Check if loan data exists
if 'Loan Amount' in df_clean.columns:
    loan_customers = df_clean[df_clean['Loan Amount'].notna()].copy()
    print(f"\nTotal Customers with Loans: {len(loan_customers):,} ({(len(loan_customers)/len(df_clean)*100):.1f}%)")
    
    # Calculate Risk Metrics
    loan_customers['Debt_to_Balance_Ratio'] = (loan_customers['Loan Amount'] / 
                                              (loan_customers['Account Balance'] + 1))
    
    # Risk flags based on percentiles
    interest_75th = loan_customers['Interest Rate'].quantile(0.75) if 'Interest Rate' in loan_customers.columns else 10
    balance_25th = loan_customers['Account Balance'].quantile(0.25)
    loan_75th = loan_customers['Loan Amount'].quantile(0.75)
    
    loan_customers['High_Interest_Flag'] = (loan_customers['Interest Rate'] > interest_75th).astype(int) if 'Interest Rate' in loan_customers.columns else 0
    loan_customers['Low_Balance_Flag'] = (loan_customers['Account Balance'] < balance_25th).astype(int)
    loan_customers['High_Loan_Flag'] = (loan_customers['Loan Amount'] > loan_75th).astype(int)
    
    # Credit Risk Score (0-100, lower = higher risk)
    debt_ratio_score = (100 - (loan_customers['Debt_to_Balance_Ratio'].clip(0, 5) / 5 * 100)) * 0.4
    interest_score = (100 - loan_customers['High_Interest_Flag'] * 100) * 0.3
    balance_score = (100 - loan_customers['Low_Balance_Flag'] * 100) * 0.2
    loan_size_score = (100 - loan_customers['High_Loan_Flag'] * 100) * 0.1
    
    loan_customers['Credit_Risk_Score'] = (debt_ratio_score + interest_score + 
                                          balance_score + loan_size_score).clip(0, 100)
    
    loan_customers['Risk_Category'] = pd.cut(loan_customers['Credit_Risk_Score'],
                                            bins=[0, 40, 60, 80, 100],
                                            labels=['High Risk', 'Medium Risk', 'Low Risk', 'Very Low Risk'])
    
    # High Risk Customer Identification
    high_risk_customers = loan_customers[
        (loan_customers['Risk_Category'] == 'High Risk') |
        (loan_customers['Debt_to_Balance_Ratio'] > 2)
    ]
    
    print(f"\n--- HIGH RISK CUSTOMERS IDENTIFIED ---")
    print(f"Total High Risk: {len(high_risk_customers):,} ({(len(high_risk_customers)/len(loan_customers)*100):.2f}%)")
    if len(high_risk_customers) > 0:
        print(f"Total Loan Exposure: ${high_risk_customers['Loan Amount'].sum():,.2f}")
    else:
        print("No high risk customers identified")
    
else:
    print("\n⚠️ No loan data available for analysis")
    loan_customers = pd.DataFrame()
    high_risk_customers = pd.DataFrame()

# ============================================================================
# SECTION 3: BRANCH PERFORMANCE ANALYSIS
# ============================================================================
print("\n" + "=" * 80)
print("4. BRANCH PERFORMANCE & PROFITABILITY ANALYSIS")
print("=" * 80)

if 'Branch ID' in df_clean.columns:
    # Branch-level aggregation
    branch_metrics = df_clean.groupby('Branch ID').agg({
        'Customer ID': 'nunique',
        'Account Balance': ['sum', 'mean'],
        'Customer_Value_Score': 'mean'
    }).round(2)
    
    branch_metrics.columns = ['Total_Customers', 'Total_Balance', 'Avg_Balance_per_Customer', 'Avg_Value_Score']
    
    # Add loan metrics if available
    if 'Loan Amount' in df_clean.columns:
        loan_by_branch = df_clean.groupby('Branch ID').agg({
            'Loan Amount': 'sum',
            'Loan ID': 'nunique'
        }).round(2)
        branch_metrics = branch_metrics.merge(loan_by_branch, left_index=True, right_index=True, how='left')
        branch_metrics['Loan_to_Balance_Ratio'] = (branch_metrics['Loan Amount'] / 
                                                 (branch_metrics['Total_Balance'] + 1)).round(4)
    else:
        branch_metrics['Loan_Amount'] = 0
        branch_metrics['Loan_to_Balance_Ratio'] = 0
    
    # Profitability Score
    balance_norm = branch_metrics['Total_Balance'] / (branch_metrics['Total_Balance'].max() + 1e-10)
    cust_norm = branch_metrics['Total_Customers'] / (branch_metrics['Total_Customers'].max() + 1e-10)
    value_norm = branch_metrics['Avg_Value_Score'] / 100
    
    branch_metrics['Profitability_Score'] = (
        (balance_norm * 40) +
        (cust_norm * 30) +
        (value_norm * 30)
    ).round(2) * 100
    
    branch_metrics['Performance_Category'] = pd.cut(branch_metrics['Profitability_Score'],
                                                   bins=[0, 40, 60, 80, 100],
                                                   labels=['Underperforming', 'Average', 'Good', 'Excellent'])
    
    # BCG Matrix classification
    median_customers = branch_metrics['Total_Customers'].median()
    median_balance = branch_metrics['Total_Balance'].median()
    
    def bcg_classify(row):
        if row['Total_Customers'] >= median_customers and row['Total_Balance'] >= median_balance:
            return 'Star'
        elif row['Total_Customers'] < median_customers and row['Total_Balance'] >= median_balance:
            return 'Cash Cow'
        elif row['Total_Customers'] >= median_customers and row['Total_Balance'] < median_balance:
            return 'Question Mark'
        else:
            return 'Dog'
    
    branch_metrics['BCG_Category'] = branch_metrics.apply(bcg_classify, axis=1)
    
    print(f"\nTotal Branches Analyzed: {len(branch_metrics)}")
    print(f"\nPerformance Distribution:")
    print(branch_metrics['Performance_Category'].value_counts().sort_index())
    
    # Visualization: Branch Performance
    fig = plt.figure(figsize=(20, 12))
    
    # Plot 1: BCG Matrix
    ax1 = plt.subplot(2, 3, 1)
    colors_bcg = {'Star': '#2ecc71', 'Cash Cow': '#3498db', 'Question Mark': '#f39c12', 'Dog': '#e74c3c'}
    for category in colors_bcg:
        subset = branch_metrics[branch_metrics['BCG_Category'] == category]
        if len(subset) > 0:
            ax1.scatter(subset['Total_Customers'], subset['Total_Balance'], 
                       label=category, color=colors_bcg[category], s=100, alpha=0.6, 
                       edgecolors='black', linewidth=1)
    ax1.axvline(median_customers, color='black', linestyle='--', alpha=0.5, label='Median Customers')
    ax1.axhline(median_balance, color='black', linestyle='--', alpha=0.5, label='Median Balance')
    ax1.set_xlabel('Total Customers', fontsize=11)
    ax1.set_ylabel('Total Balance ($)', fontsize=11)
    ax1.set_title('BCG Matrix: Branch Portfolio Analysis', fontsize=14, fontweight='bold')
    ax1.legend(fontsize=9, loc='best')
    ax1.grid(True, alpha=0.3)
    
    # Plot 2: Performance Category Distribution
    ax2 = plt.subplot(2, 3, 2)
    perf_counts = branch_metrics['Performance_Category'].value_counts().reindex(
        ['Underperforming', 'Average', 'Good', 'Excellent'], fill_value=0)
    colors_perf = ['#e74c3c', '#f39c12', '#3498db', '#2ecc71']
    bars = ax2.bar(range(len(perf_counts)), perf_counts.values, color=colors_perf)
    ax2.set_xticks(range(len(perf_counts)))
    ax2.set_xticklabels(perf_counts.index, rotation=45)
    ax2.set_ylabel('Number of Branches', fontsize=11)
    ax2.set_title('Branch Performance Category Distribution', fontsize=14, fontweight='bold')
    for i, bar in enumerate(bars):
        height = bar.get_height()
        ax2.text(bar.get_x() + bar.get_width()/2., height,
                f'{int(height)}', ha='center', va='bottom', fontsize=10, fontweight='bold')
    
    # Plot 3: Top Branches by Total Balance
    ax3 = plt.subplot(2, 3, 3)
    top_branches = branch_metrics.nlargest(10, 'Total_Balance')
    colors_bar = ['#2ecc71' if x == 'Excellent' else '#3498db' if x == 'Good' 
                 else '#f39c12' if x == 'Average' else '#e74c3c' 
                 for x in top_branches['Performance_Category']]
    ax3.barh(range(len(top_branches)), top_branches['Total_Balance'], color=colors_bar)
    ax3.set_yticks(range(len(top_branches)))
    ax3.set_yticklabels([f'Branch {idx}' for idx in top_branches.index])
    ax3.set_xlabel('Total Balance ($)', fontsize=11)
    ax3.set_title('Top 10 Branches by Total Balance', fontsize=14, fontweight='bold')
    ax3.invert_yaxis()
    
    # Plot 4: Profitability Score Distribution
    ax4 = plt.subplot(2, 3, 4)
    ax4.hist(branch_metrics['Profitability_Score'], bins=20, color='#2ecc71', 
             alpha=0.7, edgecolor='black')
    median_prof = branch_metrics['Profitability_Score'].median()
    ax4.axvline(median_prof, color='red', linestyle='--', linewidth=2,
               label=f'Median: {median_prof:.1f}')
    ax4.set_xlabel('Profitability Score', fontsize=11)
    ax4.set_ylabel('Frequency', fontsize=11)
    ax4.set_title('Branch Profitability Score Distribution', fontsize=14, fontweight='bold')
    ax4.legend()
    
    # Plot 5: Customer vs Balance Efficiency
    ax5 = plt.subplot(2, 3, 5)
    scatter = ax5.scatter(branch_metrics['Total_Customers'], 
                         branch_metrics['Avg_Balance_per_Customer'],
                         c=branch_metrics['Profitability_Score'], 
                         cmap='RdYlGn', s=100, alpha=0.6, edgecolors='black', linewidth=1)
    ax5.set_xlabel('Total Customers', fontsize=11)
    ax5.set_ylabel('Balance per Customer ($)', fontsize=11)
    ax5.set_title('Customer Count vs Balance Efficiency', fontsize=14, fontweight='bold')
    plt.colorbar(scatter, ax=ax5, label='Profitability Score')
    ax5.grid(True, alpha=0.3)
    
    # Plot 6: Loan-to-Balance Ratio (if available)
    ax6 = plt.subplot(2, 3, 6)
    if 'Loan_to_Balance_Ratio' in branch_metrics.columns and branch_metrics['Loan_to_Balance_Ratio'].sum() > 0:
        loan_ratio_capped = branch_metrics['Loan_to_Balance_Ratio'].clip(0, 2)
        ax6.hist(loan_ratio_capped, bins=20, color='#e67e22', alpha=0.7, edgecolor='black')
        ax6.axvline(0.5, color='yellow', linestyle='--', linewidth=2, label='Caution (0.5)')
        ax6.axvline(1.0, color='red', linestyle='--', linewidth=2, label='High Risk (1.0)')
        ax6.set_xlabel('Loan-to-Balance Ratio', fontsize=11)
        ax6.set_ylabel('Frequency', fontsize=11)
        ax6.set_title('Branch Risk Distribution (Loan-to-Balance)', fontsize=14, fontweight='bold')
        ax6.legend()
    else:
        ax6.text(0.5, 0.5, 'No Loan Data Available', ha='center', va='center', transform=ax6.transAxes, fontsize=12)
        ax6.set_title('Loan-to-Balance Ratio (No Data)', fontsize=14, fontweight='bold')
    
    plt.tight_layout()
    plt.show()
    
    # KEY INSIGHTS - Branch Performance
    print("\n" + "🎯" * 40)
    print("KEY INSIGHTS - BRANCH PERFORMANCE:")
    print("🎯" * 40)
    star_count = len(branch_metrics[branch_metrics['BCG_Category'] == 'Star'])
    dog_count = len(branch_metrics[branch_metrics['BCG_Category'] == 'Dog'])
    if 'Loan_to_Balance_Ratio' in branch_metrics.columns:
        high_risk_branches = (branch_metrics['Loan_to_Balance_Ratio'] > 1).sum()
    else:
        high_risk_branches = 0
    
    print(f"1. {star_count} 'Star' branches (high customers + high balance) - invest for growth")
    print(f"2. {dog_count} 'Dog' branches - strategic review needed")
    print(f"3. {high_risk_branches} branches exceed 1.0 loan ratio - monitor closely")
    print(f"4. Top branch generates ${branch_metrics['Total_Balance'].max():,.0f} vs bottom ${branch_metrics['Total_Balance'].min():,.0f}")
    
else:
    print("⚠️ No branch data available for analysis")
    branch_metrics = pd.DataFrame()

# ============================================================================
# SECTION 4: CUSTOMER EXPERIENCE ANALYSIS
# ============================================================================
print("\n" + "=" * 80)
print("5. CUSTOMER EXPERIENCE & FEEDBACK INTELLIGENCE")
print("=" * 80)

if 'Feedback Type' in df_clean.columns:
    # Filter customers with feedback data
    feedback_customers = df_clean[df_clean['Feedback Type'].notna()].copy()
    print(f"\nTotal Customers with Feedback: {len(feedback_customers):,} ({(len(feedback_customers)/len(df_clean)*100):.2f}%)")
    
    # Calculate resolution time if dates available
    if 'Feedback Date' in feedback_customers.columns and 'Resolution Date' in feedback_customers.columns:
        feedback_customers['Resolution_Time_Days'] = (
            feedback_customers['Resolution Date'] - feedback_customers['Feedback Date']
        ).dt.days
    else:
        feedback_customers['Resolution_Time_Days'] = np.random.randint(1, 30, len(feedback_customers))
    
    # Classify resolution speed
    feedback_customers['Resolution_Speed'] = pd.cut(
        feedback_customers['Resolution_Time_Days'],
        bins=[-np.inf, 1, 3, 7, np.inf],
        labels=['Immediate (<1d)', 'Fast (1-3d)', 'Standard (3-7d)', 'Slow (>7d)']
    )
    
    # Customer Health Score based on feedback (0-100)
    feedback_customers['Customer_Health_Score'] = 100.0
    
    # Deduct points based on feedback type
    feedback_customers.loc[feedback_customers['Feedback Type'] == 'Complaint', 'Customer_Health_Score'] -= 30
    feedback_customers.loc[feedback_customers['Resolution_Speed'] == 'Slow (>7d)', 'Customer_Health_Score'] -= 20
    
    # Ensure score is between 0-100
    feedback_customers['Customer_Health_Score'] = feedback_customers['Customer_Health_Score'].clip(0, 100)
    
    # Churn risk classification
    feedback_customers['Churn_Risk'] = pd.cut(
        feedback_customers['Customer_Health_Score'],
        bins=[0, 40, 60, 80, 100],
        labels=['Critical', 'High', 'Medium', 'Low']
    )
    
    # Feedback Analysis
    print("\n--- FEEDBACK TYPE BREAKDOWN ---")
    feedback_summary = feedback_customers.groupby('Feedback Type').agg({
        'Customer ID': 'count',
        'Account Balance': 'mean',
        'Resolution_Time_Days': 'mean',
        'Customer_Health_Score': 'mean'
    }).round(2)
    feedback_summary.columns = ['Count', 'Avg_Balance', 'Avg_Resolution_Days', 'Avg_Health_Score']
    print(feedback_summary)
    
    # Churn Risk Analysis
    print("\n--- CHURN RISK ASSESSMENT ---")
    churn_risk_summary = feedback_customers.groupby('Churn_Risk').agg({
        'Customer ID': 'count',
        'Account Balance': ['mean', 'sum']
    }).round(2)
    churn_risk_summary.columns = ['Count', 'Avg_Balance', 'Total_Balance_at_Risk']
    print(churn_risk_summary)
    
    critical_churn = feedback_customers[feedback_customers['Churn_Risk'] == 'Critical']
    print(f"\n⚠️  CRITICAL ALERT: {len(critical_churn):,} customers at CRITICAL churn risk")
    print(f"   Total balance at risk: ${critical_churn['Account Balance'].sum():,.2f}")
    
else:
    print("⚠️ No feedback data available for analysis")
    feedback_customers = pd.DataFrame()
    critical_churn = pd.DataFrame()

# ============================================================================
# EXECUTIVE SUMMARY & STRATEGIC RECOMMENDATIONS
# ============================================================================
print("\n" + "=" * 80)
print("6. EXECUTIVE SUMMARY & STRATEGIC RECOMMENDATIONS")
print("=" * 80)

print("\n📊 OVERALL BUSINESS METRICS:")
print(f"  • Total Customers Analyzed: {len(df_clean):,}")
print(f"  • Total Account Balance: ${df_clean['Account Balance'].sum():,.2f}")
print(f"  • Average Balance per Customer: ${df_clean['Account Balance'].mean():,.2f}")

if 'Branch ID' in df_clean.columns:
    print(f"  • Total Branches: {df_clean['Branch ID'].nunique()}")

if 'Loan Amount' in df_clean.columns:
    print(f"  • Total Loans Outstanding: ${df_clean['Loan Amount'].sum():,.2f}")

print("\n💎 CUSTOMER SEGMENTATION HIGHLIGHTS:")
platinum_customers = df_clean[df_clean['Value_Segment'] == 'Platinum']
print(f"  • Platinum Customers: {len(platinum_customers):,} ({(len(platinum_customers)/len(df_clean)*100):.1f}%)")
print(f"  • Platinum Total Value: ${platinum_customers['Account Balance'].sum():,.2f}")
print(f"  • Deposit Product Potential: {len(deposit_potential):,} customers")
print(f"  • Dormant Customers: {len(df_clean[df_clean['Customer_Activity'] == 'Dormant']):,}")

if len(high_risk_customers) > 0:
    print("\n⚠️  RISK MANAGEMENT ALERTS:")
    print(f"  • High Risk Loan Customers: {len(high_risk_customers):,}")
    print(f"  • Total Risk Exposure: ${high_risk_customers['Loan Amount'].sum():,.2f}")

if 'Branch ID' in df_clean.columns and len(branch_metrics) > 0:
    print("\n🏢 BRANCH PERFORMANCE INSIGHTS:")
    star_count = len(branch_metrics[branch_metrics['BCG_Category'] == 'Star']) if 'BCG_Category' in branch_metrics.columns else 0
    dog_count = len(branch_metrics[branch_metrics['BCG_Category'] == 'Dog']) if 'BCG_Category' in branch_metrics.columns else 0
    print(f"  • Star Branches: {star_count}")
    print(f"  • Dog Branches: {dog_count}")

if len(feedback_customers) > 0:
    print("\n👥 CUSTOMER EXPERIENCE STATUS:")
    print(f"  • Critical Churn Risk: {len(critical_churn):,} customers")
    print(f"  • Average Resolution Time: {feedback_customers['Resolution_Time_Days'].mean():.1f} days")

print("\n" + "=" * 80)
print("🎯 STRATEGIC RECOMMENDATIONS")
print("=" * 80)

print("\n1️⃣  CUSTOMER RETENTION & GROWTH:")
print(f"   ✓ Launch targeted deposit campaign for {len(deposit_potential):,} high-balance customers")
print(f"   ✓ Implement VIP service for {len(platinum_customers):,} Platinum customers")
print(f"   ✓ Re-engage {len(df_clean[df_clean['Customer_Activity'] == 'Dormant']):,} dormant customers")

if len(high_risk_customers) > 0:
    print("\n2️⃣  RISK MITIGATION:")
    print(f"   ✓ Immediate review of {len(high_risk_customers):,} high-risk loan accounts")

if len(critical_churn) > 0:
    print("\n3️⃣  CUSTOMER EXPERIENCE:")
    print(f"   ✓ Priority response for {len(critical_churn):,} critical churn customers")

print("\n" + "=" * 80)
print("✅ ANALYSIS COMPLETE - Ready for Executive Presentation")
print("=" * 80)

# ============================================================================
# EXPORT RESULTS
# ============================================================================
print("\n" + "=" * 80)
print("7. EXPORTING RESULTS & ACTIONABLE LISTS")
print("=" * 80)

try:
    # Create output directory
    output_dir = '/content/banking_analysis_output'
    os.makedirs(output_dir, exist_ok=True)
    
    # Export High-Value Customers for Deposit Campaign
    if len(deposit_potential) > 0:
        deposit_campaign_list = deposit_potential[['Customer ID', 'Account Balance', 'Age', 'Age Group', 'Account Type']].copy()
        deposit_campaign_list = deposit_campaign_list.sort_values('Account Balance', ascending=False)
        deposit_file = f'{output_dir}/deposit_campaign_targets.csv'
        deposit_campaign_list.to_csv(deposit_file, index=False)
        print(f"\n✓ Exported {len(deposit_campaign_list):,} deposit campaign targets")
    
    # Export Platinum Customers
    if len(platinum_customers) > 0:
        vip_customers = platinum_customers[['Customer ID', 'Account Balance', 'Customer_Value_Score']].copy()
        vip_customers = vip_customers.sort_values('Customer_Value_Score', ascending=False)
        vip_file = f'{output_dir}/platinum_vip_customers.csv'
        vip_customers.to_csv(vip_file, index=False)
        print(f"✓ Exported {len(vip_customers):,} platinum VIP customers")
    
    # Export High Risk Customers
    if len(high_risk_customers) > 0:
        high_risk_list = high_risk_customers[['Customer ID', 'Account Balance', 'Loan Amount', 'Credit_Risk_Score']].copy()
        high_risk_list = high_risk_list.sort_values('Credit_Risk_Score')
        risk_file = f'{output_dir}/high_risk_loan_customers.csv'
        high_risk_list.to_csv(risk_file, index=False)
        print(f"✓ Exported {len(high_risk_list):,} high-risk loan customers")
    
    # Export Critical Churn Customers
    if len(critical_churn) > 0:
        churn_list = critical_churn[['Customer ID', 'Account Balance', 'Customer_Health_Score']].copy()
        churn_list = churn_list.sort_values('Customer_Health_Score')
        churn_file = f'{output_dir}/critical_churn_risk_customers.csv'
        churn_list.to_csv(churn_file, index=False)
        print(f"✓ Exported {len(churn_list):,} critical churn risk customers")
    
    print(f"\n📁 All files exported to: {output_dir}")
    
except Exception as e:
    print(f"\n⚠️  Error during export: {str(e)}")

print("\n" + "=" * 80)
print("✅ COMPLETE ANALYSIS FINISHED - All Deliverables Ready")
print("=" * 80)</code></pre>
                </div>
                
                <div class="insight-box">
                    <h4>Python Analysis Features</h4>
                    <p>This Python script performs comprehensive banking analytics including data quality assessment, customer segmentation, RFM analysis, risk scoring, branch performance evaluation, and generates actionable insights for strategic decision-making.</p>
                </div>
            </div>
        </div>
        
        <!-- RECOMMENDATIONS TAB -->
        <div id="recommendations" class="tab-content">
            <h2><i class="fas fa-lightbulb"></i> Strategic Recommendations</h2>
            
            <div class="card star">
                <h3>Executive Summary Recommendations</h3>
                <p>Based on comprehensive analysis of customer data and product performance, here are strategic recommendations to increase profitability, reduce risk, and optimize customer experience.</p>
            </div>
            
            <div class="recommendation">
                <h4>1️⃣ CUSTOMER RETENTION & GROWTH</h4>
                <p>✓ Launch targeted deposit campaign for 203 high-balance customers</p>
                <p>✓ Implement VIP service for 207 Platinum customers</p>
                <p>✓ Re-engage 2,556 dormant customers</p>
            </div>
            
            <div class="recommendation">
                <h4>2️⃣ RISK MITIGATION</h4>
                <p>✓ Immediate review of 4,082 high-risk loan accounts</p>
                <p>✓ Enhanced monitoring for branches with high risk exposure</p>
                <p>✓ Update credit scoring model with new risk factors</p>
            </div>
            
            <div class="recommendation">
                <h4>3️⃣ BRANCH OPTIMIZATION</h4>
                <p>✓ Invest in growth strategies for 41 Star branches</p>
                <p>✓ Strategic review of 38 Dog branches</p>
                <p>✓ Implement performance benchmarking across all branches</p>
            </div>
            
            <div class="card">
                <h3>Implementation Roadmap</h3>
                <div class="chart-container-large">
                    <canvas id="roadmapChart"></canvas>
                </div>
            </div>
            
            <div class="success">
                <h4>✅ ANALYSIS COMPLETE - Ready for Executive Presentation</h4>
                <p>✓ Exported 203 deposit campaign targets</p>
                <p>✓ Exported 207 platinum VIP customers</p>
                <p>✓ Exported 4,082 high-risk loan customers</p>
            </div>
        </div>
        
        <footer>
            <p>Banking Analytics Dashboard | Comprehensive Customer Segmentation & Risk Analysis | Kristianto. 2025</p>
        </footer>
    </div>

    <script>
        // Tab navigation functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Set up tab click handlers
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all tab contents
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Show the selected tab content
                    const tabName = this.getAttribute('data-tab');
                    document.getElementById(tabName).classList.add('active');
                    
                    // Initialize charts for the active tab
                    initializeChartsForTab(tabName);
                });
            });
            
            // Initialize charts for the first tab
            initializeChartsForTab('overview');
            
            // Set up filter button
            document.getElementById('applyFilters').addEventListener('click', function() {
                const segmentFilter = document.getElementById('segmentFilter').value;
                const productFilter = document.getElementById('productFilter').value;
                const timeRange = document.getElementById('timeRange').value;
                
                // Show loading state for charts
                document.querySelectorAll('.chart-container canvas').forEach(canvas => {
                    const container = canvas.closest('.chart-container') || canvas.closest('.chart-container-large');
                    const loading = container.querySelector('.chart-loading');
                    if (loading) {
                        loading.style.display = 'flex';
                        canvas.style.display = 'none';
                    }
                });
                
                // Simulate API call delay
                setTimeout(() => {
                    updateChartsWithFilters(segmentFilter, productFilter, timeRange);
                }, 500);
            });
            
            // Set up copy buttons for code blocks
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const codeId = this.getAttribute('data-code');
                    const codeElement = document.getElementById(codeId);
                    const codeText = codeElement.textContent;
                    
                    navigator.clipboard.writeText(codeText).then(() => {
                        // Change button text temporarily
                        const originalText = this.innerHTML;
                        this.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            this.innerHTML = originalText;
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                    });
                });
            });
        });

        // Initialize charts for specific tab
        function initializeChartsForTab(tabName) {
            switch(tabName) {
                case 'overview':
                    initializeOverviewCharts();
                    break;
                case 'data-quality':
                    initializeDataQualityCharts();
                    break;
                case 'segmentation':
                    initializeSegmentationCharts();
                    break;
                case 'risk':
                    initializeRiskCharts();
                    break;
                case 'performance':
                    initializePerformanceCharts();
                    break;
                case 'experience':
                    initializeExperienceCharts();
                    break;
                case 'sql':
                case 'python':
                    // No charts to initialize for code tabs
                    break;
                case 'recommendations':
                    initializeRecommendationsCharts();
                    break;
            }
        }
        
        // Update charts with new filter values (simulated)
        function updateChartsWithFilters(segment, product, timeRange) {
            // In a real application, this would fetch new data and update charts
            // For this demo, we'll just reinitialize the visible charts
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            initializeChartsForTab(activeTab);
        }
        
        // Chart initialization functions
        function initializeOverviewCharts() {
            // Performance Trends Chart
            const trendsCtx = document.getElementById('performanceTrendsChart');
            if (trendsCtx) {
                new Chart(trendsCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: 'New Customers',
                                data: [320, 340, 365, 380, 410, 435, 450, 480, 510, 540, 570, 600],
                                borderColor: '#1a4f7a',
                                backgroundColor: 'rgba(26, 79, 122, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Revenue ($K)',
                                data: [120, 125, 130, 128, 135, 140, 142, 145, 148, 150, 155, 160],
                                borderColor: '#f39c12',
                                backgroundColor: 'rgba(243, 156, 18, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y1'
                            },
                            {
                                label: 'Loan Applications',
                                data: [450, 470, 480, 500, 520, 540, 560, 580, 600, 620, 640, 660],
                                borderColor: '#2c8c99',
                                backgroundColor: 'rgba(44, 140, 153, 0.1)',
                                tension: 0.4,
                                fill: true,
                                yAxisID: 'y'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Monthly Performance Trends'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            if (context.dataset.label.includes('Revenue')) {
                                                label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y * 1000);
                                            } else {
                                                label += context.parsed.y;
                                            }
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Count'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Revenue ($K)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                            }
                        }
                    }
                });
            }
        }
        
        function initializeDataQualityCharts() {
            // Data Quality Chart
            const dataQualityCtx = document.getElementById('dataQualityChart');
            if (dataQualityCtx) {
                new Chart(dataQualityCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Complete Data', 'Missing Values'],
                        datasets: [{
                            data: [100, 0],
                            backgroundColor: ['#1a4f7a', '#e74c3c'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Data Completeness'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }
        
        function initializeSegmentationCharts() {
            // Age Group Chart
            const ageGroupCtx = document.getElementById('ageGroupChart');
            if (ageGroupCtx) {
                new Chart(ageGroupCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Young (18-25)', 'Adult (26-35)', 'Middle-aged (36-50)', 'Senior (50+)'],
                        datasets: [{
                            data: [791, 956, 1435, 1818],
                            backgroundColor: ['#1a4f7a', '#2c8c99', '#f39c12', '#16a085'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Age Group Distribution'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Balance Category Chart
            const balanceCategoryCtx = document.getElementById('balanceCategoryChart');
            if (balanceCategoryCtx) {
                new Chart(balanceCategoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['High (>$7,500)', 'Medium ($2,500-$7,500)', 'Low (<$2,500)'],
                        datasets: [{
                            data: [1200, 1950, 1850],
                            backgroundColor: ['#1a4f7a', '#2c8c99', '#f39c12'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Balance Category Distribution'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }
        
        function initializeRiskCharts() {
            // Risk Distribution Chart
            const riskDistributionCtx = document.getElementById('riskDistributionChart');
            if (riskDistributionCtx) {
                new Chart(riskDistributionCtx, {
                    type: 'pie',
                    data: {
                        labels: ['High Risk', 'Medium Risk', 'Low Risk'],
                        datasets: [{
                            data: [4082, 0, 918],
                            backgroundColor: ['#e74c3c', '#f39c12', '#2c8c99'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Customer Risk Distribution'
                            },
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
            
            // Risk by Segment Chart
            const riskBySegmentCtx = document.getElementById('riskBySegmentChart');
            if (riskBySegmentCtx) {
                new Chart(riskBySegmentCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Bronze', 'Silver', 'Gold', 'Platinum'],
                        datasets: [{
                            label: 'High Risk',
                            data: [650, 2100, 1200, 132],
                            backgroundColor: '#e74c3c'
                        }, {
                            label: 'Low Risk',
                            data: [136, 320, 387, 75],
                            backgroundColor: '#2c8c99'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Risk Exposure by Customer Segment'
                            }
                        },
                        scales: {
                            x: {
                                stacked: false,
                            },
                            y: {
                                stacked: false,
                                title: {
                                    display: true,
                                    text: 'Number of Customers'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function initializePerformanceCharts() {
            // Branch Performance Chart
            const branchPerformanceCtx = document.getElementById('branchPerformanceChart');
            if (branchPerformanceCtx) {
                new Chart(branchPerformanceCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Star', 'Good', 'Average', 'Dog'],
                        datasets: [{
                            label: 'Number of Branches',
                            data: [41, 20, 0, 38],
                            backgroundColor: '#1a4f7a',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Branch Performance Distribution'
                            }
                        }
                    }
                });
            }
            
            // Top Branches Chart
            const topBranchesCtx = document.getElementById('topBranchesChart');
            if (topBranchesCtx) {
                new Chart(topBranchesCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Branch 15', 'Branch 72', 'Branch 33', 'Branch 89', 'Branch 41', 'Branch 7', 'Branch 56', 'Branch 24', 'Branch 68', 'Branch 92'],
                        datasets: [{
                            label: 'Total Balance ($K)',
                            data: [357, 342, 329, 315, 302, 291, 278, 265, 252, 241],
                            backgroundColor: '#1a4f7a'
                        }, {
                            label: 'Number of Customers',
                            data: [85, 78, 92, 76, 81, 69, 74, 63, 71, 68],
                            backgroundColor: '#f39c12',
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Top 10 Performing Branches'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Branch ID'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Total Balance ($K)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Number of Customers'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                            }
                        }
                    }
                });
            }
        }
        
        function initializeExperienceCharts() {
            // Customer Satisfaction Chart
            const satisfactionCtx = document.getElementById('satisfactionChart');
            if (satisfactionCtx) {
                new Chart(satisfactionCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Service Quality', 'Product Range', 'Digital Experience', 'Branch Accessibility', 'Response Time', 'Problem Resolution'],
                        datasets: [{
                            label: 'Bronze',
                            data: [65, 70, 55, 80, 60, 50],
                            backgroundColor: 'rgba(26, 79, 122, 0.2)',
                            borderColor: '#1a4f7a',
                            pointBackgroundColor: '#1a4f7a'
                        }, {
                            label: 'Silver',
                            data: [75, 80, 70, 85, 75, 65],
                            backgroundColor: 'rgba(44, 140, 153, 0.2)',
                            borderColor: '#2c8c99',
                            pointBackgroundColor: '#2c8c99'
                        }, {
                            label: 'Gold',
                            data: [85, 85, 80, 90, 85, 80],
                            backgroundColor: 'rgba(243, 156, 18, 0.2)',
                            borderColor: '#f39c12',
                            pointBackgroundColor: '#f39c12'
                        }, {
                            label: 'Platinum',
                            data: [95, 90, 95, 95, 90, 90],
                            backgroundColor: 'rgba(22, 160, 133, 0.2)',
                            borderColor: '#16a085',
                            pointBackgroundColor: '#16a085'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Customer Satisfaction by Segment'
                            }
                        },
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
            }
        }
        
        function initializeRecommendationsCharts() {
            // Roadmap Chart
            const roadmapCtx = document.getElementById('roadmapChart');
            if (roadmapCtx) {
                new Chart(roadmapCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024'],
                        datasets: [{
                            label: 'Implementation Progress (%)',
                            data: [25, 60, 85, 100],
                            backgroundColor: '#1a4f7a',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: 'Implementation Roadmap'
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>