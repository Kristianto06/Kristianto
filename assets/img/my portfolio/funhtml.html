<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Uji Statistik - Penempatan Section</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Gochi+Hand&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        
        :root {
            --primary-bg: #101827; 
            --chalkboard-bg: #0e141c; 
            --chalkboard-border: #3a4e5a; 
            --text-color: #e0e7ee; 
            --card-bg: rgba(18, 30, 45, 0.7); 
            --card-border: #6ea2b8; 
            --input-border: #6ea2b8; 
            --button-primary-start: #4a789c; 
            --button-primary-end: #3a607e; 
            --highlight-bg: rgba(110, 162, 184, 0.15); 
            --accent-purple: #a7a0de; 
            --accent-gold: #fdd85d; 
            --success-color: #287a55; 
            --error-color: #9a3a3a; 
            
            --chart-curve-color: #9dc2d8; 
            --chart-shading-color: rgba(74, 120, 156, 0.6); 
            --chart-observed-z-label: #c2c0ff; 
            --chart-critical-z-label: #ffe199; 
            --chart-axis-color: #b0c4de; 

            
            --text-primary: #e0e7ee;
            --text-secondary: #a0aec0;
            --success-light: #48bb78;
            --error-light: #f56565;
        }
        body {
            background: linear-gradient(to bottom right, var(--primary-bg), #080d15),
                        url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJjaGFsayIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBwYXR0ZXJuVHJhYW5zZm9ybT0icm90YXRlKDQ1KSI+PHBhdGggZD0iTSAwIDAgTCAxMCAxMCBNIC0xIDUgTCA2IDE1IE0gNSAtMSBMIDE1IDYiIHN0cm9rZT0icmdiYShyZ2JhKDIyNCwyMzEsMjM4LDAuMDcpIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIC8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2NoYWxrKSIgLz48L3N2Zz4=');
            color: var(--text-color);
            font-family: 'Patrick Hand', cursive;
            line-height: 1.6;
        }
        
        .chalkboard {
            background: var(--chalkboard-bg);
            border: 20px solid var(--chalkboard-border);
            border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%233a4e5a"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%232c3f4a" stroke-width="3"/></svg>') 40 stretch;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9);
            position: relative;
            border-radius: 8px;
        }
        
        .chalkboard::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(255, 255, 255, 0.03) 0px,
                    rgba(255, 255, 255, 0.03) 1px,
                    transparent 1px,
                    transparent 40px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255, 255, 255, 0.03) 0px,
                    rgba(255, 255, 255, 0.03) 1px,
                    transparent 1px,
                    transparent 40px
                );
            pointer-events: none;
            border-radius: 8px;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Caveat', cursive;
            color: var(--text-color);
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }
        
        .card {
            background: var(--card-bg);
            border: 3px solid var(--card-border);
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            position: relative;
            transition: all 0.3s ease; /* Animated Transition */
            transform-origin: top; /* Animated Transition */
        }
        .card.calculating { /* Animated Transition */
            transform: scale(0.98);
            opacity: 0.8;
        }
        
        .card::after {
            content: "";
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px dashed rgba(110, 162, 184, 0.25); 
            border-radius: 5px;
            pointer-events: none;
        }
        
        input, select, button {
            font-family: 'Gochi Hand', cursive;
            background: rgba(15, 25, 40, 0.7); /* Disesuaikan dari #0f2319 */
            border: 2px solid var(--input-border);
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            font-size: 1.2rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--card-border); /* Disesuaikan dari #5fbda3 */
            box-shadow: 0 0 12px rgba(110, 162, 184, 0.7); /* Disesuaikan dari #5fbda3 */
        }
        /* Visual feedback for invalid inputs */
        input:invalid, select:invalid {
            border-color: var(--error-color);
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .btn-primary {
            background: linear-gradient(to bottom, var(--button-primary-start), var(--button-primary-end));
            border: 2px solid var(--card-border); /* Disesuaikan dari #5fbda3 */
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
            font-family: 'Caveat', cursive;
            font-size: 1.7rem;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            transition: all 0.2s;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to bottom, var(--card-border), var(--button-primary-start)); /* Disesuaikan dari #5fbda3, #4a9e86 */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        
        .btn-primary::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20px;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(25deg);
            transition: all 0.6s;
        }
        
        .btn-primary:hover::after {
            left: 120%;
        }
        
        .hypothesis {
            font-family: 'Gochi Hand', cursive;
        }
        
        .h0, .h1, .formula {
            background: var(--card-bg); /* Disesuaikan dari #142d23 */
            border: 3px dashed var(--card-border); /* Disesuaikan dari #4a9e86 */
            position: relative;
        }
        
        .h0::before, .h1::before {
            content: "";
            position: absolute;
            top: -7px;
            left: -7px;
            right: -7px;
            bottom: -7px;
            border: 1px solid rgba(110, 162, 184, 0.2); /* Disesuaikan dari #64e6b4 */
            border-radius: 10px;
            pointer-events: none;
        }
        
        .result-value {
            color: var(--accent-gold); /* Updated color for better contrast */
            text-shadow: 0 0 10px rgba(253, 216, 93, 0.5); /* Updated shadow for better contrast */
            font-family: 'Caveat', cursive;
            font-size: 3.8rem;
            margin: 10px 0;
            transition: all 0.5s ease-out; /* Animated Transition */
        }
        
        .conclusion {
            font-family: 'Gochi Hand', cursive;
            background: rgba(30, 41, 59, 0.8); /* Updated background for better contrast */
            border-left: 5px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 8px;
            font-size: 1.2rem;
        }
        
        .highlight {
            background: var(--highlight-bg); /* Disesuaikan dari #64e6b4 */
            border-radius: 4px;
            padding: 2px 6px;
        }
        
        .significance {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .chalk-border {
            border-bottom: 3px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            position: relative;
            padding-bottom: 12px;
        }
        
        .chalk-border::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 120px;
            height: 3px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 2px;
        }
        
        .chalk-line {
            position: relative;
            padding-bottom: 8px;
        }
        
        .chalk-line::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 80%;
            height: 2px;
            background: rgba(110, 162, 184, 0.6); /* Disesuaikan dari #4a9e86 */
            border-radius: 1px;
        }
        
        .chalk-shadow {
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.3), 0 0 8px rgba(255, 255, 255, 0.2);
        }
        
        canvas {
            background: #e1e3e1; /* Disesuaikan dari #0a1e14 */
            border: 2px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 8px;
        }
        
        .footer {
            font-family: 'Caveat', cursive;
            color: var(--card-border); /* Disesuaikan dari #5fbda3 */
            font-size: 1.4rem;
            text-shadow: 0 0 4px rgba(110, 162, 184, 0.5); /* Disesuaikan dari #5fbda3 */
        }
        
        .chalk-effect {
            position: relative;
            display: inline-block;
        }
        
        .chalk-effect::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 2px;
        }
        
        .formula {
            background: rgba(15, 25, 40, 0.7); /* Disesuaikan dari #0f2319 */
            border: 2px dashed var(--card-border); /* Disesuaikan dari #4a9e86 */
            font-size: 1.3rem;
        }
        
        .accent-purple { /* Diganti nama dari pink-accent */
            color: var(--accent-purple); /* Disesuaikan dari #ff9eb5 */
            text-shadow: 0 0 6px rgba(167, 160, 222, 0.5); /* Disesuaikan dari #ff9eb5 */
        }
        
        .accent-gold { /* Diganti nama dari gold-accent */
            color: var(--accent-gold); /* Disesuaikan dari #ffd166 */
            text-shadow: 0 0 6px rgba(253, 216, 93, 0.4); /* Disesuaikan dari #ffd166 */
        }
        
        .chalk-dust {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background: radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.05) 0%, transparent 80%),
                        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 80%);
            z-index: -1;
            border-radius: 8px;
        }
        
        .chalk-underline {
            display: inline-block;
            position: relative;
        }
        
        .chalk-underline::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
        }
        /* Gaya khusus untuk pesan error dan sukses */
        .bg-red-900 { background-color: var(--error-color); }
        .border-red-700 { border-color: var(--error-color); }
        .text-red-200 { color: #ffebeb; } /* Merah muda untuk teks error */
        .bg-green-900 { background-color: var(--success-color); }
        .border-green-700 { border-color: var(--success-color); }
        .text-green-200 { color: #ebffee; } /* Hijau muda untuk teks sukses */
        /* Gambar responsif di header */
        .header-image {
            display: inline-block;
            vertical-align: middle;
            margin-right: 15px; /* Jarak antara gambar dan judul */
            width: 60px; /* Sesuaikan ukuran sesuai kebutuhan */
            height: 60px;
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        /* Gaya SVG untuk gambar menarik */
        .math-doodle {
            stroke: var(--accent-gold); /* Warna emas untuk garis */
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body class="p-4">
    <div class="chalkboard max-w-6xl mx-auto rounded-lg p-6 md:p-8 my-8">
        <div class="chalk-dust"></div>
        
        <header class="text-center mb-10 py-6 relative" role="banner">
            <div class="absolute top-0 left-0 right-0 h-3 bg-gradient-to-r from-transparent via-var(--card-border) to-transparent"></div>
            <h1 class="text-5xl md:text-6xl font-bold mb-2 flex items-center justify-center">
                <span class="chalk-underline">Kalkulator Uji Statistik</span>
            </h1>
            <p class="text-2xl accent-gold">Analisis hubungan penempatan si A dan si B dalam satu section</p>
            <div class="absolute bottom-0 left-0 right-0 h-3 bg-gradient-to-r from-transparent via-var(--card-border) to-transparent"></div>
        </header>
        <main class="main-content grid grid-cols-1 lg:grid-cols-2 gap-8" role="main">
            <!-- Bagian Input -->
            <section class="card p-6 relative" aria-labelledby="input-heading">
                <div class="chalk-dust"></div>
                <h2 id="input-heading" class="text-3xl font-bold mb-6 chalk-border pb-3 accent-purple">
                    <i class="fas fa-sliders-h mr-3"></i>Parameter Uji
                </h2>
                <div id="errorMessage" class="hidden bg-red-900 border-2 border-red-700 text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert" aria-live="assertive">
                    <strong class="font-bold">Kesalahan!</strong>
                    <span class="block sm:inline" id="errorText"></span>
                </div>
                <form id="statsForm" aria-label="Formulir Parameter Uji Statistik">
                    <div class="input-group mb-5">
                        <label for="sectionCount" class="block text-xl mb-2 chalk-line">Jumlah Section Tersedia (N)</label>
                        <input type="number" id="sectionCount" min="2" max="20" value="5" class="w-full p-3 rounded-lg text-xl" aria-required="true" aria-describedby="sectionCountHelp">
                        <small id="sectionCountHelp" class="text-blue-200">Probabilitas acak ($p_0$) akan dihitung otomatis sebagai $1/N$</small>
                    </div>
                    <div class="input-group mb-5">
                        <label for="totalAssignments" class="block text-xl mb-2 chalk-line">Jumlah Penugasan Section (n)</label>
                        <input type="number" id="totalAssignments" min="1" max="100" value="10" class="w-full p-3 rounded-lg text-xl" aria-required="true">
                    </div>
                    <div class="input-group mb-5">
                        <label for="sameSectionCount" class="block text-xl mb-2 chalk-line">Jumlah Kali A dan B Satu Section (k)</label>
                        <input type="number" id="sameSectionCount" min="0" max="100" value="7" class="w-full p-3 rounded-lg text-xl" aria-required="true">
                    </div>
                    <div class="input-group mb-6">
                        <label for="alpha" class="block text-xl mb-2 chalk-line">Tingkat Signifikansi (α)</label>
                        <select id="alpha" class="w-full p-3 rounded-lg text-xl" aria-required="true">
                            <option value="0.01">0.01 (1%)</option>
                            <option value="0.05" selected>0.05 (5%)</option>
                            <option value="0.10">0.10 (10%)</option>
                        </select>
                    </div>
                    <button type="submit" id="calculateBtn" class="btn-primary font-bold py-3 px-6 rounded-lg w-full text-2xl" aria-label="Hitung Statistik">
                        <i class="fas fa-calculator mr-2"></i>
                        <span id="calculateText">Hitung Statistik</span>
                        <span id="calculateSpinner" class="hidden ml-2" role="status" aria-label="Menghitung...">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </form>
            </section>
            <!-- Bagian Hipotesis -->
            <section class="card p-6 relative" aria-labelledby="hypothesis-heading">
                <div class="chalk-dust"></div>
                <h2 id="hypothesis-heading" class="text-3xl font-bold mb-6 chalk-border pb-3 accent-purple">
                    <i class="fas fa-question-circle mr-3"></i>Hipotesis Statistik
                </h2>
                <div class="hypothesis grid grid-cols-1 gap-4">
                    <div class="h0 p-5 rounded-lg">
                        <h4 class="text-red-300 text-2xl font-bold mb-2 flex items-center gap-2">
                            <i class="fas fa-times-circle"></i> Hipotesis Nol (H₀)
                        </h4>
                        <p class="text-xl">Tidak ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section adalah murni kebetulan.</p>
                        <div class="formula font-mono p-3 rounded-md my-3 overflow-x-auto text-xl">
                            $P(X=k) = C(n,k)p^k(1-p)^{n-k}$
                        </div>
                    </div>
                    <div class="h1 p-5 rounded-lg">
                        <h4 class="text-green-300 text-2xl font-bold mb-2 flex items-center gap-2">
                            <i class="fas fa-check-circle"></i> Hipotesis Alternatif (H1: μ ≠ μ₀)
                        </h4>
                        <p class="text-xl">Ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section bukan kebetulan.</p>
                        <div class="formula font-mono p-3 rounded-md my-3 overflow-x-auto text-xl">
                            $p > p_0$
                        </div>
                    </div>
                </div>
                <div class="bg-blue-900 bg-opacity-30 p-6 rounded-xl mt-6 border-2 border-dashed border-var(--card-border)">
                    <h3 class="text-2xl font-bold mb-4 accent-purple">Interpretasi P-value</h3>
                    <p class="text-xl mb-3">P-value adalah probabilitas untuk mendapatkan hasil pengamatan (atau hasil yang lebih ekstrem) jika hipotesis nol (H₀) adalah benar.</p>
                    <ul class="list-disc pl-5 text-xl">
                        <li class="mb-2"><span class="highlight">P-value ≤ 0.05: Menolak H₀, menunjukkan bukti kuat bahwa penempatan tidak acak.</li>
                        <li><span class="highlight">P-value > 0.05: Tidak cukup bukti untuk menolak H₀, penempatan mungkin acak.</li>
                    </ul>
                </div>
            </section>
        </main>
        <!-- Bagian Hasil -->
        <section class="mt-8" role="region" aria-labelledby="results-heading">
            <h2 id="results-heading" class="text-4xl font-bold mb-6 chalk-border pb-3 text-center accent-purple">
                <i class="fas fa-chart-bar mr-3"></i>Hasil Perhitungan Statistik
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6 text-center relative" aria-labelledby="binomial-heading">
                    <div class="chalk-dust"></div>
                    <h3 id="binomial-heading" class="text-3xl font-bold mb-2">Uji Binomial</h3>
                    <p class="text-xl mb-3">Probabilitas kumulatif: f ( k ) = n C k p k (1 -p ) n</p>
                    <div class="result-value" id="binomialResult">-</div>
                    <p class="text-xl">Probabilitas mendapatkan hasil observasi atau lebih ekstrem jika H₀ benar</p>
                    <div id="binomialConclusion" class="conclusion p-4 rounded-lg mt-4 text-xl">Masukkan parameter dan klik "Hitung Statistik"</div>
                    <div class="chart-container mt-4">
                        <canvas id="binomialChart" height="150" role="img" aria-label="Distribusi normal untuk Uji Binomial"></canvas>
                    </div>
                </div>
                <div class="card p-6 text-center relative" aria-labelledby="chisquare-heading">
                    <div class="chalk-dust"></div>
                    <h3 id="chisquare-heading" class="text-3xl font-bold mb-2">Uji Chi-Square</h3>
                    <p class="text-xl mb-3">Statistik Chi-Square: f ( x ) = x k / 2-1 e - x / 2 / (2 k / 2 Γ ( k / 2))</p>
                    <div class="result-value" id="chiSquareResult">-</div>
                    <p class="text-xl">Nilai chi-square dengan derajat kebebasan = 1</p>
                    <div id="chiSquareConclusion" class="conclusion p-4 rounded-lg mt-4 text-xl">Masukkan parameter dan klik "Hitung Statistik"</div>
                    <div class="chart-container mt-4">
                        <canvas id="chiSquareChart" height="150" role="img" aria-label="Distribusi normal untuk Uji Chi-Square"></canvas>
                    </div>
                </div>
            </div>
            <div class="card mt-8 p-6 relative" aria-labelledby="final-conclusion-heading">
                <div class="chalk-dust"></div>
                <h3 id="final-conclusion-heading" class="text-3xl font-bold mb-4 accent-purple">Kesimpulan Analisis</h3>
                <div id="finalConclusion" class="text-xl" aria-live="polite">
                    Silakan masukkan parameter di atas dan klik tombol "Hitung Statistik" untuk melakukan analisis.
                </div>
                <button id="explainAnalysisBtn" class="hidden btn-primary font-bold py-3 px-6 rounded-lg w-full mt-6 text-2xl" aria-label="Jelaskan Hasil Analisis">
                    <i class="fas fa-magic mr-2"></i> ✨  Jelaskan Hasil Analisis
                </button>
            </div>
            <!-- Bagian Penjelasan Lokal -->
            <div id="llmExplanationCard" class="hidden card p-6 mt-6 relative" aria-labelledby="local-explanation-heading">
                <div class="chalk-dust"></div>
                <h2 id="local-explanation-heading" class="text-3xl font-bold mb-5 chalk-border pb-3 accent-purple">
                    <i class="fas fa-book-reader mr-3"></i>Kisah Hubungan A & B (Analisis Lokal)
                </h2>
                <div id="llmExplanationContent" class="prose max-w-none text-xl" aria-live="polite">
                    <div class="flex flex-col justify-center items-center py-10">
                        <i class="fas fa-sync-alt fa-spin text-blue-400 text-4xl mb-4"></i>
                        <p class="text-blue-300 text-2xl">Menganalisis kisah hubungan A & B secara lokal...</p>
                    </div>
                </div>
            </div>
        </section>
        <footer class="text-center py-6 mt-8 border-t border-var(--card-border) border-opacity-30 footer" role="contentinfo">
            <p>Kalkulator Uji Statistik &copy; 2025 | Ditenagai oleh Cinta </p>
        </footer>
    </div>
    <script>
        // Variabel global untuk menyimpan hasil perhitungan terakhir untuk penjelasan
        let lastBinomialPValue = 0;
        let lastChiSquareResult = {};
        let lastAlpha = 0;
        let lastFinalConclusionText = '';
        let lastSectionCount = 0;
        let lastTotalAssignments = 0;
        let lastSameSectionCount = 0;
        let lastP0 = 0;

        /**
         * Fungsi debounce untuk membatasi eksekusi fungsi yang dipicu secara berulang (misalnya, acara resize).
         * @param {Function} func - Fungsi yang akan di-debounce.
         * @param {number} delay - Penundaan dalam milidetik.
         * @returns {Function} Fungsi yang di-debounce.
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            // Menggunakan event listener submit pada form untuk menangani input
            document.getElementById('statsForm').addEventListener('submit', function(e) {
                e.preventDefault(); // Mencegah pengiriman form default
                calculateStatistics();
            });

            // Pengaturan ukuran canvas awal dan menggambar
            resizeCanvas();
            // Menghitung ulang dan menggambar ulang chart jika field input memiliki nilai saat dimuat
            if (document.getElementById('sectionCount').value && document.getElementById('totalAssignments').value && document.getElementById('sameSectionCount').value) {
                calculateStatistics();
            }
        });

        // Menggunakan debounce untuk acara resize
        window.addEventListener('resize', debounce(resizeCanvas, 250));
        document.getElementById('explainAnalysisBtn').addEventListener('click', generateLocalExplanation);
        
        /**
         * Mengatur lebar canvas agar sesuai dengan container induknya dan menggambar ulang chart.
         */
        function resizeCanvas() {
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                const canvas = container.querySelector('canvas');
                if (canvas) {
                    const dpr = window.devicePixelRatio || 1; // Mendapatkan Device Pixel Ratio
                    canvas.width = container.clientWidth * dpr;
                    canvas.height = 150 * dpr; // Tinggi tetap 150px tetapi diskalakan
                    canvas.style.width = `${container.clientWidth}px`; // Mengatur lebar CSS
                    canvas.style.height = '150px'; // Mengatur tinggi CSS
                    canvas.getContext('2d').scale(dpr, dpr); // Menskalakan konteks untuk DPI tinggi
                    
                    // Menggambar ulang chart jika data ada
                    const canvasId = canvas.id;
                    if (canvasId === 'binomialChart' && lastBinomialPValue !== 0) {
                        drawNormalDistributionChart(canvasId, lastBinomialPValue, 'right');
                    } else if (canvasId === 'chiSquareChart' && lastChiSquareResult.pValue !== undefined) {
                        drawNormalDistributionChart(canvasId, lastChiSquareResult.pValue, 'two-tailed');
                    }
                }
            });
        }

        /**
         * Menampilkan pesan error di halaman.
         * @param {string} message - Pesan error yang akan ditampilkan.
         */
        function showErrorMessage(message) {
            const errorMessageDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorMessageDiv.classList.remove('hidden'); // Tampilkan div error
        }

        /**
         * Menyembunyikan pesan error dari halaman.
         */
        function hideErrorMessage() {
            const errorMessageDiv = document.getElementById('errorMessage');
            errorMessageDiv.classList.add('hidden'); // Sembunyikan div error
        }

        /**
         * Memvalidasi semua input form.
         * @returns {boolean} True jika semua input valid, false jika tidak.
         */
        function validateInputs() {
            const sectionCount = parseInt(document.getElementById('sectionCount').value);
            const totalAssignments = parseInt(document.getElementById('totalAssignments').value);
            const sameSectionCount = parseInt(document.getElementById('sameSectionCount').value);

            if (isNaN(sectionCount) || sectionCount < 2) {
                showErrorMessage('Jumlah Section Tersedia harus angka dan minimal 2.');
                return false;
            }
            if (isNaN(totalAssignments) || totalAssignments < 1) {
                showErrorMessage('Jumlah Penugasan Section harus angka dan minimal 1.');
                return false;
            }
            if (isNaN(sameSectionCount) || sameSectionCount < 0 || sameSectionCount > totalAssignments) {
                showErrorMessage('Jumlah Kali A dan B Satu Section harus angka dan tidak boleh melebihi Jumlah Penugasan.');
                return false;
            }
            hideErrorMessage();
            return true;
        }

        /**
         * Fungsi utama untuk menghitung dan menampilkan hasil statistik berdasarkan input pengguna.
         */
        async function calculateStatistics() { 
            // Validasi input terlebih dahulu
            if (!validateInputs()) {
                // Sembunyikan spinner jika validasi gagal
                document.getElementById('calculateText').classList.remove('hidden');
                document.getElementById('calculateSpinner').classList.add('hidden');
                return;
            }

            // Tampilkan spinner loading
            document.getElementById('calculateText').classList.add('hidden');
            document.getElementById('calculateSpinner').classList.remove('hidden');
            document.querySelector('.card:first-child').classList.add('calculating'); // Add calculating class

            // Beri sedikit penundaan agar spinner terlihat
            await new Promise(resolve => setTimeout(resolve, 300)); 

            // Mendapatkan nilai input dari DOM setelah validasi
            const sectionCount = parseInt(document.getElementById('sectionCount').value);
            const totalAssignments = parseInt(document.getElementById('totalAssignments').value);
            const sameSectionCount = parseInt(document.getElementById('sameSectionCount').value);
            const alpha = parseFloat(document.getElementById('alpha').value);

            // Menghitung probabilitas di bawah Hipotesis Nol (H0)
            const p0 = 1 / sectionCount;

            // Melakukan Uji Binomial
            const binomialPValue = binomialTest(totalAssignments, sameSectionCount, p0);
            // Melakukan Uji Chi-Square
            const chiSquareResult = chiSquareTest(totalAssignments, sameSectionCount, p0);

            // Menyimpan hasil dalam variabel global untuk penjelasan lokal
            lastBinomialPValue = binomialPValue;
            lastChiSquareResult = chiSquareResult;
            lastAlpha = alpha;
            lastSectionCount = sectionCount;
            lastTotalAssignments = totalAssignments;
            lastSameSectionCount = sameSectionCount;
            lastP0 = p0;

            // Menampilkan semua hasil dan kesimpulan di UI
            displayResults(binomialPValue, chiSquareResult, alpha);

            // Menggambar chart
            drawNormalDistributionChart('binomialChart', binomialPValue, 'right');
            drawNormalDistributionChart('chiSquareChart', chiSquareResult.pValue, 'two-tailed');

            // Sembunyikan spinner loading
            document.getElementById('calculateText').classList.remove('hidden');
            document.getElementById('calculateSpinner').classList.add('hidden');
            document.querySelector('.card:first-child').classList.remove('calculating'); // Remove calculating class

            // Tampilkan tombol penjelasan
            document.getElementById('explainAnalysisBtn').classList.remove('hidden');
            // Sembunyikan penjelasan sebelumnya
            document.getElementById('llmExplanationCard').classList.add('hidden');
        }

        /* --- STATISTICAL FUNCTIONS (LOGICALLY SEPARATED) --- */

        /**
         * Menghitung fungsi massa probabilitas untuk distribusi binomial: P(X = k).
         * Menggunakan logaritma untuk stabilitas numerik yang lebih baik untuk n besar.
         * Juga menangani kasus p=0 atau p=1 secara eksplisit.
         * @param {number} n - Jumlah percobaan.
         * @param {number} k - Jumlah keberhasilan.
         * @param {number} p - Probabilitas keberhasilan pada satu percobaan.
         * @returns {number} Probabilitas tepat k keberhasilan.
         */
        function binomialProbability(n, k, p) {
            if (p < 0 || p > 1) {
                console.error("Probabilitas p harus antara 0 dan 1.");
                return 0;
            }
            if (k < 0 || k > n) {
                return 0; // Tidak mungkin memiliki keberhasilan kurang dari 0 atau lebih dari n
            }
            if (p === 0) return k === 0 ? 1.0 : 0.0;
            if (p === 1) return k === n ? 1.0 : 0.0;

            // Menghitung log(C(n, k))
            let logCoeff = 0;
            for (let i = 0; i < k; i++) {
                logCoeff += Math.log(n - i) - Math.log(i + 1);
            }
            // Menghitung log(p^k) + log((1-p)^(n-k))
            const logProb = k * Math.log(p) + (n - k) * Math.log(1 - p);
            
            return Math.exp(logCoeff + logProb);
        }

        /**
         * Menghitung probabilitas kumulatif P(X >= k) untuk distribusi binomial.
         * Ini digunakan sebagai p-value untuk uji binomial satu-tailed (upper tail).
         * Menangani kasus edge p=0 atau p=1 dan mencegah overflow.
         * @param {number} n - Jumlah percobaan (total penugasan).
         * @param {number} k - Jumlah keberhasilan (berapa kali A dan B berada di section yang sama).
         * @param {number} p0 - Probabilitas keberhasilan pada satu percobaan di bawah hipotesis nol (1/sectionCount).
         * @returns {number} Probabilitas kumulatif P(X >= k).
         */
        function binomialTest(n, k, p0) {
            if (p0 === 0) return k === 0 ? 1 : 0; // Jika p=0, hanya k=0 yang memiliki prob 1
            if (p0 === 1) return k === n ? 1 : 0; // Jika p=1, hanya k=n yang memiliki prob 1
            
            let sum = 0;
            // Menjumlahkan probabilitas untuk X = k, k+1, ..., n
            for (let i = k; i <= n; i++) {
                sum += binomialProbability(n, i, p0);
                // Mencegah overflow floating point untuk nilai sum yang sangat besar,
                // meskipun probabilitas kumulatif jarang melebihi 1 secara signifikan.
                if (sum > 1e100) break; 
            }
            return Math.min(1, sum); // Pastikan pValue tidak melebihi 1
        }

        /**
         * Fungsi Kepadatan Probabilitas (PDF) untuk distribusi normal standar.
         * @param {number} x - Nilai yang akan dihitung PDF-nya.
         * @returns {number} Kepadatan probabilitas pada x.
         */
        function normalPDF(x) {
            return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
        }

        /**
         * Melakukan uji Chi-Square goodness-of-fit untuk dua kategori (section yang sama vs. section yang berbeda).
         * Ini menghitung statistik chi-square dan p-value yang sesuai (untuk df=1).
         * Untuk df=1, p-value Chi-Square dapat dihitung dari Z-score distribusi normal standar (Chi-square = Z^2).
         * @param {number} n - Total jumlah penugasan.
         * @param {number} observedSame - Jumlah teramati A dan B di section yang sama.
         * @param {number} p0 - Probabilitas yang diharapkan A dan B di section yang sama di bawah H0.
         * @returns {object} Objek yang berisi statistik chi-square, p-value, serta jumlah teramati/diharapkan.
         */
        function chiSquareTest(n, observedSame, p0) {
            // Menghitung frekuensi yang diharapkan di bawah H0
            const expectedSame = n * p0;
            const expectedDifferent = n * (1 - p0);

            // Menghitung frekuensi teramati untuk "section berbeda"
            const observedDifferent = n - observedSame;

            // Tambahkan epsilon kecil untuk mencegah pembagian dengan nol.
            // Sesuai saran, lindungi dari expected sangat kecil, ganti dengan 5 jika terlalu kecil.
            // Meskipun ini adalah praktik umum untuk Chi-Square, perlu diingat
            // bahwa uji Chi-Square mungkin tidak valid untuk frekuensi harapan yang sangat rendah (<5).
            const chiSquare = 
                Math.pow(observedSame - expectedSame, 2) / (expectedSame < 5 && expectedSame > 0 ? 5 : expectedSame || 1e-9) + 
                Math.pow(observedDifferent - expectedDifferent, 2) / (expectedDifferent < 5 && expectedDifferent > 0 ? 5 : expectedDifferent || 1e-9); 
            
            // Untuk distribusi chi-square dengan 1 derajat kebebasan, p-value-nya
            // dapat diturunkan dari Z-score distribusi normal standar (di mana chi-square = Z^2).
            const pValue = 2 * (1 - normalCDF(Math.sqrt(chiSquare)));

            return {
                chiSquare: chiSquare,
                pValue: pValue,
                observedSame: observedSame,
                observedDifferent: observedDifferent,
                expectedSame: expectedSame,
                expectedDifferent: expectedDifferent
            };
        }

        /**
         * Implementasi Normal CDF yang akurat (aproksimasi).
         * Mengembalikan P(Z <= x).
         * @param {number} x - Nilai yang akan dihitung CDF-nya.
         * @returns {number} Probabilitas kumulatif P(Z <= x).
         */
        function normalCDF(x) {
            const t = 1 / (1 + 0.2316419 * Math.abs(x));
            // d = 0.3989423 * Math.exp(-x * x / 2) adalah faktor normalisasi N(0,1) PDF pada x.
            const d = 0.3989423 * Math.exp(-x * x / 2);
            let prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            
            if (x > 0) prob = 1 - prob;
            return prob;
        }

        /**
         * Menghitung Z-score untuk p-value tertentu (kebalikan dari normalCDF).
         */
        function normalInverseCDF(p) {
            if (p < 0.00000000001) return -6;
            if (p > 0.99999999999) return 6;
            const q = p > 0.5 ? 1 - p : p;
            const t = Math.sqrt(-2 * Math.log(q));
            const c0 = 2.515517;
            const c1 = 0.802853;
            const c2 = 0.010328;
            const d1 = 1.432788;
            const d2 = 0.189269;
            const d3 = 0.001308;
            let z = t - ((c0 + c1 * t + c2 * t * t) / (1 + d1 * t + d2 * t * t + d3 * t * t * t));
            if (p < 0.5) {
                z = -z;
            }
            return z;
        }

        /* --- UI UPDATE FUNCTIONS --- */

        /**
         * Menampilkan hasil statistik yang dihitung dan kesimpulan di halaman web.
         */
        function displayResults(binomialPValue, chiSquareResult, alpha) {
            // Perbarui hasil Uji Binomial
            document.getElementById('binomialResult').textContent = binomialPValue.toFixed(6);
            const binomialConclusion = document.getElementById('binomialConclusion');
            binomialConclusion.classList.remove('bg-red-900', 'border-red-700', 'text-red-200', 'bg-green-900', 'border-green-700', 'text-green-200');

            if (binomialPValue < alpha) {
                binomialConclusion.innerHTML = `<strong class="block text-2xl mb-1">Menolak H₀ ($p < \alpha$)</strong>
                    <p class="text-xl">Ada bukti kuat bahwa penempatan A dan B dalam satu section tidak acak.</p>
                    <span class="significance bg-green-900 text-green-200 px-3 py-1 rounded-full mt-2">Signifikan secara statistik</span>`;
                binomialConclusion.classList.add('bg-green-900', 'border-green-700', 'text-green-200');
            } else {
                binomialConclusion.innerHTML = `<strong class="block text-2xl mb-1">Gagal menolak H₀ ($p \ge \alpha$)</strong>
                    <p class="text-xl">Tidak cukup bukti bahwa penempatan A dan B dalam satu section tidak acak.</p>
                    <span class="significance bg-red-900 text-red-200 px-3 py-1 rounded-full mt-2">Tidak signifikan</span>`;
                binomialConclusion.classList.add('bg-red-900', 'border-red-700', 'text-red-200');
            }

            // Perbarui hasil Uji Chi-Square
            document.getElementById('chiSquareResult').textContent = chiSquareResult.chiSquare.toFixed(4);
            const chiSquareConclusion = document.getElementById('chiSquareConclusion');
            chiSquareConclusion.classList.remove('bg-red-900', 'border-red-700', 'text-red-200', 'bg-green-900', 'border-green-700', 'text-green-200');

            if (chiSquareResult.pValue < alpha) {
                chiSquareConclusion.innerHTML = `<strong class="block text-2xl mb-1">Menolak H₀ ($p = ${chiSquareResult.pValue.toFixed(6)}$)</strong>
                    <p class="text-xl">Distribusi observasi berbeda signifikan dari ekspektasi.</p>
                    <span class="significance bg-green-900 text-green-200 px-3 py-1 rounded-full mt-2">Signifikan secara statistik</span>`;
                chiSquareConclusion.classList.add('bg-green-900', 'border-green-700', 'text-green-200');
            } else {
                chiSquareConclusion.innerHTML = `<strong class="block text-2xl mb-1">Gagal menolak H₀ ($p = ${chiSquareResult.pValue.toFixed(6)}$)</strong>
                    <p class="text-xl">Tidak cukup bukti bahwa distribusi observasi berbeda signifikan dari ekspektasi.</p>
                    <span class="significance bg-red-900 text-red-200 px-3 py-1 rounded-full mt-2">Tidak signifikan</span>`;
                chiSquareConclusion.classList.add('bg-red-900', 'border-red-700', 'text-red-200');
            }

            // Tentukan kesimpulan akhir berdasarkan kedua uji
            const finalConclusionElement = document.getElementById('finalConclusion');
            if (binomialPValue < alpha && chiSquareResult.pValue < alpha) {
                lastFinalConclusionText = `Berdasarkan Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) dan Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}), yang keduanya < \alpha (${alpha}), kita memiliki <span class="highlight font-bold">bukti statistik yang kuat untuk menolak Hipotesis Nol.</span> Ini menunjukkan bahwa penempatan A dan B dalam satu section <span class="highlight font-bold">bukanlah kebetulan semata</span> dan kemungkinan ada faktor lain yang mempengaruhinya.`;
            } else if (binomialPValue < alpha && chiSquareResult.pValue >= alpha) {
                lastFinalConclusionText = `Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) menunjukkan hasil signifikan (< \alpha ${alpha}), namun Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}) tidak signifikan. Hal ini mungkin mengindikasikan adanya efek, tetapi dengan dukungan yang tidak konsisten dari kedua metode. Interpretasi lebih lanjut diperlukan.`;
            } else if (binomialPValue >= alpha && chiSquareResult.pValue < alpha) {
                lastFinalConclusionText = `Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}) menunjukkan hasil signifikan (< \alpha ${alpha}), namun Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) tidak signifikan. Ini mungkin terjadi karena perbedaan asumsi antara kedua tes. Interpretasi lebih lanjut diperlukan.`;
            } else {
                lastFinalConclusionText = `Berdasarkan Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) dan Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}), yang keduanya $\ge \alpha$ (${alpha}), kita <span class="highlight font-bold">gagal menolak Hipotesis Nol.</span> Ini berarti tidak ada cukup bukti statistik untuk menyatakan bahwa penempatan A dan B dalam satu section bukanlah kebetulan. Hasil yang diamati mungkin <span class="highlight font-bold">disebabkan oleh peluang acak.</span>`;
            }
            finalConclusionElement.innerHTML = lastFinalConclusionText;
        }

        /**
         * Menggambar kurva distribusi normal pada canvas yang diberikan, menyoroti area p-value.
         */
        function drawNormalDistributionChart(canvasId, pValue, tailType) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = 'var(--chart-curve-color)';
            ctx.lineWidth = 2;
            ctx.font = "12px 'Gochi Hand', cursive";
            ctx.fillStyle = 'var(--text-color)';
            const width = canvas.width / (window.devicePixelRatio || 1); // Sesuaikan lebar gambar berdasarkan DPR
            const height = canvas.height / (window.devicePixelRatio || 1); // Sesuaikan tinggi gambar berdasarkan DPR
            const padding = 20;
            const drawAreaWidth = width - (2 * padding);
            const drawAreaHeight = height - (2 * padding);
            const drawAreaX = padding;
            const drawAreaY = padding;

            const xMin = -3.5;
            const xMax = 3.5;
            const xScale = drawAreaWidth / (xMax - xMin);
            const yMaxDensity = normalPDF(0);
            const yScale = drawAreaHeight / yMaxDensity;

            const centerY = drawAreaY + drawAreaHeight;
            ctx.beginPath();
            ctx.strokeStyle = 'var(--chart-axis-color)';
            ctx.moveTo(drawAreaX, centerY);
            ctx.lineTo(drawAreaX + drawAreaWidth, centerY);
            ctx.stroke();
            ctx.strokeStyle = 'var(--chart-curve-color)';

            ctx.beginPath();
            for (let x = xMin; x <= xMax; x += 0.01) {
                const screenX = drawAreaX + (x - xMin) * xScale;
                const y = normalPDF(x);
                const screenY = centerY - (y * yScale);
                if (x === xMin) {
                    ctx.moveTo(screenX, screenY);
                } else {
                    ctx.lineTo(screenX, screenY);
                }
            }
            ctx.stroke();

            let observedZ = normalInverseCDF(1 - pValue);
            
            ctx.fillStyle = 'var(--chart-shading-color)';
            ctx.beginPath();
            
            if (tailType === 'right') {
                ctx.moveTo(drawAreaX + (observedZ - xMin) * xScale, centerY);
                for (let x = observedZ; x <= xMax; x += 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMax - xMin) * xScale, centerY);
            } else if (tailType === 'left') {
                ctx.moveTo(drawAreaX + (observedZ - xMin) * xScale, centerY);
                for (let x = observedZ; x >= xMin; x -= 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMin - xMin) * xScale, centerY);
            } else if (tailType === 'two-tailed') {
                const absObservedZ = Math.abs(observedZ);
                const zLower = -absObservedZ;
                const zUpper = absObservedZ;

                ctx.moveTo(drawAreaX + (zUpper - xMin) * xScale, centerY);
                for (let x = zUpper; x <= xMax; x += 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMax - xMin) * xScale, centerY);
                ctx.closePath();
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(drawAreaX + (zLower - xMin) * xScale, centerY);
                for (let x = zLower; x >= xMin; x -= 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMin - xMin) * xScale, centerY);
            }
            ctx.closePath();
            ctx.fill();

            ctx.strokeStyle = 'var(--accent-purple)';
            ctx.beginPath();
            const observedZPDF = normalPDF(observedZ);
            ctx.moveTo(drawAreaX + (observedZ - xMin) * xScale, centerY);
            ctx.lineTo(drawAreaX + (observedZ - xMin) * xScale, centerY - (observedZPDF * yScale));
            ctx.stroke();

            const labelXPos = drawAreaX + (observedZ - xMin) * xScale;
            const labelYPos = centerY - (observedZPDF * yScale);
            
            ctx.fillStyle = 'var(--chart-observed-z-label)'; 
            const textYOffset = 15;
            const textXOffset = 5;
            if (labelYPos - textYOffset < drawAreaY) { 
                ctx.fillText(`Z=${observedZ.toFixed(2)}`, labelXPos + textXOffset, labelYPos + textYOffset);
                ctx.fillText(`p=${pValue.toFixed(3)}`, labelXPos + textXOffset, labelYPos + textYOffset + 15);
            } else { 
                ctx.fillText(`Z=${observedZ.toFixed(2)}`, labelXPos + textXOffset, labelYPos - textYOffset);
                ctx.fillText(`p=${pValue.toFixed(3)}`, labelXPos + textXOffset, labelYPos - textYOffset - 15);
            }

            ctx.strokeStyle = 'var(--accent-gold)';
            ctx.beginPath();
            const alpha = parseFloat(document.getElementById('alpha').value);
            
            ctx.fillStyle = 'var(--chart-critical-z-label)';

            if (tailType === 'right') {
                let zCritical = normalInverseCDF(1 - alpha);
                const criticalXPos = drawAreaX + (zCritical - xMin) * xScale;
                const criticalYPos = centerY - (normalPDF(zCritical) * yScale);
                ctx.moveTo(criticalXPos, centerY);
                ctx.lineTo(criticalXPos, criticalYPos);
                ctx.fillText(`Z_crit=${zCritical.toFixed(2)}`, criticalXPos + textXOffset, criticalYPos - textYOffset);
            } else if (tailType === 'two-tailed') {
                const absZCritical = normalInverseCDF(1 - alpha / 2); 
                
                const leftCriticalXPos = drawAreaX + (-absZCritical - xMin) * xScale;
                const leftCriticalYPos = centerY - (normalPDF(-absZCritical) * yScale);
                ctx.moveTo(leftCriticalXPos, centerY);
                ctx.lineTo(leftCriticalXPos, leftCriticalYPos);
                ctx.stroke(); 
                ctx.fillText(`Z_crit=${(-absZCritical).toFixed(2)}`, leftCriticalXPos - 80, leftCriticalYPos - textYOffset);

                ctx.beginPath();
                const rightCriticalXPos = drawAreaX + (absZCritical - xMin) * xScale;
                const rightCriticalYPos = centerY - (normalPDF(absZCritical) * yScale);
                ctx.moveTo(rightCriticalXPos, centerY);
                ctx.lineTo(rightCriticalXPos, rightCriticalYPos);
                ctx.fillText(`Z_crit=${absZCritical.toFixed(2)}`, rightCriticalXPos + textXOffset, rightCriticalYPos - textYOffset);
            }
            ctx.stroke();
        }

        /**
         * Menghasilkan penjelasan untuk hasil analisis statistik secara lokal.
         */
        async function generateLocalExplanation() {
            const llmExplanationCard = document.getElementById('llmExplanationCard');
            const llmExplanationContent = document.getElementById('llmExplanationContent');
            
            llmExplanationCard.classList.remove('hidden');
            llmExplanationContent.innerHTML = `
                <div class="flex flex-col justify-center items-center py-10">
                    <i class="fas fa-sync-alt fa-spin text-blue-400 text-4xl mb-4"></i>
                    <p class="text-blue-300 text-2xl">Menganalisis kisah hubungan A & B secara lokal...</p>
                </div>
            `;

            await new Promise(resolve => setTimeout(resolve, 500)); 

            let explanationText = "";

            const isBinomialSignificant = lastBinomialPValue < lastAlpha;
            const isChiSquareSignificant = lastChiSquareResult.pValue < lastAlpha;

            if (isBinomialSignificant && isChiSquareSignificant) {
                explanationText = `Kisah A dan B dipenuhi dengan takdir yang tak terbantahkan! Meskipun mereka hanya memiliki ${lastTotalAssignments} kesempatan untuk bertemu di section yang sama, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali. Ini jauh melebihi apa yang bisa dijelaskan oleh kebetulan murni, di mana harapan pertemuan mereka hanya ${lastP0.toFixed(2)} dari setiap kesempatan. Hasil uji statistik kita berbisik tentang ikatan khusus, bahwa alam semesta sendiri berkonspirasi untuk menyatukan mereka. Ini bukanlah kebetulan; ini adalah sebuah hubungan yang signifikan, tertulis dalam bintang-bintang!`;
            } else if (!isBinomialSignificant && !isChiSquareSignificant) {
                explanationText = `Kisah A dan B adalah melodi kebetulan. Dari ${lastTotalAssignments} kesempatan, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali, sebuah angka yang sepenuhnya selaras dengan apa yang diharapkan dari pertemuan acak (${lastP0.toFixed(2)}). Uji statistik kita tidak menemukan bisikan takdir, tidak ada bukti bahwa ada sesuatu yang istimewa yang menarik mereka bersama. Mungkin, dalam bab ini, mereka hanya dua jiwa yang kebetulan melintas di jalur yang sama, tanpa campur tangan kekuatan yang lebih besar.`;
            } else {
                explanationText = `Kisah A dan B adalah enigma yang menarik. Dari ${lastTotalAssignments} kesempatan, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali. Salah satu uji statistik kita menemukan sedikit "percikan" (signifikansi), menyiratkan mungkin ada sesuatu yang lebih dari kebetulan, namun uji lainnya tetap diam, menyiratkan bahwa itu bisa jadi hanya peluang acak. Ini adalah kisah yang membutuhkan lebih banyak bab untuk diungkap, mungkin lebih banyak pertemuan, untuk benar-benar memahami apakah ini adalah takdir yang belum terungkap sepenuhnya atau hanya kebetulan yang sangat menarik.`;
            }
            
            llmExplanationContent.innerHTML = `<p class="whitespace-pre-wrap">${explanationText}</p>`;
        }
    </script>
</body>
</html>
