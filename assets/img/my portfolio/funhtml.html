<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="pageTitle">Kalkulator Uji Statistik - Penempatan Section</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Gochi+Hand&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        /* Responsive design additions */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .result-value {
                font-size: 2.5rem;
            }
        }

        :root {
            --primary-bg: #101827; 
            --chalkboard-bg: #0e141c; 
            --chalkboard-border: #3a4e5a; 
            --text-color: #e0e7ee; 
            --card-bg: rgba(18, 30, 45, 0.7); 
            --card-border: #6ea2b8; 
            --input-border: #6ea2b8; 
            --button-primary-start: #4a789c; 
            --button-primary-end: #3a607e; 
            --highlight-bg: rgba(110, 162, 184, 0.15); 
            --accent-purple: #a7a0de; 
            --accent-gold: #fdd85d; 
            --success-color: #287a55; 
            --error-color: #9a3a3a; 
            
            --chart-curve-color: #9dc2d8; 
            --chart-shading-color: rgba(74, 120, 156, 0.6); 
            --chart-observed-z-label: #c2c0ff; 
            --chart-critical-z-label: #ffe199; 
            --chart-axis-color: #b0c4de; 
            
            --text-primary: #e0e7ee;
            --text-secondary: #a0aec0;
            --success-light: #48bb78;
            --error-light: #f56565;
        }
        body {
            background: linear-gradient(to bottom right, var(--primary-bg), #080d15),
                        url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJjaGFsayIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBwYXR0ZXJuVHJhbnNmb3JtPSJyb3RhdGUoNDUpIj48cGF0aCBkPSJNIDAgMCBMIDEwIDEwIE0gLTEgNSBMIDYgMTUgTSA1IC0xIEwgMTUgNiIgc3Ryb2tlPSJyZ2JhKHJnYmEyMjQsMjMxLDIzOCwwLjA3KSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiAvPjwvcGF0dGVybj48L2RlZnM+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNjaGFsaykiIC8+PC9zdmc+');
            color: var(--text-color);
            font-family: 'Patrick Hand', cursive;
            line-height: 1.6;
        }
        
        .chalkboard {
            background: var(--chalkboard-bg);
            border: 20px solid var(--chalkboard-border);
            border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%233a4e5a"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%232c3f4a" stroke-width="3"/></svg>') 40 stretch;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.9);
            position: relative;
            border-radius: 8px;
        }
        
        .chalkboard::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(255, 255, 255, 0.03) 0px,
                    rgba(255, 255, 255, 0.03) 1px,
                    transparent 1px,
                    transparent 40px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255, 255, 255, 0.03) 0px,
                    rgba(255, 255, 255, 0.03) 1px,
                    transparent 1px,
                    transparent 40px
                );
            pointer-events: none;
            border-radius: 8px;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Caveat', cursive;
            color: var(--text-color);
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.3);
            letter-spacing: 1px;
        }
        
        .card {
            background: var(--card-bg);
            border: 3px solid var(--card-border);
            border-radius: 8px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            position: relative;
            transition: all 0.3s ease; /* Animated Transition */
            transform-origin: top; /* Animated Transition */
        }
        .card.calculating { /* Animated Transition */
            transform: scale(0.98);
            opacity: 0.8;
        }
        
        .card::after {
            content: "";
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px dashed rgba(110, 162, 184, 0.25); 
            border-radius: 5px;
            pointer-events: none;
        }
        
        input, select, button {
            font-family: 'Gochi Hand', cursive;
            background: rgba(15, 25, 40, 0.7); /* Disesuaikan dari #0f2319 */
            border: 2px solid var(--input-border);
            color: var(--text-color);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.6);
            border-radius: 8px;
            font-size: 1.2rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--card-border); /* Disesuaikan dari #5fbda3 */
            box-shadow: 0 0 12px rgba(110, 162, 184, 0.7); /* Disesuaikan dari #5fbda3 */
        }
        /* Visual feedback for invalid inputs */
        input:invalid, select:invalid {
            border-color: var(--error-color);
            animation: shake 0.5s;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .btn-primary {
            background: linear-gradient(to bottom, var(--button-primary-start), var(--button-primary-end));
            border: 2px solid var(--card-border); /* Disesuaikan dari #5fbda3 */
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
            font-family: 'Caveat', cursive;
            font-size: 1.7rem;
            letter-spacing: 1px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            transition: all 0.2s;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to bottom, var(--card-border), var(--button-primary-start)); /* Disesuaikan dari #5fbda3, #4a9e86 */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
        }
        
        .btn-primary::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -60%;
            width: 20px;
            height: 200%;
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(25deg);
            transition: all 0.6s;
        }
        
        .btn-primary:hover::after {
            left: 120%;
        }
        
        .hypothesis {
            font-family: 'Gochi Hand', cursive;
        }
        
        .h0, .h1, .formula {
            background: var(--card-bg); /* Disesuaikan dari #142d23 */
            border: 3px dashed var(--card-border); /* Disesuaikan dari #4a9e86 */
            position: relative;
        }
        
        .h0::before, .h1::before {
            content: "";
            position: absolute;
            top: -7px;
            left: -7px;
            right: -7px;
            bottom: -7px;
            border: 1px solid rgba(110, 162, 184, 0.2); /* Disesuaikan dari #64e6b4 */
            border-radius: 10px;
            pointer-events: none;
        }
        
        .result-value {
            color: var(--accent-gold); /* Updated color for better contrast */
            text-shadow: 0 0 10px rgba(253, 216, 93, 0.5); /* Updated shadow for better contrast */
            font-family: 'Caveat', cursive;
            font-size: 3.8rem;
            margin: 10px 0;
            transition: all 0.5s ease-out; /* Animated Transition */
        }
        
        .conclusion {
            font-family: 'Gochi Hand', cursive;
            background: rgba(30, 41, 59, 0.8); /* Updated background for better contrast */
            border-left: 5px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 8px;
            font-size: 1.2rem;
        }
        
        .highlight {
            background: var(--highlight-bg); /* Disesuaikan dari #64e6b4 */
            border-radius: 4px;
            padding: 2px 6px;
        }
        
        .significance {
            font-family: 'Caveat', cursive;
            font-size: 1.4rem;
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .chalk-border {
            border-bottom: 3px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            position: relative;
            padding-bottom: 12px;
        }
        
        .chalk-border::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 120px;
            height: 3px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 2px;
        }
        
        .chalk-line {
            position: relative;
            padding-bottom: 8px;
        }
        
        .chalk-line::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 80%;
            height: 2px;
            background: rgba(110, 162, 184, 0.6); /* Disesuaikan dari #4a9e86 */
            border-radius: 1px;
        }
        
        .chalk-shadow {
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.3), 0 0 8px rgba(255, 255, 255, 0.2);
        }
        
        canvas {
            background: #e1e3e1; /* Disesuaikan dari #0a1e14 */
            border: 2px solid var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 8px;
        }
        
        .footer {
            font-family: 'Caveat', cursive;
            color: var(--card-border); /* Disesuaikan dari #5fbda3 */
            font-size: 1.4rem;
            text-shadow: 0 0 4px rgba(110, 162, 184, 0.5); /* Disesuaikan dari #5fbda3 */
        }
        
        .chalk-effect {
            position: relative;
            display: inline-block;
        }
        
        .chalk-effect::after {
            content: "";
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
            border-radius: 2px;
        }
        
        .formula {
            background: rgba(15, 25, 40, 0.7); /* Disesuaikan dari #0f2319 */
            border: 2px dashed var(--card-border); /* Disesuaikan dari #4a9e86 */
            font-size: 1.3rem;
        }
        
        .accent-purple { /* Diganti nama dari pink-accent */
            color: var(--accent-purple); /* Disesuaikan dari #ff9eb5 */
            text-shadow: 0 0 6px rgba(167, 160, 222, 0.5); /* Disesuaikan dari #ff9eb5 */
        }
        
        .accent-gold { /* Diganti nama dari gold-accent */
            color: var(--accent-gold); /* Disesuaikan dari #ffd166 */
            text-shadow: 0 0 6px rgba(253, 216, 93, 0.4); /* Disesuaikan dari #ffd166 */
        }
        
        .chalk-dust {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background: radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.05) 0%, transparent 80%),
                        radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 80%);
            z-index: -1;
            border-radius: 8px;
        }
        
        .chalk-underline {
            display: inline-block;
            position: relative;
        }
        
        .chalk-underline::after {
            content: "";
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--card-border); /* Disesuaikan dari #4a9e86 */
        }
        /* Gaya khusus untuk pesan error dan sukses */
        .bg-red-900 { background-color: var(--error-color); }
        .border-red-700 { border-color: var(--error-color); }
        .text-red-200 { color: #ffebeb; } /* Merah muda untuk teks error */
        .bg-green-900 { background-color: var(--success-color); }
        .border-green-700 { border-color: var(--success-color); }
        .text-green-200 { color: #ebffee; } /* Hijau muda untuk teks sukses */
        /* Gambar responsif di header */
        .header-image {
            display: inline-block;
            vertical-align: middle;
            margin-right: 15px; /* Jarak antara gambar dan judul */
            width: 60px; /* Sesuaikan ukuran sesuai kebutuhan */
            height: 60px;
            animation: bounce 2s infinite ease-in-out;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        /* Gaya SVG untuk gambar menarik */
        .math-doodle {
            stroke: var(--accent-gold); /* Warna emas untuk garis */
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body class="p-4">
    <div class="chalkboard max-w-6xl mx-auto rounded-lg p-6 md:p-8 my-8">
        <div class="chalk-dust"></div>
        
        <header class="text-center mb-10 py-6 relative" role="banner">
            <div class="absolute top-0 left-0 right-0 h-3 bg-gradient-to-r from-transparent via-var(--card-border) to-transparent"></div>
            <h1 class="text-5xl md:text-6xl font-bold mb-2 flex items-center justify-center">
                <span class="chalk-underline" data-i18n="mainTitle">Kalkulator Uji Statistik</span>
            </h1>
            <p class="text-2xl accent-gold" data-i18n="subtitle">Analisis hubungan penempatan si A dan si B dalam satu section</p>
            <div class="absolute bottom-0 left-0 right-0 h-3 bg-gradient-to-r from-transparent via-var(--card-border) to-transparent"></div>
        </header>
        <main class="main-content grid grid-cols-1 lg:grid-cols-2 gap-8" role="main">
            <!-- Bagian Input -->
            <section class="card p-6 relative" aria-labelledby="input-heading">
                <div class="chalk-dust"></div>
                <h2 id="input-heading" class="text-3xl font-bold mb-6 chalk-border pb-3 accent-purple">
                    <i class="fas fa-sliders-h mr-3"></i><span data-i18n="inputHeading">Parameter Uji</span>
                </h2>
                <div id="errorMessage" class="hidden bg-red-900 border-2 border-red-700 text-red-200 px-4 py-3 rounded-lg relative mb-4" role="alert" aria-live="assertive">
                    <strong class="font-bold" data-i18n="errorTitle">Kesalahan!</strong>
                    <span class="block sm:inline" id="errorText"></span>
                </div>
                <form id="statsForm" aria-label="Formulir Parameter Uji Statistik">
                    <div class="input-group mb-5">
                        <label for="sectionCount" class="block text-xl mb-2 chalk-line">
                            <span data-i18n="sectionCountLabel">Jumlah Section Tersedia (N)</span>
                            <span class="sr-only" data-i18n="requiredField">(Kolom wajib diisi)</span>
                        </label>
                        <input type="number" id="sectionCount" min="2" max="20" value="5" class="w-full p-3 rounded-lg text-xl" aria-required="true" aria-describedby="sectionCountError">
                        <small id="sectionCountHelp" class="text-blue-200" data-i18n="sectionCountHelp">Probabilitas acak ($p_0$) akan dihitung otomatis sebagai $1/N$</small>
                        <div id="sectionCountError" role="alert" class="text-red-300 text-sm mt-1"></div>
                    </div>
                    <div class="input-group mb-5">
                        <label for="totalAssignments" class="block text-xl mb-2 chalk-line">
                            <span data-i18n="totalAssignmentsLabel">Jumlah Penugasan Section (n)</span>
                            <span class="sr-only" data-i18n="requiredField">(Kolom wajib diisi)</span>
                        </label>
                        <input type="number" id="totalAssignments" min="1" max="100" value="10" class="w-full p-3 rounded-lg text-xl" aria-required="true" aria-describedby="totalAssignmentsError">
                        <div id="totalAssignmentsError" role="alert" class="text-red-300 text-sm mt-1"></div>
                    </div>
                    <div class="input-group mb-5">
                        <label for="sameSectionCount" class="block text-xl mb-2 chalk-line">
                            <span data-i18n="sameSectionCountLabel">Jumlah Kali A dan B Satu Section (k)</span>
                            <span class="sr-only" data-i18n="requiredField">(Kolom wajib diisi)</span>
                        </label>
                        <input type="number" id="sameSectionCount" min="0" max="100" value="7" class="w-full p-3 rounded-lg text-xl" aria-required="true" aria-describedby="sameSectionCountError">
                        <div id="sameSectionCountError" role="alert" class="text-red-300 text-sm mt-1"></div>
                    </div>
                    <div class="input-group mb-6">
                        <label for="alpha" class="block text-xl mb-2 chalk-line">
                            <span data-i18n="alphaLabel">Tingkat Signifikansi (α)</span>
                            <span class="sr-only" data-i18n="requiredField">(Kolom wajib diisi)</span>
                        </label>
                        <select id="alpha" class="w-full p-3 rounded-lg text-xl" aria-required="true">
                            <option value="0.01">0.01 (1%)</option>
                            <option value="0.05" selected>0.05 (5%)</option>
                            <option value="0.10">0.10 (10%)</option>
                        </select>
                    </div>
                    <div class="input-group mb-6">
                        <label for="tailType" class="block text-xl mb-2 chalk-line" data-i18n="tailTypeLabel">Jenis Uji (Ekor)</label>
                        <select id="tailType" class="w-full p-3 rounded-lg text-xl" aria-required="true">
                            <option value="right" data-i18n="tailTypeRight">Satu-tailed (Uji Lebih Besar)</option>
                            <option value="left" data-i18n="tailTypeLeft">Satu-tailed (Uji Lebih Kecil)</option>
                            <option value="two-tailed" selected data-i18n="tailTypeTwo">Dua-tailed</option>
                        </select>
                    </div>
                    <button type="submit" id="calculateBtn" class="btn-primary font-bold py-3 px-6 rounded-lg w-full text-2xl" aria-label="Hitung Statistik">
                        <i class="fas fa-calculator mr-2"></i>
                        <span id="calculateText" data-i18n="calculateButton">Hitung Statistik</span>
                        <span id="calculateSpinner" class="hidden ml-2" role="status" aria-label="Menghitung...">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                </form>
            </section>
            <!-- Bagian Hipotesis -->
            <section class="card p-6 relative" aria-labelledby="hypothesis-heading">
                <div class="chalk-dust"></div>
                <h2 id="hypothesis-heading" class="text-3xl font-bold mb-6 chalk-border pb-3 accent-purple">
                    <i class="fas fa-question-circle mr-3"></i><span data-i18n="hypothesisHeading">Hipotesis Statistik</span>
                </h2>
                <div class="hypothesis grid grid-cols-1 gap-4">
                    <div class="h0 p-5 rounded-lg">
                        <h4 class="text-red-300 text-2xl font-bold mb-2 flex items-center gap-2">
                            <i class="fas fa-times-circle"></i> <span data-i18n="h0Title">Hipotesis Nol (H₀)</span>
                        </h4>
                        <p class="text-xl" data-i18n="h0Text">Tidak ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section adalah murni kebetulan.</p>
                        <div class="formula font-mono p-3 rounded-md my-3 overflow-x-auto text-xl">
                            $P(X=k) = C(n,k)p^k(1-p)^{n-k}$
                        </div>
                    </div>
                    <div class="h1 p-5 rounded-lg">
                        <h4 class="text-green-300 text-2xl font-bold mb-2 flex items-center gap-2">
                            <i class="fas fa-check-circle"></i> <span data-i18n="h1Title">Hipotesis Alternatif (H1)</span>
                        </h4>
                        <p class="text-xl" id="h1AltHypothesisText" data-i18n="h1TextTwoTailed">Ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section bukan kebetulan (dua-tailed).</p>
                        <div class="formula font-mono p-3 rounded-md my-3 overflow-x-auto text-xl" id="h1Formula">
                            $p \neq p_0$
                        </div>
                    </div>
                </div>
                <div class="bg-blue-900 bg-opacity-30 p-6 rounded-xl mt-6 border-2 border-dashed border-var(--card-border)">
                    <h3 class="text-2xl font-bold mb-4 accent-purple" data-i18n="pvalueInterpretTitle">Interpretasi P-value</h3>
                    <p class="text-xl mb-3" data-i18n="pvalueInterpretText">P-value adalah probabilitas untuk mendapatkan hasil pengamatan (atau hasil yang lebih ekstrem) jika hipotesis nol (H₀) adalah benar.</p>
                    <ul class="list-disc pl-5 text-xl">
                        <li class="mb-2"><span class="highlight" data-i18n="pvalueRuleReject">P-value ≤ α: Menolak H₀, menunjukkan bukti kuat bahwa penempatan tidak acak.</li>
                        <li><span class="highlight" data-i18n="pvalueRuleFailToReject">P-value > α: Tidak cukup bukti untuk menolak H₀, penempatan mungkin acak.</li>
                    </ul>
                </div>
            </section>
        </main>
        <!-- Bagian Hasil -->
        <section class="mt-8" role="region" aria-labelledby="results-heading">
            <h2 id="results-heading" class="text-4xl font-bold mb-6 chalk-border pb-3 text-center accent-purple">
                <i class="fas fa-chart-bar mr-3"></i><span data-i18n="resultsHeading">Hasil Perhitungan Statistik</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6 text-center relative" aria-labelledby="binomial-heading">
                    <div class="chalk-dust"></div>
                    <h3 id="binomial-heading" class="text-3xl font-bold mb-2" data-i18n="binomialTestTitle">Uji Binomial</h3>
                    <p class="text-xl mb-3" data-i18n="binomialFormulaDesc">Probabilitas kumulatif: $P(X \ge k)$ atau $P(X \le k)$</p>
                    <div class="result-value" id="binomialResult">-</div>
                    <p class="text-xl" data-i18n="binomialResultDesc">Probabilitas mendapatkan hasil observasi atau lebih ekstrem jika H₀ benar</p>
                    <div id="binomialConclusion" class="conclusion p-4 rounded-lg mt-4 text-xl" data-i18n="initialConclusion">Masukkan parameter dan klik "Hitung Statistik"</div>
                    <div class="chart-container mt-4">
                        <canvas id="binomialChart" height="150" role="img" aria-label="Grafik distribusi normal untuk Uji Binomial"></canvas>
                        <div id="binomialChartDescription" class="sr-only"></div>
                    </div>
                </div>
                <div class="card p-6 text-center relative" aria-labelledby="chisquare-heading">
                    <div class="chalk-dust"></div>
                    <h3 id="chisquare-heading" class="text-3xl font-bold mb-2" data-i18n="chiSquareTestTitle">Uji Chi-Square</h3>
                    <p class="text-xl mb-3" data-i18n="chiSquareFormulaDesc">Statistik Chi-Square: $\chi^2 = \sum \frac{(O - E)^2}{E}$</p>
                    <div class="result-value" id="chiSquareResult">-</div>
                    <p class="text-xl" data-i18n="chiSquareResultDesc">Nilai chi-square dengan derajat kebebasan = 1</p>
                    <div id="chiSquareConclusion" class="conclusion p-4 rounded-lg mt-4 text-xl" data-i18n="initialConclusion">Masukkan parameter dan klik "Hitung Statistik"</div>
                    <div class="chart-container mt-4">
                        <canvas id="chiSquareChart" height="150" role="img" aria-label="Grafik distribusi normal untuk Uji Chi-Square"></canvas>
                        <div id="chiSquareChartDescription" class="sr-only"></div>
                    </div>
                </div>
            </div>
            <div class="card mt-8 p-6 relative" aria-labelledby="final-conclusion-heading">
                <div class="chalk-dust"></div>
                <h3 id="final-conclusion-heading" class="text-3xl font-bold mb-4 accent-purple" data-i18n="finalConclusionHeading">Kesimpulan Analisis</h3>
                <div id="finalConclusion" class="text-xl" aria-live="polite" data-i18n="initialFinalConclusion">
                    Silakan masukkan parameter di atas dan klik tombol "Hitung Statistik" untuk melakukan analisis.
                </div>
                <button id="explainAnalysisBtn" class="hidden btn-primary font-bold py-3 px-6 rounded-lg w-full mt-6 text-2xl" aria-label="Jelaskan Hasil Analisis">
                    <i class="fas fa-magic mr-2"></i>  ✨   <span data-i18n="explainAnalysisButton">Jelaskan Hasil Analisis</span>
                </button>
            </div>
            <!-- Bagian Penjelasan Lokal -->
            <div id="llmExplanationCard" class="hidden card p-6 mt-6 relative" aria-labelledby="local-explanation-heading">
                <div class="chalk-dust"></div>
                <h2 id="local-explanation-heading" class="text-3xl font-bold mb-5 chalk-border pb-3 accent-purple">
                    <i class="fas fa-book-reader mr-3"></i><span data-i18n="localExplanationHeading">Kisah Hubungan A & B (Analisis Lokal)</span>
                </h2>
                <div id="llmExplanationContent" class="prose max-w-none text-xl" aria-live="polite">
                    <div class="flex flex-col justify-center items-center py-10">
                        <i class="fas fa-sync-alt fa-spin text-blue-400 text-4xl mb-4"></i>
                        <p class="text-blue-300 text-2xl" data-i18n="localExplanationLoading">Menganalisis kisah hubungan A & B secara lokal...</p>
                    </div>
                </div>
            </div>
        </section>
        <footer class="text-center py-6 mt-8 border-t border-var(--card-border) border-opacity-30 footer" role="contentinfo">
            <p data-i18n="footerText">Kalkulator Uji Statistik &copy; 2025 | Ditenagai oleh Cinta </p>
        </footer>
    </div>
    <script>
        // Variabel global untuk menyimpan hasil perhitungan terakhir untuk penjelasan
        let lastBinomialPValue = 0;
        let lastChiSquareResult = {};
        let lastAlpha = 0;
        let lastFinalConclusionText = '';
        let lastSectionCount = 0;
        let lastTotalAssignments = 0;
        let lastSameSectionCount = 0;
        let lastP0 = 0;
        let lastTailType = 'two-tailed'; // Default value

        // Localization translations
        const translations = {
            en: {
                pageTitle: "Statistical Test Calculator - Section Placement",
                mainTitle: "Statistical Test Calculator",
                subtitle: "Analysis of the relationship between A and B's section placement",
                inputHeading: "Test Parameters",
                errorTitle: "Error!",
                sectionCountLabel: "Available Sections (N)",
                requiredField: "(Required field)",
                sectionCountHelp: "Random probability ($p_0$) will be calculated automatically as $1/N$",
                totalAssignmentsLabel: "Total Section Assignments (n)",
                sameSectionCountLabel: "Times A and B in Same Section (k)",
                alphaLabel: "Significance Level (α)",
                tailTypeLabel: "Test Type (Tail)",
                tailTypeRight: "One-tailed (Greater Than Test)",
                tailTypeLeft: "One-tailed (Less Than Test)",
                tailTypeTwo: "Two-tailed",
                calculateButton: "Calculate Statistics",
                hypothesisHeading: "Statistical Hypotheses",
                h0Title: "Null Hypothesis (H₀)",
                h0Text: "There is no relationship between A and B being in the same section. Their placement in the same section is purely by chance.",
                h1Title: "Alternative Hypothesis (H1)",
                h1TextTwoTailed: "There is a relationship between A and B being in the same section. Their placement in the same section is not by chance (two-tailed).",
                h1TextRight: "There is a relationship between A and B being in the same section. Their placement is more frequent than expected by chance (one-tailed, greater).",
                h1TextLeft: "There is a relationship between A and B being in the same section. Their placement is less frequent than expected by chance (one-tailed, less).",
                pvalueInterpretTitle: "P-value Interpretation",
                pvalueInterpretText: "The P-value is the probability of obtaining the observed results (or more extreme results) if the null hypothesis (H₀) is true.",
                pvalueRuleReject: "P-value ≤ α: Reject H₀, indicating strong evidence that placement is not random.",
                pvalueRuleFailToReject: "P-value > α: Insufficient evidence to reject H₀, placement might be random.",
                resultsHeading: "Statistical Calculation Results",
                binomialTestTitle: "Binomial Test",
                binomialFormulaDesc: "Cumulative probability: $P(X \\ge k)$ or $P(X \\le k)$",
                binomialResultDesc: "Probability of obtaining observed or more extreme results if H₀ is true",
                chiSquareTestTitle: "Chi-Square Test",
                chiSquareFormulaDesc: "Chi-Square statistic: $\\chi^2 = \\sum \\frac{(O - E)^2}{E}$",
                chiSquareResultDesc: "Chi-square value with degrees of freedom = 1",
                initialConclusion: "Enter parameters and click 'Calculate Statistics'",
                rejectH0: "Reject H₀ ($p < \\alpha$)",
                failToRejectH0: "Fail to reject H₀ ($p \\ge \\alpha$)",
                statisticallySignificant: "Statistically significant",
                notSignificant: "Not significant",
                finalConclusionHeading: "Analysis Conclusion",
                initialFinalConclusion: "Please enter the parameters above and click the 'Calculate Statistics' button to perform the analysis.",
                explainAnalysisButton: "Explain Analysis",
                localExplanationHeading: "Story of A & B's Relationship (Local Analysis)",
                localExplanationLoading: "Analyzing the story of A & B's relationship locally...",
                explanationSignificantBoth: "The story of A and B is filled with undeniable destiny! Although they only had ${lastTotalAssignments} opportunities to be in the same section, they 'matched' ${lastSameSectionCount} times. This far exceeds what could be explained by pure chance, where their expected meeting is only ${lastP0.toFixed(2)} of every opportunity. Our statistical test results whisper about a special bond, that the universe itself conspired to bring them together. This is no coincidence; this is a significant relationship, written in the stars!",
                explanationNotSignificantBoth: "The story of A and B is a melody of coincidence. Out of ${lastTotalAssignments} opportunities, they 'matched' ${lastSameSectionCount} times, a number fully aligned with what is expected from random encounters (${lastP0.toFixed(2)}). Our statistical tests found no whisper of destiny, no evidence that something special drew them together. Perhaps, in this chapter, they are just two souls who happened to cross paths, without the intervention of greater forces.",
                explanationMixed: "The story of A and B is an intriguing enigma. Out of ${lastTotalAssignments} opportunities, they 'matched' ${lastSameSectionCount} times. One of our statistical tests found a slight 'spark' (significance), implying there might be more than coincidence, but the other test remained silent, implying it could just be random chance. This is a story that needs more chapters to unfold, perhaps more encounters, to truly understand if this is an unrevealed destiny or just a very interesting coincidence.",
                sectionCountError: 'Jumlah Section Tersedia harus angka dan minimal 2.',
                totalAssignmentsError: 'Jumlah Penugasan Section harus angka dan minimal 1.',
                sameSectionCountError: 'Jumlah Kali A dan B Satu Section harus angka dan tidak boleh melebihi Jumlah Penugasan.',
                errorProbabilityRange: 'Probabilitas harus antara 0 dan 1.',
                calculationError: 'Terjadi kesalahan saat menghitung statistik.'
            },
            id: {
                pageTitle: "Kalkulator Uji Statistik - Penempatan Section",
                mainTitle: "Kalkulator Uji Statistik",
                subtitle: "Analisis hubungan penempatan si A dan si B dalam satu section",
                inputHeading: "Parameter Uji",
                errorTitle: "Kesalahan!",
                sectionCountLabel: "Jumlah Section Tersedia (N)",
                requiredField: "(Kolom wajib diisi)",
                sectionCountHelp: "Probabilitas acak ($p_0$) akan dihitung otomatis sebagai $1/N$",
                totalAssignmentsLabel: "Jumlah Penugasan Section (n)",
                sameSectionCountLabel: "Jumlah Kali A dan B Satu Section (k)",
                alphaLabel: "Tingkat Signifikansi (α)",
                tailTypeLabel: "Jenis Uji (Ekor)",
                tailTypeRight: "Satu-tailed (Uji Lebih Besar)",
                tailTypeLeft: "Satu-tailed (Uji Lebih Kecil)",
                tailTypeTwo: "Dua-tailed",
                calculateButton: "Hitung Statistik",
                hypothesisHeading: "Hipotesis Statistik",
                h0Title: "Hipotesis Nol (H₀)",
                h0Text: "Tidak ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section adalah murni kebetulan.",
                h1Title: "Hipotesis Alternatif (H1)",
                h1TextTwoTailed: "Ada hubungan antara si A dan si B satu section. Penempatan mereka dalam satu section bukan kebetulan (dua-tailed).",
                h1TextRight: "Ada hubungan antara si A dan si B satu section. Penempatan mereka lebih sering dari yang diharapkan secara kebetulan (satu-tailed, lebih besar).",
                h1TextLeft: "Ada hubungan antara si A dan si B satu section. Penempatan mereka lebih jarang dari yang diharapkan secara kebetulan (satu-tailed, lebih kecil).",
                pvalueInterpretTitle: "Interpretasi P-value",
                pvalueInterpretText: "P-value adalah probabilitas untuk mendapatkan hasil pengamatan (atau hasil yang lebih ekstrem) jika hipotesis nol (H₀) adalah benar.",
                pvalueRuleReject: "P-value ≤ α: Menolak H₀, menunjukkan bukti kuat bahwa penempatan tidak acak.",
                pvalueRuleFailToReject: "P-value > α: Tidak cukup bukti untuk menolak H₀, penempatan mungkin acak.",
                resultsHeading: "Hasil Perhitungan Statistik",
                binomialTestTitle: "Uji Binomial",
                binomialFormulaDesc: "Probabilitas kumulatif: $P(X \\ge k)$ atau $P(X \\le k)$",
                binomialResultDesc: "Probabilitas mendapatkan hasil observasi atau lebih ekstrem jika H₀ benar",
                chiSquareTestTitle: "Uji Chi-Square",
                chiSquareFormulaDesc: "Statistik Chi-Square: $\\chi^2 = \\sum \\frac{(O - E)^2}{E}$",
                chiSquareResultDesc: "Nilai chi-square dengan derajat kebebasan = 1",
                initialConclusion: "Masukkan parameter dan klik \"Hitung Statistik\"",
                rejectH0: "Menolak H₀ ($p < \\alpha$)",
                failToRejectH0: "Gagal menolak H₀ ($p \\ge \\alpha$)",
                statisticallySignificant: "Signifikan secara statistik",
                notSignificant: "Tidak signifikan",
                finalConclusionHeading: "Kesimpulan Analisis",
                initialFinalConclusion: "Silakan masukkan parameter di atas dan klik tombol \"Hitung Statistik\" untuk melakukan analisis.",
                explainAnalysisButton: "Jelaskan Hasil Analisis",
                localExplanationHeading: "Kisah Hubungan A & B (Analisis Lokal)",
                localExplanationLoading: "Menganalisis kisah hubungan A & B secara lokal...",
                explanationSignificantBoth: "Kisah A dan B dipenuhi dengan takdir yang tak terbantahkan! Meskipun mereka hanya memiliki ${lastTotalAssignments} kesempatan untuk bertemu di section yang sama, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali. Ini jauh melebihi apa yang bisa dijelaskan oleh kebetulan murni, di mana harapan pertemuan mereka hanya ${lastP0.toFixed(2)} dari setiap kesempatan. Hasil uji statistik kita berbisik tentang ikatan khusus, bahwa alam semesta sendiri berkonspirasi untuk menyatukan mereka. Ini bukanlah kebetulan; ini adalah sebuah hubungan yang signifikan, tertulis dalam bintang-bintang!",
                explanationNotSignificantBoth: "Kisah A dan B adalah melodi kebetulan. Dari ${lastTotalAssignments} kesempatan, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali, sebuah angka yang sepenuhnya selaras dengan apa yang diharapkan dari pertemuan acak (${lastP0.toFixed(2)}). Uji statistik kita tidak menemukan bisikan takdir, tidak ada bukti bahwa ada sesuatu yang istimewa yang menarik mereka bersama. Mungkin, dalam bab ini, mereka hanya dua jiwa yang kebetulan melintas di jalur yang sama, tanpa campur tangan kekuatan yang lebih besar.",
                explanationMixed: "Kisah A dan B adalah enigma yang menarik. Dari ${lastTotalAssignments} kesempatan, mereka 'berjodoh' sebanyak ${lastSameSectionCount} kali. Salah satu uji statistik kita menemukan sedikit \"percikan\" (signifikansi), menyiratkan mungkin ada sesuatu yang lebih dari kebetulan, namun uji lainnya tetap diam, menyiratkan bahwa itu bisa jadi hanya peluang acak. Ini adalah kisah yang membutuhkan lebih banyak bab untuk diungkap, mungkin lebih banyak pertemuan, untuk benar-benar memahami apakah ini adalah takdir yang belum terungkap sepenuhnya atau hanya kebetulan yang sangat menarik.",
                sectionCountError: 'Jumlah Section Tersedia harus angka dan minimal 2.',
                totalAssignmentsError: 'Jumlah Penugasan Section harus angka dan minimal 1.',
                sameSectionCountError: 'Jumlah Kali A dan B Satu Section harus angka dan tidak boleh melebihi Jumlah Penugasan.',
                errorProbabilityRange: 'Probabilitas harus antara 0 dan 1.',
                calculationError: 'Terjadi kesalahan saat menghitung statistik.'
            }
        };

        function applyTranslations() {
            const lang = document.documentElement.lang || 'id'; // Default to Indonesian
            const currentTranslations = translations[lang] || translations['id'];

            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (currentTranslations[key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.setAttribute('placeholder', currentTranslations[key]);
                    } else {
                        element.innerHTML = currentTranslations[key];
                    }
                }
            });

            // Update H1 text based on default tailType or selected
            updateH1Text(document.getElementById('tailType').value);
        }

        function updateH1Text(tailType) {
            const lang = document.documentElement.lang || 'id';
            const currentTranslations = translations[lang] || translations['id'];
            const h1Element = document.getElementById('h1AltHypothesisText');
            const formulaElement = document.getElementById('h1Formula');

            if (h1Element && formulaElement) {
                if (tailType === 'two-tailed') {
                    h1Element.innerHTML = currentTranslations.h1TextTwoTailed;
                    formulaElement.innerHTML = '$p \\neq p_0$';
                } else if (tailType === 'right') {
                    h1Element.innerHTML = currentTranslations.h1TextRight;
                    formulaElement.innerHTML = '$p > p_0$';
                } else if (tailType === 'left') {
                    h1Element.innerHTML = currentTranslations.h1TextLeft;
                    formulaElement.innerHTML = '$p < p_0$';
                }
            }
        }

        // Add an event listener to update H1 text when tailType changes
        document.addEventListener('DOMContentLoaded', () => {
            const tailTypeSelect = document.getElementById('tailType');
            if (tailTypeSelect) {
                tailTypeSelect.addEventListener('change', (event) => {
                    updateH1Text(event.target.value);
                });
            }
        });


        /**
         * Fungsi debounce untuk membatasi eksekusi fungsi yang dipicu secara berulang (misalnya, acara resize).
         * @param {Function} func - Fungsi yang akan di-debounce.
         * @param {number} delay - Penundaan dalam milidetik.
         * @returns {Function} Fungsi yang di-debounce.
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            applyTranslations(); // Apply translations on load

            // Menggunakan event listener submit pada form untuk menangani input
            document.getElementById('statsForm').addEventListener('submit', function(e) {
                e.preventDefault(); // Mencegah pengiriman form default
                calculateStatistics();
            });
            // Pengaturan ukuran canvas awal dan menggambar
            resizeCanvas();
            // Menghitung ulang dan menggambar ulang chart jika field input memiliki nilai saat dimuat
            if (document.getElementById('sectionCount').value && document.getElementById('totalAssignments').value && document.getElementById('sameSectionCount').value) {
                calculateStatistics();
            }
        });
        // Menggunakan debounce untuk acara resize
        window.addEventListener('resize', debounce(resizeCanvas, 250));
        document.getElementById('explainAnalysisBtn').addEventListener('click', generateLocalExplanation);
        
        /**
         * Mengatur lebar canvas agar sesuai dengan container induknya dan menggambar ulang chart.
         */
        function resizeCanvas() {
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                const canvas = container.querySelector('canvas');
                if (canvas) {
                    const dpr = window.devicePixelRatio || 1; // Mendapatkan Device Pixel Ratio
                    canvas.width = container.clientWidth * dpr;
                    canvas.height = 150 * dpr; // Tinggi tetap 150px tetapi diskalakan
                    canvas.style.width = `${container.clientWidth}px`; // Mengatur lebar CSS
                    canvas.style.height = '150px'; // Mengatur tinggi CSS
                    canvas.getContext('2d').scale(dpr, dpr); // Menskalakan konteks untuk DPI tinggi
                    
                    // Menggambar ulang chart jika data ada
                    const canvasId = canvas.id;
                    if (canvasId === 'binomialChart' && lastBinomialPValue !== 0) {
                        // Pass full parameters for redraw
                        drawNormalDistributionChart(canvasId, lastSameSectionCount, lastTotalAssignments, lastP0, lastBinomialPValue, lastAlpha, lastTailType);
                    } else if (canvasId === 'chiSquareChart' && lastChiSquareResult.pValue !== undefined) {
                        drawNormalDistributionChart(canvasId, lastSameSectionCount, lastTotalAssignments, lastP0, lastChiSquareResult.pValue, lastAlpha, 'two-tailed');
                    }
                }
            });
        }

        /**
         * Sanitasi input untuk mencegah XSS.
         * @param {string} value - Nilai input yang akan disanitasi.
         * @returns {string} Nilai yang sudah disanitasi.
         */
        function sanitizeInput(value) {
            if (typeof value !== 'string') {
                value = String(value);
            }
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(value));
            return div.innerHTML;
        }

        /**
         * Menampilkan pesan error di halaman dan mengatur atribut aria-invalid.
         * @param {string} message - Pesan error yang akan ditampilkan.
         * @param {string} inputId - ID input yang terkait dengan error.
         */
        function showErrorMessage(message, inputId) {
            const errorMessageDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorMessageDiv.classList.remove('hidden'); // Tampilkan div error

            if (inputId) {
                const inputElement = document.getElementById(inputId);
                const errorDiv = document.getElementById(`${inputId}Error`);
                if (inputElement) {
                    inputElement.setAttribute('aria-invalid', 'true');
                }
                if (errorDiv) {
                    errorDiv.textContent = message;
                }
            }
        }

        /**
         * Menyembunyikan pesan error dari halaman dan mengatur ulang atribut aria-invalid.
         * @param {string} inputId - Opsional: ID input untuk mereset aria-invalid.
         */
        function hideErrorMessage(inputId) {
            if (inputId) {
                const inputElement = document.getElementById(inputId);
                const errorDiv = document.getElementById(`${inputId}Error`);
                if (inputElement) {
                    inputElement.setAttribute('aria-invalid', 'false');
                }
                if (errorDiv) {
                    errorDiv.textContent = '';
                }
            } else {
                // Sembunyikan pesan error umum
                const errorMessageDiv = document.getElementById('errorMessage');
                errorMessageDiv.classList.add('hidden');
                // Reset semua aria-invalid
                document.querySelectorAll('input[aria-invalid="true"]').forEach(input => {
                    input.setAttribute('aria-invalid', 'false');
                    const errorDiv = document.getElementById(`${input.id}Error`);
                    if (errorDiv) errorDiv.textContent = '';
                });
            }
        }

        /**
         * Validasi probabilitas.
         * @param {number} p - Probabilitas yang akan divalidasi.
         * @returns {boolean} True jika probabilitas valid, false jika tidak.
         */
        function validateProbability(p) {
            if (typeof p !== 'number' || isNaN(p) || p < 0 || p > 1) {
                throw new Error(translations[document.documentElement.lang].errorProbabilityRange || 'Probability must be between 0 and 1');
            }
            return true;
        }

        /**
         * Memvalidasi semua input form.
         * @returns {boolean} True jika semua input valid, false jika tidak.
         */
        function validateInputs() {
            hideErrorMessage(); // Clear previous errors

            const sectionCount = parseInt(sanitizeInput(document.getElementById('sectionCount').value));
            const totalAssignments = parseInt(sanitizeInput(document.getElementById('totalAssignments').value));
            const sameSectionCount = parseInt(sanitizeInput(document.getElementById('sameSectionCount').value));
            const alpha = parseFloat(sanitizeInput(document.getElementById('alpha').value));

            if (isNaN(sectionCount) || sectionCount < 2) {
                showErrorMessage(translations[document.documentElement.lang].sectionCountError || 'Jumlah Section Tersedia harus angka dan minimal 2.', 'sectionCount');
                return false;
            }
            if (isNaN(totalAssignments) || totalAssignments < 1) {
                showErrorMessage(translations[document.documentElement.lang].totalAssignmentsError || 'Jumlah Penugasan Section harus angka dan minimal 1.', 'totalAssignments');
                return false;
            }
            if (isNaN(sameSectionCount) || sameSectionCount < 0 || sameSectionCount > totalAssignments) {
                showErrorMessage(translations[document.documentElement.lang].sameSectionCountError || 'Jumlah Kali A dan B Satu Section harus angka dan tidak boleh melebihi Jumlah Penugasan.', 'sameSectionCount');
                return false;
            }
            try {
                validateProbability(alpha);
            } catch (e) {
                showErrorMessage(e.message, 'alpha');
                return false;
            }
            return true;
        }

        /**
         * Fungsi utama untuk menghitung dan menampilkan hasil statistik berdasarkan input pengguna.
         */
        async function calculateStatistics() { 
            // Validasi input terlebih dahulu
            if (!validateInputs()) {
                // Sembunyikan spinner jika validasi gagal
                document.getElementById('calculateText').classList.remove('hidden');
                document.getElementById('calculateSpinner').classList.add('hidden');
                return;
            }
            // Tampilkan spinner loading
            document.getElementById('calculateText').classList.add('hidden');
            document.getElementById('calculateSpinner').classList.remove('hidden');
            document.querySelector('.card:first-child').classList.add('calculating'); // Add calculating class
            // Beri sedikit penundaan agar spinner terlihat
            await new Promise(resolve => setTimeout(resolve, 300)); 

            try {
                // Mendapatkan nilai input dari DOM setelah validasi dan sanitasi
                const sectionCount = parseInt(sanitizeInput(document.getElementById('sectionCount').value));
                const totalAssignments = parseInt(sanitizeInput(document.getElementById('totalAssignments').value));
                const sameSectionCount = parseInt(sanitizeInput(document.getElementById('sameSectionCount').value));
                const alpha = parseFloat(sanitizeInput(document.getElementById('alpha').value));
                const tailType = sanitizeInput(document.getElementById('tailType').value);

                // Menghitung probabilitas di bawah Hipotesis Nol (H0)
                const p0 = 1 / sectionCount;
                validateProbability(p0); // Validate p0 as well

                // Melakukan Uji Binomial
                const binomialPValue = calculateBinomialPValue(totalAssignments, sameSectionCount, p0, tailType);
                
                // Melakukan Uji Chi-Square
                const chiSquareResult = chiSquareTest(totalAssignments, sameSectionCount, p0);
                
                // Menyimpan hasil dalam variabel global untuk penjelasan lokal
                lastBinomialPValue = binomialPValue;
                lastChiSquareResult = chiSquareResult;
                lastAlpha = alpha;
                lastSectionCount = sectionCount;
                lastTotalAssignments = totalAssignments;
                lastSameSectionCount = sameSectionCount;
                lastP0 = p0;
                lastTailType = tailType; // Store the selected tail type

                // Menampilkan semua hasil dan kesimpulan di UI
                displayResults(binomialPValue, chiSquareResult, alpha, tailType);
                
                // Menggambar chart
                drawNormalDistributionChart('binomialChart', sameSectionCount, totalAssignments, p0, binomialPValue, alpha, tailType);
                drawNormalDistributionChart('chiSquareChart', sameSectionCount, totalAssignments, p0, chiSquareResult.pValue, alpha, 'two-tailed'); // Chi-Square is always two-tailed in this context

            } catch (error) {
                console.error("Calculation error:", error);
                showErrorMessage(error.message || translations[document.documentElement.lang].calculationError || 'Terjadi kesalahan saat menghitung statistik.', null);
            } finally {
                // Sembunyikan spinner loading
                document.getElementById('calculateText').classList.remove('hidden');
                document.getElementById('calculateSpinner').classList.add('hidden');
                document.querySelector('.card:first-child').classList.remove('calculating'); // Remove calculating class
                // Tampilkan tombol penjelasan
                document.getElementById('explainAnalysisBtn').classList.remove('hidden');
                // Sembunyikan penjelasan sebelumnya
                document.getElementById('llmExplanationCard').classList.add('hidden');
            }
        }

        /* --- STATISTICAL FUNCTIONS (LOGICALLY SEPARATED) --- */

        /**
         * Menghitung logGamma(x) menggunakan aproksimasi Lanczos.
         * Diperlukan untuk stabilitas numerik dengan faktorial besar.
         * @param {number} x - Nilai untuk menghitung logGamma.
         * @returns {number} logGamma(x).
         */
        function logGamma(x) {
            // Caching Lanczos coefficients
            const p = [
                0.99999999999980993, 676.5203681242088, -1259.1392167224028,
                771.32342877765313, -176.61502916214059, 12.507343278686905,
                -0.13857109526572012, 9.9843695780195716e-6, 1.5056327351493116e-7
            ];
            const g = 7; // Lanczos parameter

            if (x < 0.5) {
                return Math.log(Math.PI / (Math.sin(Math.PI * x) * logGamma(1 - x)));
            } else {
                x -= 1;
                let a = p[0];
                let t = x + g + 0.5;
                for (let i = 1; i < p.length; i++) {
                    a += p[i] / (x + i);
                }
                return 0.5 * Math.log(2 * Math.PI) + (x + 0.5) * Math.log(t) - t + Math.log(a);
            }
        }

        /**
         * Menghitung fungsi massa probabilitas untuk distribusi binomial: P(X = k).
         * Menggunakan logaritma untuk stabilitas numerik yang lebih baik untuk n besar.
         * Juga menangani kasus p=0 atau p=1 secara eksplisit.
         * @param {number} n - Jumlah percobaan.
         * @param {number} k - Jumlah keberhasilan.
         * @param {number} p - Probabilitas keberhasilan pada satu percobaan.
         * @returns {number} Probabilitas tepat k keberhasilan.
         */
        function binomialProbability(n, k, p) {
            if (p < 0 || p > 1) {
                console.error("Probabilitas p harus antara 0 dan 1.");
                return 0;
            }
            if (k < 0 || k > n) {
                return 0; // Tidak mungkin memiliki keberhasilan kurang dari 0 atau lebih dari n
            }
            if (p === 0) return k === 0 ? 1.0 : 0.0;
            if (p === 1) return k === n ? 1.0 : 0.0;

            let logProb;
            if (n > 30) { // Use logarithmic approach for large n
                logProb = logGamma(n + 1) - logGamma(k + 1) - logGamma(n - k + 1) +
                          k * Math.log(p) + (n - k) * Math.log(1 - p);
            } else {
                // Calculate binomial coefficient C(n, k)
                let coeff = 1;
                for (let i = 0; i < k; i++) {
                    coeff = coeff * (n - i) / (i + 1);
                }
                logProb = Math.log(coeff) + k * Math.log(p) + (n - k) * Math.log(1 - p);
            }
            
            const result = Math.exp(logProb);
            return isFinite(result) ? result : 0;
        }

        /**
         * Menghitung p-value untuk uji binomial berdasarkan jenis ekor yang dipilih.
         * Menggunakan aproksimasi normal untuk n besar (n > 50) dengan koreksi kontinuitas.
         * Untuk n kecil, menggunakan perhitungan eksak.
         * @param {number} n - Jumlah percobaan (total penugasan).
         * @param {number} k - Jumlah keberhasilan (berapa kali A dan B berada di section yang sama).
         * @param {number} p0 - Probabilitas keberhasilan pada satu percobaan di bawah hipotesis nol (1/sectionCount).
         * @param {string} tailType - 'right', 'left', atau 'two-tailed'.
         * @returns {number} P-value yang dihitung.
         */
        function calculateBinomialPValue(n, k, p0, tailType) {
            if (p0 === 0) return k === 0 ? 1 : 0;
            if (p0 === 1) return k === n ? 1 : 0;

            // Normal approximation for large n
            if (n > 50) {
                const mean = n * p0;
                const std = Math.sqrt(n * p0 * (1 - p0));

                if (std === 0) return 0; // Avoid division by zero if std dev is 0

                if (tailType === 'right') {
                    // P(X >= k) with continuity correction: P(Z >= (k - 0.5 - mean) / std)
                    const z = (k - 0.5 - mean) / std;
                    return 1 - normalCDF(z);
                } else if (tailType === 'left') {
                    // P(X <= k) with continuity correction: P(Z <= (k + 0.5 - mean) / std)
                    const z = (k + 0.5 - mean) / std;
                    return normalCDF(z);
                } else if (tailType === 'two-tailed') {
                    // Two-tailed test for normal approximation: 2 * (1 - normalCDF(abs(Z_corrected)))
                    // We need to calculate the Z-score for the observed k, considering continuity.
                    // The "extremeness" is measured from the mean.
                    const z_observed = (k - mean);
                    const z_corrected = (z_observed > 0 ? (z_observed - 0.5) : (z_observed + 0.5)) / std;
                    return 2 * (1 - normalCDF(Math.abs(z_corrected)));
                }
            } else { // Exact binomial calculation for n <= 50
                let sum = 0;
                if (tailType === 'right') {
                    for (let i = k; i <= n; i++) {
                        sum += binomialProbability(n, i, p0);
                    }
                } else if (tailType === 'left') {
                    for (let i = 0; i <= k; i++) {
                        sum += binomialProbability(n, i, p0);
                    }
                } else if (tailType === 'two-tailed') {
                    // For two-tailed exact test, sum probabilities of outcomes as extreme or more extreme than k
                    // This is 2 * min(P(X >= k), P(X <= k))
                    const p_upper = calculateBinomialPValue(n, k, p0, 'right');
                    const p_lower = calculateBinomialPValue(n, k, p0, 'left');
                    return 2 * Math.min(p_upper, p_lower);
                }
                return Math.min(1, sum); // Ensure pValue does not exceed 1
            }
            return 0; // Should not reach here
        }

        /**
         * Fungsi Kepadatan Probabilitas (PDF) untuk distribusi normal standar.
         * @param {number} x - Nilai yang akan dihitung PDF-nya.
         * @returns {number} Kepadatan probabilitas pada x.
         */
        function normalPDF(x) {
            return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
        }

        /**
         * Melakukan uji Chi-Square goodness-of-fit untuk dua kategori (section yang sama vs. section yang berbeda).
         * Ini menghitung statistik chi-square dan p-value yang sesuai (untuk df=1).
         * Menggunakan koreksi kontinuitas Yates.
         * @param {number} n - Total jumlah penugasan.
         * @param {number} observedSame - Jumlah teramati A dan B di section yang sama.
         * @param {number} p0 - Probabilitas yang diharapkan A dan B di section yang sama di bawah H0.
         * @returns {object} Objek yang berisi statistik chi-square, p-value, serta jumlah teramati/diharapkan.
         */
        function chiSquareTest(n, observedSame, p0) {
            const expectedSame = n * p0;
            const expectedDifferent = n * (1 - p0);
            const observedDifferent = n - observedSame;

            // Peringatan jika frekuensi harapan terlalu rendah untuk keandalan Chi-Square
            if (expectedSame < 5 || expectedDifferent < 5) {
                console.warn("Chi-square may not be reliable due to low expected frequencies. Consider using binomial test.");
            }

            let chiSquare = 0;

            // Apply Yates' continuity correction and calculate terms
            // Handle cases where expected frequencies might be zero to avoid division by zero.
            if (expectedSame > 0) {
                chiSquare += Math.pow(Math.abs(observedSame - expectedSame) - 0.5, 2) / expectedSame;
            } else if (observedSame > 0) {
                // If expected is 0 but observed is not, this is an extreme deviation.
                // For practical purposes, this implies infinite chi-square.
                return { chiSquare: Infinity, pValue: 0, observedSame, observedDifferent, expectedSame, expectedDifferent };
            }

            if (expectedDifferent > 0) {
                chiSquare += Math.pow(Math.abs(observedDifferent - expectedDifferent) - 0.5, 2) / expectedDifferent;
            } else if (observedDifferent > 0) {
                // If expected is 0 but observed is not, this is an extreme deviation.
                return { chiSquare: Infinity, pValue: 0, observedSame, observedDifferent, expectedSame, expectedDifferent };
            }
            
            // For distributions with 1 degree of freedom, the p-value can be derived from the Z-score of a standard normal distribution (Chi-square = Z^2).
            const z = Math.sqrt(chiSquare);
            const pValue = 2 * (1 - normalCDF(z));  // Two-tailed test for chi-square
            
            return {
                chiSquare: chiSquare,
                pValue: pValue,
                observedSame: observedSame,
                observedDifferent: observedDifferent,
                expectedSame: expectedSame,
                expectedDifferent: expectedDifferent
            };
        }

        /**
         * Implementasi Normal CDF yang akurat (aproksimasi).
         * Mengembalikan P(Z <= x).
         * @param {number} x - Nilai yang akan dihitung CDF-nya.
         * @returns {number} Probabilitas kumulatif P(Z <= x).
         */
        function normalCDF(x) {
            const t = 1 / (1 + 0.2316419 * Math.abs(x));
            const d = 0.3989423 * Math.exp(-x * x / 2);
            let prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            
            if (x > 0) prob = 1 - prob;
            return prob;
        }

        /**
         * Menghitung Z-score untuk p-value tertentu (kebalikan dari normalCDF).
         * @param {number} p - P-value.
         * @returns {number} Z-score yang sesuai.
         */
        function normalInverseCDF(p) {
            if (p < 0.00000000001) return -6;
            if (p > 0.99999999999) return 6;
            const q = p > 0.5 ? 1 - p : p;
            const t = Math.sqrt(-2 * Math.log(q));
            const c0 = 2.515517;
            const c1 = 0.802853;
            const c2 = 0.010328;
            const d1 = 1.432788;
            const d2 = 0.189269;
            const d3 = 0.001308;
            let z = t - ((c0 + c1 * t + c2 * t * t) / (1 + d1 * t + d2 * t * t + d3 * t * t * t));
            if (p < 0.5) {
                z = -z;
            }
            return z;
        }

        /* --- UI UPDATE FUNCTIONS --- */
        /**
         * Menampilkan hasil statistik yang dihitung dan kesimpulan di halaman web.
         * @param {number} binomialPValue - P-value dari uji binomial.
         * @param {object} chiSquareResult - Hasil dari uji chi-square.
         * @param {number} alpha - Tingkat signifikansi.
         * @param {string} tailType - Jenis uji (ekor) yang dipilih.
         */
        function displayResults(binomialPValue, chiSquareResult, alpha, tailType) {
            const lang = document.documentElement.lang || 'id';
            const currentTranslations = translations[lang] || translations['id'];

            // Perbarui hasil Uji Binomial
            document.getElementById('binomialResult').textContent = binomialPValue.toFixed(6);
            const binomialConclusion = document.getElementById('binomialConclusion');
            binomialConclusion.classList.remove('bg-red-900', 'border-red-700', 'text-red-200', 'bg-green-900', 'border-green-700', 'text-green-200');
            if (binomialPValue < alpha) {
                binomialConclusion.innerHTML = `<strong class="block text-2xl mb-1">${currentTranslations.rejectH0}</strong>
                    <p class="text-xl">${currentTranslations.binomialResultDesc}</p>
                    <span class="significance bg-green-900 text-green-200 px-3 py-1 rounded-full mt-2">${currentTranslations.statisticallySignificant}</span>`;
                binomialConclusion.classList.add('bg-green-900', 'border-green-700', 'text-green-200');
            } else {
                binomialConclusion.innerHTML = `<strong class="block text-2xl mb-1">${currentTranslations.failToRejectH0}</strong>
                    <p class="text-xl">${currentTranslations.binomialResultDesc}</p>
                    <span class="significance bg-red-900 text-red-200 px-3 py-1 rounded-full mt-2">${currentTranslations.notSignificant}</span>`;
                binomialConclusion.classList.add('bg-red-900', 'border-red-700', 'text-red-200');
            }

            // Perbarui hasil Uji Chi-Square
            document.getElementById('chiSquareResult').textContent = chiSquareResult.chiSquare.toFixed(4);
            const chiSquareConclusion = document.getElementById('chiSquareConclusion');
            chiSquareConclusion.classList.remove('bg-red-900', 'border-red-700', 'text-red-200', 'bg-green-900', 'border-green-700', 'text-green-200');
            if (chiSquareResult.pValue < alpha) {
                chiSquareConclusion.innerHTML = `<strong class="block text-2xl mb-1">${currentTranslations.rejectH0} ($p = ${chiSquareResult.pValue.toFixed(6)}$)</strong>
                    <p class="text-xl">${currentTranslations.chiSquareResultDesc}</p>
                    <span class="significance bg-green-900 text-green-200 px-3 py-1 rounded-full mt-2">${currentTranslations.statisticallySignificant}</span>`;
                chiSquareConclusion.classList.add('bg-green-900', 'border-green-700', 'text-green-200');
            } else {
                chiSquareConclusion.innerHTML = `<strong class="block text-2xl mb-1">${currentTranslations.failToRejectH0} ($p = ${chiSquareResult.pValue.toFixed(6)}$)</strong>
                    <p class="text-xl">${currentTranslations.chiSquareResultDesc}</p>
                    <span class="significance bg-red-900 text-red-200 px-3 py-1 rounded-full mt-2">${currentTranslations.notSignificant}</span>`;
                chiSquareConclusion.classList.add('bg-red-900', 'border-red-700', 'text-red-200');
            }

            // Tentukan kesimpulan akhir berdasarkan kedua uji
            const finalConclusionElement = document.getElementById('finalConclusion');
            const isBinomialSignificant = binomialPValue < alpha;
            const isChiSquareSignificant = chiSquareResult.pValue < alpha;

            if (isBinomialSignificant && isChiSquareSignificant) {
                lastFinalConclusionText = `Berdasarkan Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) dan Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}), yang keduanya < \\alpha (${alpha}), kita memiliki <span class="highlight font-bold">bukti statistik yang kuat untuk menolak Hipotesis Nol.</span> Ini menunjukkan bahwa penempatan A dan B dalam satu section <span class="highlight font-bold">bukanlah kebetulan semata</span> dan kemungkinan ada faktor lain yang mempengaruhinya.`;
            } else if (isBinomialSignificant && !isChiSquareSignificant) {
                lastFinalConclusionText = `Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) menunjukkan hasil signifikan (< \\alpha ${alpha}), namun Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}) tidak signifikan. Hal ini mungkin mengindikasikan adanya efek, tetapi dengan dukungan yang tidak konsisten dari kedua metode. Interpretasi lebih lanjut diperlukan.`;
            } else if (!isBinomialSignificant && isChiSquareSignificant) {
                lastFinalConclusionText = `Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}) menunjukkan hasil signifikan (< \\alpha ${alpha}), namun Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) tidak signifikan. Ini mungkin terjadi karena perbedaan asumsi antara kedua tes. Interpretasi lebih lanjut diperlukan.`;
            } else {
                lastFinalConclusionText = `Berdasarkan Uji Binomial (p-value = ${binomialPValue.toFixed(6)}) dan Uji Chi-Square (p-value = ${chiSquareResult.pValue.toFixed(6)}), yang keduanya $\\ge \\alpha$ (${alpha}), kita <span class="highlight font-bold">gagal menolak Hipotesis Nol.</span> Ini berarti tidak ada cukup bukti statistik untuk menyatakan bahwa penempatan A dan B dalam satu section bukanlah kebetulan. Hasil yang diamati mungkin <span class="highlight font-bold">disebabkan oleh peluang acak.</span>`;
            }
            finalConclusionElement.innerHTML = lastFinalConclusionText;
        }

        /**
         * Menggambar kurva distribusi normal pada canvas yang diberikan, menyoroti area p-value.
         * @param {string} canvasId - ID dari elemen canvas.
         * @param {number} observedK - Jumlah keberhasilan yang diamati.
         * @param {number} n - Total percobaan.
         * @param {number} p0 - Probabilitas di bawah H0.
         * @param {number} pValue - P-value yang akan digambarkan.
         * @param {number} alpha - Tingkat signifikansi.
         * @param {string} tailType - 'right', 'left', atau 'two-tailed'.
         */
        function drawNormalDistributionChart(canvasId, observedK, n, p0, pValue, alpha, tailType) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            
            // Clear and scale for high DPI
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const dpr = window.devicePixelRatio || 1;
            const currentWidth = canvas.width / dpr;
            const currentHeight = canvas.height / dpr;
            
            ctx.strokeStyle = 'var(--chart-curve-color)';
            ctx.lineWidth = 2;
            ctx.font = "12px 'Gochi Hand', cursive";
            ctx.fillStyle = 'var(--text-color)';

            const padding = 20;
            const drawAreaWidth = currentWidth - (2 * padding);
            const drawAreaHeight = currentHeight - (2 * padding);
            const drawAreaX = padding;
            const drawAreaY = padding;

            const xMin = -4; // Extend range slightly for better visualization
            const xMax = 4;
            const xScale = drawAreaWidth / (xMax - xMin);
            const yMaxDensity = normalPDF(0);
            const yScale = drawAreaHeight / yMaxDensity;
            const centerY = drawAreaY + drawAreaHeight;

            // Draw X-axis
            ctx.beginPath();
            ctx.strokeStyle = 'var(--chart-axis-color)';
            ctx.moveTo(drawAreaX, centerY);
            ctx.lineTo(drawAreaX + drawAreaWidth, centerY);
            ctx.stroke();

            // Draw Normal Distribution Curve
            ctx.strokeStyle = 'var(--chart-curve-color)';
            ctx.beginPath();
            for (let x = xMin; x <= xMax; x += 0.01) {
                const screenX = drawAreaX + (x - xMin) * xScale;
                const y = normalPDF(x);
                const screenY = centerY - (y * yScale);
                if (x === xMin) {
                    ctx.moveTo(screenX, screenY);
                } else {
                    ctx.lineTo(screenX, screenY);
                }
            }
            ctx.stroke();

            // Draw X-axis labels and tick marks
            ctx.fillStyle = 'var(--text-color)';
            ctx.font = "10px 'Gochi Hand', cursive";
            for (let x = Math.ceil(xMin); x <= Math.floor(xMax); x++) {
                if (x === 0) continue; // Avoid duplicating 0
                const screenX = drawAreaX + (x - xMin) * xScale;
                ctx.fillText(x.toFixed(0), screenX - (ctx.measureText(x.toFixed(0)).width / 2), centerY + 15);
                ctx.beginPath();
                ctx.moveTo(screenX, centerY);
                ctx.lineTo(screenX, centerY + 5);
                ctx.stroke();
            }
            ctx.fillText('0', drawAreaX + (-xMin) * xScale - (ctx.measureText('0').width / 2), centerY + 15); // Label for 0

            // Axis Labels
            ctx.fillText('Z-score', drawAreaX + drawAreaWidth / 2 - 20, centerY + 30);
            ctx.save();
            ctx.translate(drawAreaX - 15, centerY / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Density', 0, 0);
            ctx.restore();


            // Calculate observed Z-score
            let observedZ;
            const mean = n * p0;
            const std = Math.sqrt(n * p0 * (1 - p0));
            if (std === 0) { // Handle division by zero case for std
                observedZ = 0; 
            } else {
                // Use continuity correction for observed Z for shading purposes, similar to p-value calculation
                if (tailType === 'right') {
                    observedZ = (observedK - 0.5 - mean) / std;
                } else if (tailType === 'left') {
                    observedZ = (observedK + 0.5 - mean) / std;
                } else if (tailType === 'two-tailed') {
                    // For two-tailed chart, plot the absolute Z-score of the observed k
                    observedZ = (observedK - mean) / std; // Z without correction for symmetric plot
                } else {
                    observedZ = (observedK - mean) / std; // Fallback
                }
            }
            

            // Shade area
            ctx.fillStyle = 'var(--chart-shading-color)';
            ctx.beginPath();
            
            if (tailType === 'right') {
                ctx.moveTo(drawAreaX + (observedZ - xMin) * xScale, centerY);
                for (let x = observedZ; x <= xMax; x += 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMax - xMin) * xScale, centerY);
            } else if (tailType === 'left') {
                ctx.moveTo(drawAreaX + (observedZ - xMin) * xScale, centerY);
                for (let x = observedZ; x >= xMin; x -= 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMin - xMin) * xScale, centerY);
            } else if (tailType === 'two-tailed') {
                const absObservedZForShading = Math.abs(observedZ); // Use abs for shading
                const zLowerShade = -absObservedZForShading;
                const zUpperShade = absObservedZForShading;

                // Shade right tail
                ctx.moveTo(drawAreaX + (zUpperShade - xMin) * xScale, centerY);
                for (let x = zUpperShade; x <= xMax; x += 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMax - xMin) * xScale, centerY);
                ctx.closePath();
                ctx.fill();

                // Shade left tail
                ctx.beginPath();
                ctx.moveTo(drawAreaX + (zLowerShade - xMin) * xScale, centerY);
                for (let x = zLowerShade; x >= xMin; x -= 0.01) {
                    const screenX = drawAreaX + (x - xMin) * xScale;
                    const y = normalPDF(x);
                    const screenY = centerY - (y * yScale);
                    ctx.lineTo(screenX, screenY);
                }
                ctx.lineTo(drawAreaX + (xMin - xMin) * xScale, centerY);
            }
            ctx.closePath();
            ctx.fill();

            // Draw line for observed Z
            ctx.strokeStyle = 'var(--accent-purple)';
            ctx.beginPath();
            const observedZForLine = (observedK - mean) / std; // Use Z without continuity for line
            const observedZPDF = normalPDF(observedZForLine);
            const labelXPos = drawAreaX + (observedZForLine - xMin) * xScale;
            const labelYPos = centerY - (observedZPDF * yScale);
            ctx.moveTo(labelXPos, centerY);
            ctx.lineTo(labelXPos, labelYPos);
            ctx.stroke();

            // Label for observed Z and P-value
            ctx.fillStyle = 'var(--chart-observed-z-label)'; 
            const textYOffset = 15;
            const textXOffset = 5;
            let pValLabelText = `p=${pValue.toFixed(3)}`;
            if (canvasId === 'chiSquareChart') {
                pValLabelText = `p=${pValue.toFixed(6)}`; // More precision for Chi-Square if needed
            }

            // Adjust text position to prevent going off canvas
            if (labelXPos + ctx.measureText(`Z=${observedZForLine.toFixed(2)}`).width + textXOffset > drawAreaX + drawAreaWidth) {
                ctx.fillText(`Z=${observedZForLine.toFixed(2)}`, labelXPos - ctx.measureText(`Z=${observedZForLine.toFixed(2)}`).width - textXOffset, labelYPos - textYOffset);
                ctx.fillText(pValLabelText, labelXPos - ctx.measureText(pValLabelText).width - textXOffset, labelYPos - textYOffset - 15);
            } else if (labelXPos - ctx.measureText(`Z=${observedZForLine.toFixed(2)}`).width - textXOffset < drawAreaX) {
                ctx.fillText(`Z=${observedZForLine.toFixed(2)}`, labelXPos + textXOffset, labelYPos - textYOffset);
                ctx.fillText(pValLabelText, labelXPos + textXOffset, labelYPos - textYOffset - 15);
            }
            else {
                ctx.fillText(`Z=${observedZForLine.toFixed(2)}`, labelXPos + textXOffset, labelYPos - textYOffset);
                ctx.fillText(pValLabelText, labelXPos + textXOffset, labelYPos - textYOffset - 15);
            }

            // Draw critical Z lines
            ctx.strokeStyle = 'var(--accent-gold)';
            ctx.beginPath();
            ctx.fillStyle = 'var(--chart-critical-z-label)';

            if (tailType === 'right') {
                let zCritical = normalInverseCDF(1 - alpha);
                const criticalXPos = drawAreaX + (zCritical - xMin) * xScale;
                const criticalYPos = centerY - (normalPDF(zCritical) * yScale);
                ctx.moveTo(criticalXPos, centerY);
                ctx.lineTo(criticalXPos, criticalYPos);
                ctx.fillText(`Zcrit=${zCritical.toFixed(2)}`, criticalXPos + textXOffset, criticalYPos - textYOffset);
            } else if (tailType === 'left') {
                let zCritical = normalInverseCDF(alpha);
                const criticalXPos = drawAreaX + (zCritical - xMin) * xScale;
                const criticalYPos = centerY - (normalPDF(zCritical) * yScale);
                ctx.moveTo(criticalXPos, centerY);
                ctx.lineTo(criticalXPos, criticalYPos);
                ctx.fillText(`Zcrit=${zCritical.toFixed(2)}`, criticalXPos + textXOffset, criticalYPos - textYOffset);
            } else if (tailType === 'two-tailed') {
                const absZCritical = normalInverseCDF(1 - alpha / 2); 
                
                const leftCriticalXPos = drawAreaX + (-absZCritical - xMin) * xScale;
                const leftCriticalYPos = centerY - (normalPDF(-absZCritical) * yScale);
                ctx.moveTo(leftCriticalXPos, centerY);
                ctx.lineTo(leftCriticalXPos, leftCriticalYPos);
                ctx.stroke(); 
                ctx.fillText(`Zcrit=${(-absZCritical).toFixed(2)}`, leftCriticalXPos - 80, leftCriticalYPos - textYOffset); // Adjust position for left label

                ctx.beginPath(); // Start new path for right critical line
                const rightCriticalXPos = drawAreaX + (absZCritical - xMin) * xScale;
                const rightCriticalYPos = centerY - (normalPDF(absZCritical) * yScale);
                ctx.moveTo(rightCriticalXPos, centerY);
                ctx.lineTo(rightCriticalXPos, rightCriticalYPos);
                ctx.fillText(`Zcrit=${absZCritical.toFixed(2)}`, rightCriticalXPos + textXOffset, rightCriticalYPos - textYOffset);
            }
            ctx.stroke();

            // Update accessible text description for charts
            const chartDescriptionElement = document.getElementById(`${canvasId}Description`);
            if (chartDescriptionElement) {
                let desc = `Grafik distribusi normal menunjukkan p-value ${pValue.toFixed(6)} `;
                const meanVal = (n * p0).toFixed(2);
                const stdVal = (Math.sqrt(n * p0 * (1 - p0))).toFixed(2);
                desc += `dengan mean ${meanVal} dan standar deviasi ${stdVal}. `;
                if (tailType === 'right') {
                    desc += `Area yang diarsir mewakili probabilitas X lebih besar atau sama dengan ${observedK}.`;
                } else if (tailType === 'left') {
                    desc += `Area yang diarsir mewakili probabilitas X lebih kecil atau sama dengan ${observedK}.`;
                } else if (tailType === 'two-tailed') {
                    desc += `Area yang diarsir mewakili probabilitas hasil yang sama ekstrem atau lebih ekstrem dari ${observedK} di kedua ekor distribusi.`;
                }
                chartDescriptionElement.textContent = desc;
            }
        }
        
        /**
         * Menghasilkan penjelasan untuk hasil analisis statistik secara lokal.
         */
        async function generateLocalExplanation() {
            const llmExplanationCard = document.getElementById('llmExplanationCard');
            const llmExplanationContent = document.getElementById('llmExplanationContent');
            const lang = document.documentElement.lang || 'id';
            const currentTranslations = translations[lang] || translations['id'];
            
            llmExplanationCard.classList.remove('hidden');
            llmExplanationContent.innerHTML = `
                <div class="flex flex-col justify-center items-center py-10">
                    <i class="fas fa-sync-alt fa-spin text-blue-400 text-4xl mb-4"></i>
                    <p class="text-blue-300 text-2xl">${currentTranslations.localExplanationLoading}</p>
                </div>
            `;
            await new Promise(resolve => setTimeout(resolve, 500)); 

            let explanationText = "";
            const isBinomialSignificant = lastBinomialPValue < lastAlpha;
            const isChiSquareSignificant = lastChiSquareResult.pValue < lastAlpha;

            if (isBinomialSignificant && isChiSquareSignificant) {
                explanationText = currentTranslations.explanationSignificantBoth;
            } else if (!isBinomialSignificant && !isChiSquareSignificant) {
                explanationText = currentTranslations.explanationNotSignificantBoth;
            } else {
                explanationText = currentTranslations.explanationMixed;
            }
            
            // Use string interpolation to inject dynamic values
            explanationText = explanationText
                .replace('${lastTotalAssignments}', lastTotalAssignments)
                .replace('${lastSameSectionCount}', lastSameSectionCount)
                .replace('${lastP0.toFixed(2)}', lastP0.toFixed(2));

            llmExplanationContent.innerHTML = `<p class="whitespace-pre-wrap">${explanationText}</p>`;
        }
    </script>
</body>
</html>
