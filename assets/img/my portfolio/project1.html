<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RevoFin | Loan Portfolio Performance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // Tailwind CSS configuration for custom colors and fonts
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-blue': '#1e2a4a',
                        'accent-blue': '#3b82f6',
                        'light-blue': '#93c5fd',
                        'teal': '#14b8a6',
                        'light-teal': '#99f6e4',
                        'dark-purple': '#4c1d95',
                        'light-purple': '#a78bfa',
                        'charcoal': '#2d3748',
                        'silver': '#e2e8f0',
                        'light-gray': '#f8fafc',
                        /* Removed timeline-specific dark colors as they are no longer needed */
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'display': ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        /* CSS variables for consistent spacing */
        :root {
            --header-height: 80px;
        }
        
        /* Body styling for font, background, and minimum height */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #f0f4f8, #e2e8f0);
            color: #1e293b;
            min-height: 100vh;
            overflow-x: hidden; /* Prevents horizontal scrolling */
        }
        
        /* Main dashboard container styling */
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header gradient and shadow styling */
        .header-gradient {
            background: linear-gradient(135deg, #1e2a4a 0%, #3b82f6 100%);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        
        /* Decorative top border for the header */
        .header-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, #14b8a6, #3b82f6);
        }
        
        /* Card styling for sections */
        .card {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }
        
        /* Hover effect for cards */
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.15);
        }
        
        /* Section title styling with an underline effect */
        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            color: #1e2a4a;
            position: relative;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #14b8a6);
            border-radius: 2px;
        }
        
        /* Insight badge styling */
        .insight-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        /* Specific badge colors */
        .badge-positive {
            background: rgba(20, 184, 166, 0.15);
            color: #0d9488;
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: #b45309;
        }
        
        .badge-critical {
            background: rgba(239, 68, 68, 0.15);
            color: #b91c1c;
        }
        
        /* Metric card styling */
        .metric-card {
            background: linear-gradient(to bottom right, #f8fafc, #e2e8f0);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }
        
        /* Hover effect for metric cards */
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        /* Metric value styling with gradient text */
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(90deg, #3b82f6, #14b8a6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Chart container styling for consistent dimensions */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin: 20px 0;
        }
        
        /* Risk item styling */
        .risk-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            margin-bottom: 12px;
            background: rgba(254, 226, 226, 0.3);
            border-radius: 12px;
            border-left: 4px solid #ef4444;
            transition: all 0.3s ease;
        }
        
        /* Hover effect for risk items */
        .risk-item:hover {
            background: rgba(254, 226, 226, 0.4);
            transform: translateX(5px);
        }
        
        /* Risk icon styling */
        .risk-icon {
            min-width: 36px;
            height: 36px;
            background: rgba(239, 68, 68, 0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #ef4444;
            font-size: 16px;
        }
        
        /* Recommendation item styling */
        .recommendation-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(204, 251, 241, 0.3);
            border-radius: 12px;
            border-left: 4px solid #14b8a6;
        }
        
        /* Recommendation icon styling */
        .recommendation-icon {
            min-width: 36px;
            height: 36px;
            background: rgba(20, 184, 166, 0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #14b8a6;
            font-size: 16px;
        }
        
        /* AI output section styling */
        .ai-output {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
            border: 1px solid rgba(147, 197, 253, 0.4);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(4px); /* Adds a subtle blur effect */
        }
        
        /* Decorative left border for AI output */
        .ai-output::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #3b82f6, #14b8a6);
        }
        
        /* Tabs container styling */
        .tabs-container {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
            overflow-x: auto; /* Allow horizontal scrolling on small screens */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        
        /* Individual tab styling */
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap; /* Prevent tabs from wrapping */
        }
        
        /* Active tab styling */
        .tab.active {
            color: #1e40af;
            border-bottom: 3px solid #3b82f6;
        }
        
        /* Hover effect for tabs */
        .tab:hover:not(.active) {
            color: #3b82f6;
        }
        
        /* Tab content visibility */
        .tab-content {
            display: none;
        }
        
        /* Active tab content display with fade-in animation */
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Loader animation */
        .loader {
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Pulse animation for elements */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        /* General fade-in animation */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .section-title {
                font-size: 1.5rem;
            }
            
            .chart-container {
                height: 250px;
            }
        }

        /* Custom styles for the Project Summary timeline */
        .timeline-section {
            background-color: white; /* Changed to white to match other tabs */
            padding: 40px 20px;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05); /* Soft shadow */
            border: 1px solid rgba(226, 232, 240, 0.6); /* Light border */
        }

        .timeline-container {
            position: relative;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px 0;
        }

        .timeline-container::after {
            content: '';
            position: absolute;
            width: 4px;
            background-color: #e2e8f0; /* Light gray line */
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -2px;
            z-index: 0;
        }

        .timeline-item {
            padding: 10px 0;
            position: relative;
            width: 50%;
            z-index: 1;
        }

        .timeline-item:nth-child(odd) {
            left: 0;
            padding-right: 40px; /* Space for the circle and line */
        }

        .timeline-item:nth-child(even) {
            left: 50%;
            padding-left: 40px; /* Space for the circle and line */
        }

        .timeline-circle {
            width: 50px;
            height: 50px;
            background-color: #3b82f6; /* Accent blue for circles */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); /* Blue shadow */
        }

        .timeline-item:nth-child(odd) .timeline-circle {
            right: -25px; /* Half of circle width */
        }

        .timeline-item:nth-child(even) .timeline-circle {
            left: -25px; /* Half of circle width */
        }

        .timeline-content-box {
            background-color: white; /* White background for content */
            color: #2d3748; /* Charcoal text */
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Soft shadow */
            border: 1px solid rgba(226, 232, 240, 0.6); /* Light border */
            transition: transform 0.3s ease;
        }

        .timeline-content-box:hover {
            transform: translateY(-5px);
        }

        .timeline-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: #1e2a4a; /* Deep blue for titles */
        }

        .timeline-description {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #2d3748; /* Charcoal text */
        }

        /* Arrows connecting timeline items */
        .timeline-item::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 10px solid transparent;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

        .timeline-item:nth-child(odd)::before {
            border-left-color: #e2e8f0; /* Light gray arrow pointing to the right content box */
            right: 15px; /* Position next to content box */
        }

        .timeline-item:nth-child(even)::before {
            border-right-color: #e2e8f0; /* Light gray arrow pointing to the left content box */
            left: 15px; /* Position next to content box */
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .timeline-container::after {
                left: 25px; /* Move central line to the left */
            }

            .timeline-item {
                width: 100%;
                padding-left: 70px; /* Make space for circle and line on the left */
                padding-right: 10px;
            }

            .timeline-item:nth-child(odd),
            .timeline-item:nth-child(even) {
                left: 0;
                padding-right: 10px; /* Reset padding for mobile */
            }

            .timeline-circle {
                left: 0; /* Align circles to the left */
                transform: translateY(-50%);
            }

            .timeline-item:nth-child(odd) .timeline-circle,
            .timeline-item:nth-child(even) .timeline-circle {
                left: 0; /* Ensure circles are always on the left */
                right: auto;
            }

            .timeline-item::before {
                border-left-color: #e2e8f0; /* Always point right */
                border-right-color: transparent;
                left: 55px; /* Position arrow consistently */
                right: auto;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header Section -->
        <header class="header-gradient p-6 mb-8 fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center text-white">
                <div class="mb-4 md:mb-0">
                    <h1 class="text-3xl md:text-4xl font-bold flex items-center">
                        <i class="fas fa-chart-line text-light-blue mr-3"></i>
                        RevoFin Portfolio Insights
                    </h1>
                    <p class="text-light-blue mt-2">Comprehensive Risk Assessment & Performance Analytics</p>
                </div>
                <div class="flex items-center">
                    <div class="text-center mr-6">
                        <div class="text-sm text-light-blue">Welcome! Nice to meet you :</div>
                        <div id="lastUpdated" class="text-xl font-semibold"></div>
                        <script>
                            // Set last updated date to today's date and time in "MMM DD, YYYY, HH:MM AM/PM" format
                            document.addEventListener('DOMContentLoaded', function() {
                                const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                                const now = new Date();
                                let hours = now.getHours();
                                const minutes = now.getMinutes().toString().padStart(2, '0');
                                const ampm = hours >= 12 ? 'PM' : 'AM';
                                hours = hours % 12;
                                hours = hours ? hours : 12; // the hour '0' should be '12'
                                const formatted = `${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}, ${hours}:${minutes} ${ampm}`;
                                document.getElementById('lastUpdated').textContent = formatted;
                            });
                        </script>
                    </div>
                    <div class="bg-white/20 p-3 rounded-full">
                        <i class="fas fa-user text-xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Key Metrics Section -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                <div class="metric-card">
                    <div class="text-charcoal text-sm font-medium">Portfolio Value</div>
                    <div class="metric-value">$2.8B</div>
                    <div class="text-teal text-sm font-medium">
                        <i class="fas fa-arrow-up mr-1"></i> 4.2% YoY
                    </div>
                </div>
                <div class="metric-card">
                    <div class="text-charcoal text-sm font-medium">Delinquency Rate</div>
                    <div class="metric-value">1.89%</div>
                    <div class="text-amber-600 text-sm font-medium">
                        <i class="fas fa-exclamation-triangle mr-1"></i> +0.3% MoM
                    </div>
                </div>
                <div class="metric-card">
                    <div class="text-charcoal text-sm font-medium">Risk Exposure</div>
                    <div class="metric-value">87.6%</div>
                    <div class="text-red-600 text-sm font-medium">
                        <i class="fas fa-arrow-trend-up mr-1"></i> High Concentration
                    </div>
                </div>
                <div class="metric-card">
                    <div class="text-charcoal text-sm font-medium">TKB30 Ratio</div>
                    <div class="metric-value">0.987</div>
                    <div class="text-teal text-sm font-medium">
                        <i class="fas fa-check-circle mr-1"></i> Healthy
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tabs-container mb-6 fade-in">
            <div class="tab active" data-tab="project-summary">Project Summary</div>
            <div class="tab" data-tab="overview">Portfolio Overview</div>
            <div class="tab" data-tab="risk">Risk Analysis</div>
            <div class="tab" data-tab="performance">Performance Metrics</div>
            <div class="tab" data-tab="recommendations">Strategic Recommendations</div>
            <div class="tab" data-tab="loan-analyzer">Loan Risk Analyzer</div>
        </div>

        <!-- Tab Content: Project Summary (Timeline Style) -->
        <div class="tab-content active" id="project-summary-tab">
            <section class="timeline-section fade-in">
                <h2 class="section-title text-center mb-10">RevoFin Loan Portfolio Performance Summary</h2>
                <div class="timeline-container">
                    <!-- Step 1: Situation -->
                    <div class="timeline-item">
                        <div class="timeline-circle">1</div>
                        <div class="timeline-content-box">
                            <h3 class="timeline-title">Situation: Problem & Context</h3>
                            <p class="timeline-description">
                                Focusing on loan portfolio performance, risk assessment, and strategic recommendations. The financial institution needs a clear, visual, and interactive way to monitor its loan portfolio's health, identify risks, and track performance trends. Key challenges include managing delinquency rates, understanding risk exposure (especially concentration and liquidity risks), and optimizing portfolio composition.
                            </p>
                        </div>
                    </div>

                    <!-- Step 2: Task -->
                    <div class="timeline-item">
                        <div class="timeline-circle">2</div>
                        <div class="timeline-content-box">
                            <h3 class="timeline-title">Task: Define Objectives</h3>
                            <p class="timeline-description">
                                The primary objective is to provide a real-time platform for financial analysts to monitor portfolio value, analyze composition, track historical trends, assess risks, and access strategic recommendations.
                            </p>
                        </div>
                    </div>

                    <!-- Step 3: Action (Implementation & Visualization) -->
                    <div class="timeline-item">
                        <div class="timeline-circle">3</div>
                        <div class="timeline-content-box">
                            <h3 class="timeline-title">Action: Dashboard & Interactive Development Features</h3>
                            <p class="timeline-description">
                                Design interactive data visualizations, including various financial charts. Integrated interactive tab navigation and an AI-powered "Loan Risk Analyzer" for individual loan assessments. Included detailed tables and descriptive text for key insights and trend analyses.
                            </p>
                        </div>
                    </div>


                    <!-- Step 5: Result -->
                    <div class="timeline-item">
                        <div class="timeline-circle">5</div>
                        <div class="timeline-content-box">
                            <h3 class="timeline-title">Result: Impact & Outcome</h3>
                            <p class="timeline-description">
                                The dashboard enables enhanced decision-making, improved risk identification, data-driven strategies, and operational efficiency. It fosters proactive portfolio management and clear communication.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Tab Content: Portfolio Overview -->
        <div class="tab-content" id="overview-tab">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                <div class="lg:col-span-2">
                    <section class="card p-6 fade-in">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="section-title">Portfolio Composition</h2>
                            <div class="flex items-center">
                                <span class="text-sm text-charcoal mr-3">As of May 2025</span>
                                <button class="bg-light-blue/20 text-accent-blue px-3 py-1 rounded-lg text-sm">
                                    <i class="fas fa-download mr-1"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-deep-blue mb-4">Loan Type Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="portfolioCompositionChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-deep-blue mb-4">Status by Loan Type</h3>
                                <div class="chart-container">
                                    <canvas id="statusDistributionChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-light-gray/50 p-4 rounded-xl border border-silver">
                            <div class="flex">
                                <i class="fas fa-lightbulb text-amber-500 text-xl mt-1 mr-3"></i>
                                <div>
                                    <h4 class="font-semibold text-deep-blue">Key Insight</h4>
                                    <p class="text-charcoal">
                                        Individual loans represent 87.6% of the portfolio with a delinquency rate of 1.93%. 
                                        While DIRECT_PAY loans have a smaller volume, they show a significantly higher 
                                        delinquency rate of 5.85%, indicating a need for focused risk management.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                
                <div>
                    <section class="card p-6 fade-in">
                        <h2 class="section-title">Performance Trends</h2>
                        
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-deep-blue mb-4">DPD & TKB30 (2012-2019)</h3>
                            <div class="chart-container">
                                <canvas id="performanceTrendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-light-teal/20 p-4 rounded-xl border border-teal/20">
                            <div class="flex">
                                <i class="fas fa-chart-line text-teal text-xl mt-1 mr-3"></i>
                                <div>
                                    <h4 class="font-semibold text-deep-blue">Trend Analysis</h4>
                                    <p class="text-charcoal">
                                        DPD shows a decreasing trend from 2016 (2.37% of OS) to 2019 (1.17% of OS). 
                                        TKB30 remains consistently above 0.96 across all cohorts, indicating strong 
                                        portfolio health despite minor fluctuations.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <!-- Loan Status by Type Table -->
            <section class="card p-6 mt-8 fade-in">
                <h2 class="section-title">Loan Status by Type</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow-sm">
                        <thead>
                            <tr class="bg-gray-100 text-left text-sm font-medium text-charcoal uppercase tracking-wider">
                                <th class="py-3 px-4 rounded-tl-lg">TYPE</th>
                                <th class="py-3 px-4">CURRENT</th>
                                <th class="py-3 px-4">&lt; 30 DAYS</th>
                                <th class="py-3 px-4">&gt; 30 DAYS</th>
                                <th class="py-3 px-4">GRACE PERIOD</th>
                                <th class="py-3 px-4">DEFAULT</th>
                                <th class="py-3 px-4 rounded-tr-lg">TOTAL</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-silver">
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 whitespace-nowrap">DIRECT_PAY</td>
                                <td class="py-3 px-4 whitespace-nowrap">$2.85M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$50.5K</td>
                                <td class="py-3 px-4 whitespace-nowrap">$187.1K</td>
                                <td class="py-3 px-4 whitespace-nowrap">$114.8K</td>
                                <td class="py-3 px-4 whitespace-nowrap">-</td>
                                <td class="py-3 px-4 whitespace-nowrap">$3.2M</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 whitespace-nowrap">Individual</td>
                                <td class="py-3 px-4 whitespace-nowrap">$2.37B</td>
                                <td class="py-3 px-4 whitespace-nowrap">$11.45M</td>
                                <td class="py-3 px-4 whitespace-nowrap text-red-600 font-semibold">$47.25M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$23.88M</td>
                                <td class="py-3 px-4 whitespace-nowrap text-red-600 font-semibold">$195.3K</td>
                                <td class="py-3 px-4 whitespace-nowrap">$2.45B</td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 whitespace-nowrap">JOINT</td>
                                <td class="py-3 px-4 whitespace-nowrap">$15.0M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$73.3K</td>
                                <td class="py-3 px-4 whitespace-nowrap">$308.7K</td>
                                <td class="py-3 px-4 whitespace-nowrap">$262.5K</td>
                                <td class="py-3 px-4 whitespace-nowrap">-</td>
                                <td class="py-3 px-4 whitespace-nowrap">$15.6M</td>
                            </tr>
                             <tr class="hover:bg-gray-50">
                                <td class="py-3 px-4 whitespace-nowrap">Joint App</td>
                                <td class="py-3 px-4 whitespace-nowrap">$319.1M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$1.45M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$5.10M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$3.32M</td>
                                <td class="py-3 px-4 whitespace-nowrap">-</td>
                                <td class="py-3 px-4 whitespace-nowrap">$329.0M</td>
                            </tr>
                            <tr class="bg-gray-50 font-bold">
                                <td class="py-3 px-4 whitespace-nowrap rounded-bl-lg">Total</td>
                                <td class="py-3 px-4 whitespace-nowrap">$2.71B</td>
                                <td class="py-3 px-4 whitespace-nowrap">$13.02M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$52.85M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$27.58M</td>
                                <td class="py-3 px-4 whitespace-nowrap">$195.3K</td>
                                <td class="py-3 px-4 whitespace-nowrap rounded-br-lg">$2.80B</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Tab Content: Risk Analysis -->
        <div class="tab-content" id="risk-tab">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Risk Exposure Analysis</h2>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-deep-blue mb-4">Risk by Loan Grade</h3>
                        <div class="chart-container">
                            <canvas id="riskByGradeChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue mb-4">Term Risk Analysis</h3>
                            <div class="chart-container">
                                <canvas id="termRiskChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-deep-blue mb-4">Purpose Risk Profile</h3>
                            <div class="chart-container">
                                <canvas id="purposeRiskChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Critical Risk Factors</h2>
                    
                    <div class="space-y-4 mb-8">
                        <div class="risk-item">
                            <div class="risk-icon">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Concentration Risk</div>
                                <p class="text-charcoal text-sm mt-1">
                                    87.6% of portfolio in Individual loans. Top 5% loans account for 12.11% of total exposure.
                                </p>
                                <div class="mt-2 flex items-center">
                                    <span class="text-xs font-medium bg-red-100 text-red-800 px-2 py-1 rounded">Critical</span>
                                    <span class="text-xs text-charcoal ml-2">Requires immediate attention</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="risk-item">
                            <div class="risk-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Liquidity Risk</div>
                                <p class="text-charcoal text-sm mt-1">
                                    $47.3M in late payments (>30 days) potentially straining cash flow.
                                </p>
                                <div class="mt-2 flex items-center">
                                    <span class="text-xs font-medium bg-amber-100 text-amber-800 px-2 py-1 rounded">High</span>
                                    <span class="text-xs text-charcoal ml-2">Monitor weekly</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="risk-item">
                            <div class="risk-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Operational Risk</div>
                                <p class="text-charcoal text-sm mt-1">
                                    Missing loan IDs/customer IDs for $195,275 in default loans.
                                </p>
                                <div class="mt-2 flex items-center">
                                    <span class="text-xs font-medium bg-amber-100 text-amber-800 px-2 py-1 rounded">Medium</span>
                                    <span class="text-xs text-charcoal ml-2">Data cleanup needed</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="risk-item">
                            <div class="risk-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Geographic Risk</div>
                                <p class="text-charcoal text-sm mt-1">
                                    California (CA) dominance across all risk categories.
                                </p>
                                <div class="mt-2 flex items-center">
                                    <span class="text-xs font-medium bg-amber-100 text-amber-800 px-2 py-1 rounded">High</span>
                                    <span class="text-xs text-charcoal ml-2">Regional diversification needed</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-light-blue/20 p-4 rounded-xl border border-accent-blue/20">
                        <h4 class="font-semibold text-deep-blue mb-2">Risk Mitigation Strategy</h4>
                        <p class="text-charcoal text-sm">
                            Implement portfolio diversification strategy targeting a reduction in Individual loan exposure 
                            to &le;75% over the next 6 months. Introduce regional risk premiums for California-based loans 
                            and enhance data governance protocols to address operational risks.
                        </p>
                    </div>
                </section>
            </div>
        </div>

        <!-- Tab Content: Performance Metrics -->
        <div class="tab-content" id="performance-tab">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Historical Performance</h2>
                    
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-deep-blue">Portfolio Metrics (2012-2019)</h3>
                            <div class="flex space-x-2">
                                <button class="bg-light-blue/20 text-accent-blue px-3 py-1 rounded-lg text-sm">
                                    OS
                                </button>
                                <button class="bg-light-teal/20 text-teal px-3 py-1 rounded-lg text-sm">
                                    DPD
                                </button>
                                <button class="bg-light-purple/20 text-dark-purple px-3 py-1 rounded-lg text-sm">
                                    TKB30
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="historicalMetricsChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-light-purple/20 p-4 rounded-xl border border-light-purple/30">
                        <h4 class="font-semibold text-deep-blue mb-2">Performance Insight</h4>
                        <p class="text-charcoal text-sm">
                            The 2014 and 2016 cohorts show higher DPD rates compared to other years, indicating potential 
                            underwriting issues during those periods. Recent cohorts (2018-2019) demonstrate improved 
                            performance with TKB30 ratios exceeding 0.98.
                        </p>
                    </div>
                </section>
                
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Segment Performance</h2>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-deep-blue mb-4">Customer Attributes Analysis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="chart-container">
                                <canvas id="incomeRiskChart"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="homeOwnershipChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-amber-50 p-4 rounded-xl border border-amber-100">
                        <h4 class="font-semibold text-deep-blue mb-2">Segment Insights</h4>
                        <p class="text-charcoal text-sm">
                            Borrowers in the lowest income quartile show a 35% higher default rate than top quartile. 
                            Homeowners (OWN status) have a 20% higher delinquency rate compared to renters, suggesting 
                            potential cash flow issues despite asset ownership.
                        </p>
                    </div>
                </section>
            </div>
        </div>

        <!-- Tab Content: Strategic Recommendations -->
        <div class="tab-content" id="recommendations-tab">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Strategic Recommendations</h2>
                    
                    <div class="space-y-4 mb-6">
                        <div class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Diversify Loan Portfolio</div>
                                <p class="text-charcoal text-sm mt-1">
                                    Reduce individual loan exposure from 87.6% to 75% by increasing Joint App and DIRECT_PAY segments.
                                    <span class="badge-positive insight-badge">Priority: High</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fas fa-percent"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Adjust Pricing Strategy</div>
                                <p class="text-charcoal text-sm mt-1">
                                    Increase rates for Medical and Vacation loans by 1.5-2.0% to align with risk profiles.
                                    <span class="badge-warning insight-badge">Impact: Medium</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fas fa-map-marked-alt"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Manage Geographic Risk</div>
                                <p class="text-charcoal text-sm mt-1">
                                    Cap California exposure at 35% of new originations and add regional risk premium.
                                    <span class="badge-critical insight-badge">Urgent</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <div class="font-semibold text-deep-blue">Enhance Monitoring</div>
                                <p class="text-charcoal text-sm mt-1">
                                    Implement stress testing for 60-month loans and allocate liquidity reserves for large exposures.
                                    <span class="badge-positive insight-badge">Priority: Medium</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold text-deep-blue mb-4">Implementation Roadmap</h3>
                        <div class="bg-light-gray/50 p-4 rounded-lg">
                            <div class="flex justify-between mb-3 text-sm font-medium text-charcoal">
                                <span>Q3 2025</span>
                                <span>Q4 2025</span>
                                <span>Q1 2026</span>
                            </div>
                            <div class="w-full bg-silver h-2 rounded-full overflow-hidden">
                                <div class="bg-gradient-to-r from-accent-blue to-teal h-full" style="width: 65%"></div>
                            </div>
                            <div class="mt-3 text-sm text-charcoal">
                                Current progress: Portfolio diversification initiative 65% complete
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="card p-6 fade-in">
                    <h2 class="section-title">Recommendation Details</h2>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-deep-blue mb-4">Portfolio Optimization Impact</h3>
                        <div class="chart-container">
                            <canvas id="impactAnalysisChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold text-deep-blue mb-4">Detailed Strategic Plan</h3>
                        <div class="bg-light-gray/50 p-4 rounded-xl border border-silver">
                            <p class="text-charcoal text-sm">
                                The detailed strategic plan outlines phased implementation of portfolio diversification,
                                dynamic pricing adjustments for high-risk loan purposes, and enhanced geographic risk
                                management. Key milestones include a 15% reduction in individual loan concentration
                                by Q4 2025 and integration of real-time liquidity monitoring by Q1 2026.
                            </s>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Tab Content: Loan Risk Analyzer -->
        <div class="tab-content" id="loan-analyzer-tab">
            <section class="card p-6 fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="section-title">Loan Risk Analyzer</h2>
                    <span class="text-accent-blue text-sm font-semibold flex items-center">
                        <i class="fas fa-brain mr-2"></i> Powered by Gemini AI
                    </span>
                </div>
                <p class="text-charcoal mb-6">AI-powered analysis of loan characteristics and risk profiles</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div>
                        <label for="loanPurpose" class="block text-sm font-medium text-charcoal mb-2">Loan Purpose</label>
                        <select id="loanPurpose" class="w-full p-3 border border-silver rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                            <option value="Medical">Medical</option>
                            <option value="Debt Consolidation">Debt Consolidation</option>
                            <option value="Home Improvement">Home Improvement</option>
                            <option value="Car Financing">Car Financing</option>
                            <option value="Vacation">Vacation</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="loanAmount" class="block text-sm font-medium text-charcoal mb-2">Loan Amount</label>
                        <input type="number" id="loanAmount" placeholder="$ 5,000" class="w-full p-3 border border-silver rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                    </div>
                    <div>
                        <label for="termLength" class="block text-sm font-medium text-charcoal mb-2">Term Length</label>
                        <select id="termLength" class="w-full p-3 border border-silver rounded-lg focus:ring-accent-blue focus:border-accent-blue">
                            <option value="36">36 months</option>
                            <option value="60">60 months</option>
                            <option value="84">84 months</option>
                        </select>
                    </div>
                </div>
                <button id="analyzeRiskBtn" class="w-full md:w-auto bg-gradient-to-r from-accent-blue to-teal text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    Analyze Risk Profile
                </button>
                <div id="riskAnalysisOutput" class="ai-output mt-8 hidden">
                    <h3 class="font-semibold text-deep-blue mb-3">AI Risk Assessment:</h3>
                    <p id="analysisResult" class="text-charcoal"></p>
                    <div class="mt-4 text-sm text-charcoal">
                        <i class="fas fa-info-circle mr-2"></i> This analysis is based on historical data and AI models.
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- JavaScript for Chart.js and Tab Logic -->
    <script>
        // Chart.js Global Defaults for consistent styling
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#4a5568'; // charcoal-like color
        Chart.defaults.borderColor = '#e2e8f0'; // silver-like color

        // Function to switch tabs
        function switchTab(tabName) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // Activate the selected tab content and tab button
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
        }

        // Event listeners for tab clicks
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        // Initialize Charts and Loan Analyzer Logic on window load
        window.onload = function() {
            // Set the 'project-summary' tab as active by default on load
            switchTab('project-summary');

            // --- Chart Initialization ---

            // Portfolio Composition Chart (Doughnut)
            const portfolioCompositionCtx = document.getElementById('portfolioCompositionChart').getContext('2d');
            new Chart(portfolioCompositionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Individual Loans', 'Joint App Loans', 'DIRECT_PAY Loans', 'Business Loans'],
                    datasets: [{
                        data: [87.6, 8.5, 2.5, 1.4], // Example data based on insight
                        backgroundColor: ['#3b82f6', '#14b8a6', '#a78bfa', '#f59e0b'],
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Status by Loan Type Chart (Bar)
            const statusDistributionCtx = document.getElementById('statusDistributionChart').getContext('2d');
            new Chart(statusDistributionCtx, {
                type: 'bar',
                data: {
                    labels: ['Individual Loans', 'Joint App Loans', 'DIRECT_PAY Loans', 'Business Loans'],
                    datasets: [{
                        label: 'Current',
                        data: [90, 95, 80, 92],
                        backgroundColor: '#3b82f6',
                        borderRadius: 5
                    }, {
                        label: 'Late Payment',
                        data: [7, 3, 10, 5],
                        backgroundColor: '#f59e0b',
                        borderRadius: 5
                    }, {
                        label: 'Default',
                        data: [3, 2, 10, 3], // Increased DIRECT_PAY default for example
                        backgroundColor: '#ef4444',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Performance Trend Chart (Line)
            const performanceTrendCtx = document.getElementById('performanceTrendChart').getContext('2d');
            new Chart(performanceTrendCtx, {
                type: 'line',
                data: {
                    labels: ['2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019'],
                    datasets: [{
                        label: 'DPD (% of OS)',
                        data: [2.5, 2.2, 2.8, 2.0, 2.37, 1.8, 1.5, 1.17],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'TKB30 Ratio',
                        data: [0.97, 0.98, 0.96, 0.985, 0.975, 0.988, 0.99, 0.987],
                        borderColor: '#14b8a6',
                        backgroundColor: 'rgba(20, 184, 166, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Risk by Loan Grade Chart (Bar)
            const riskByGradeCtx = document.getElementById('riskByGradeChart').getContext('2d');
            new Chart(riskByGradeCtx, {
                type: 'bar',
                data: {
                    labels: ['Grade A', 'Grade B', 'Grade C', 'Grade D', 'Grade E'],
                    datasets: [{
                        label: 'Default Rate (%)',
                        data: [0.5, 1.2, 2.5, 4.0, 6.5],
                        backgroundColor: ['#14b8a6', '#3b82f6', '#f59e0b', '#ef4444', '#b91c1c'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Default Rate (%)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Term Risk Chart (Bar)
            const termRiskCtx = document.getElementById('termRiskChart').getContext('2d');
            new Chart(termRiskCtx, {
                type: 'bar',
                data: {
                    labels: ['36 Months', '60 Months', '84 Months'],
                    datasets: [{
                        label: 'Delinquency Rate (%)',
                        data: [1.5, 2.8, 4.2],
                        backgroundColor: ['#3b82f6', '#f59e0b', '#ef4444'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Delinquency Rate (%)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Purpose Risk Chart (Doughnut)
            const purposeRiskCtx = document.getElementById('purposeRiskChart').getContext('2d');
            new Chart(purposeRiskCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Debt Consolidation', 'Home Improvement', 'Medical', 'Car Financing', 'Vacation', 'Other'],
                    datasets: [{
                        data: [40, 20, 15, 10, 8, 7],
                        backgroundColor: ['#3b82f6', '#14b8a6', '#f59e0b', '#a78bfa', '#ef4444', '#6b7280'],
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Historical Metrics Chart (Line) - This is a more detailed version of Performance Trend Chart
            const historicalMetricsCtx = document.getElementById('historicalMetricsChart').getContext('2d');
            new Chart(historicalMetricsCtx, {
                type: 'line',
                data: {
                    labels: ['2012', '2013', '2014', '2015', '2016', '2017', '2018', '2019'],
                    datasets: [{
                        label: 'Outstanding Balance ($M)',
                        data: [1500, 1700, 1650, 1900, 2100, 2300, 2500, 2800],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3,
                        yAxisID: 'y' // Assign to primary Y-axis
                    }, {
                        label: 'DPD Rate (%)',
                        data: [2.5, 2.2, 2.8, 2.0, 2.37, 1.8, 1.5, 1.17],
                        borderColor: '#14b8a6',
                        backgroundColor: 'rgba(20, 184, 166, 0.1)',
                        fill: false,
                        tension: 0.3,
                        yAxisID: 'y1' // Assign to secondary Y-axis
                    }, {
                        label: 'TKB30 Ratio',
                        data: [0.97, 0.98, 0.96, 0.985, 0.975, 0.988, 0.99, 0.987],
                        borderColor: '#a78bfa',
                        backgroundColor: 'rgba(167, 139, 250, 0.1)',
                        fill: false,
                        tension: 0.3,
                        yAxisID: 'y2' // Assign to tertiary Y-axis
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    stacked: false, // Important for multiple Y-axes
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Outstanding Balance ($M)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false, // Only draw grid lines for the first Y-axis
                            },
                            title: {
                                display: true,
                                text: 'DPD Rate (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                         y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false, // Only draw grid lines for the first Y-axis
                            },
                            title: {
                                display: true,
                                text: 'TKB30 Ratio'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(3); // Format to 3 decimal places
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Income Risk Chart (Bar)
            const incomeRiskCtx = document.getElementById('incomeRiskChart').getContext('2d');
            new Chart(incomeRiskCtx, {
                type: 'bar',
                data: {
                    labels: ['<$30K', '$30K-$60K', '$60K-$90K', '>$90K'],
                    datasets: [{
                        label: 'Default Rate (%)',
                        data: [5.0, 3.5, 2.0, 1.5], // Example data based on insight
                        backgroundColor: ['#ef4444', '#f59e0b', '#14b8a6', '#3b82f6'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Default Rate (%)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Home Ownership Chart (Doughnut)
            const homeOwnershipCtx = document.getElementById('homeOwnershipChart').getContext('2d');
            new Chart(homeOwnershipCtx, {
                type: 'doughnut',
                data: {
                    labels: ['OWN', 'MORTGAGE', 'RENT', 'OTHER'],
                    datasets: [{
                        data: [30, 45, 20, 5], // Example distribution
                        backgroundColor: ['#ef4444', '#f59e0b', '#14b8a6', '#6b7280'],
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    }
                }
            });

            // Impact Analysis Chart (Bar)
            const impactAnalysisCtx = document.getElementById('impactAnalysisChart').getContext('2d');
            new Chart(impactAnalysisCtx, {
                type: 'bar',
                data: {
                    labels: ['Current Delinquency', 'Target Delinquency (Diversification)', 'Target Delinquency (Pricing Adjustments)'],
                    datasets: [{
                        label: 'Delinquency Rate (%)',
                        data: [1.89, 1.5, 1.3],
                        backgroundColor: ['#ef4444', '#f59e0b', '#14b8a6'],
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 2.5, // Set max for better visualization of small percentages
                            title: {
                                display: true,
                                text: 'Delinquency Rate (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // --- Loan Risk Analyzer Logic ---
            const analyzeRiskBtn = document.getElementById('analyzeRiskBtn');
            analyzeRiskBtn.addEventListener('click', () => {
                const loanPurpose = document.getElementById('loanPurpose').value;
                const loanAmount = document.getElementById('loanAmount').value;
                const termLength = document.getElementById('termLength').value;
                const analysisResultDiv = document.getElementById('analysisResult');
                const riskAnalysisOutputDiv = document.getElementById('riskAnalysisOutput');

                // Basic validation for loan amount
                if (!loanAmount || isNaN(loanAmount) || parseFloat(loanAmount) <= 0) {
                    analysisResultDiv.innerHTML = '<span class="text-red-600 font-semibold">Error:</span> Please enter a valid loan amount.';
                    riskAnalysisOutputDiv.classList.remove('hidden');
                    return;
                }

                // Simulate AI analysis based on inputs
                let riskScore = 0;
                let riskDescription = '';

                // Adjust risk based on loan purpose
                if (loanPurpose === 'Medical' || loanPurpose === 'Vacation') {
                    riskScore += 2; // Higher risk for these purposes
                } else if (loanPurpose === 'Debt Consolidation') {
                    riskScore += 1; // Medium risk
                }

                // Adjust risk based on loan amount (example thresholds)
                const amount = parseFloat(loanAmount);
                if (amount > 50000) {
                    riskScore += 3; // Very high amount, higher risk
                } else if (amount > 20000) {
                    riskScore += 1; // Moderate amount
                }

                // Adjust risk based on term length
                if (termLength === '84') {
                    riskScore += 2; // Longer term, higher risk
                } else if (termLength === '60') {
                    riskScore += 1; // Medium term
                }

                // Determine overall risk level based on calculated riskScore
                if (riskScore >= 5) {
                    riskDescription = `<span class="text-red-600 font-semibold">High Risk:</span> This loan carries significant risk due to its characteristics. Consider stricter underwriting or higher interest rates.`;
                } else if (riskScore >= 3) {
                    riskDescription = `<span class="text-amber-600 font-semibold">Moderate Risk:</span> This loan has some elevated risk factors. Close monitoring is recommended.`;
                } else {
                    riskDescription = `<span class="text-teal-600 font-semibold">Low Risk:</span> This loan appears to be within acceptable risk parameters.`;
                }

                // Display the analysis result
                analysisResultDiv.innerHTML = riskDescription;
                riskAnalysisOutputDiv.classList.remove('hidden'); // Show the AI output section
            });
        };
    </script>
</body>
</html>
